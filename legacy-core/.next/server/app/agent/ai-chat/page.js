(()=>{var e={};e.id=6134,e.ids=[6134],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},46145:e=>{"use strict";e.exports=require("@supabase/supabase-js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},91713:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>g,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c}),s(45281),s(1409),s(48385),s(12523);var r=s(23191),a=s(88716),l=s(37922),n=s.n(l),o=s(95231),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);s.d(t,i);let c=["",{children:["agent",{children:["ai-chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,45281)),"C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\agent\\ai-chat\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,1409)),"C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\agent\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,48385)),"C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,12523)),"C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\not-found.tsx"]}],d=["C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\agent\\ai-chat\\page.tsx"],u="/agent/ai-chat/page",g={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/agent/ai-chat/page",pathname:"/agent/ai-chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5093:(e,t,s)=>{Promise.resolve().then(s.bind(s,73277))},58408:(e,t,s)=>{Promise.resolve().then(s.bind(s,72239))},73277:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>N});var r=s(10326),a=s(17577),l=s(22665);s(24879);var n=s(46226),o=s(58234),i=s(51996),c=s(88307),d=s(32933),u=s(94019),g=s(69508),h=s(98091);let m=({chats:e=[],activeChat:t=null,onChatSelect:s=()=>{},onNewChat:l=()=>{},onDeleteChat:m=()=>{},onUpdateChatTitle:x=()=>{}})=>{let{user:p}=(0,o.E)(),[f,y]=(0,a.useState)(""),[w,b]=(0,a.useState)(null),[v,j]=(0,a.useState)(null),[N,C]=(0,a.useState)(""),[k,S]=(0,a.useState)(null),$=f?e.filter(e=>e.title.toLowerCase().includes(f.toLowerCase())):e,D=(e,t,s)=>{e.stopPropagation(),j(t),C(s)},A=e=>{N.trim()&&x(e,N.trim()),j(null)},_=(e,t)=>{"Enter"===e.key?A(t):"Escape"===e.key&&j(null)},E=(e,t)=>{e.stopPropagation(),k===t?(m(t),S(null)):(S(t),setTimeout(()=>{S(null)},3e3))},L=e=>{let t=new Date(e),s=new Date;if(t.toDateString()===s.toDateString())return"Today";let r=new Date(s);if(r.setDate(s.getDate()-1),t.toDateString()===r.toDateString())return"Yesterday";let a=new Date(s);return(a.setDate(s.getDate()-7),t>a)?t.toLocaleDateString(void 0,{weekday:"long"}):t.toLocaleDateString(void 0,{month:"short",day:"numeric"})};return(0,r.jsxs)("aside",{className:"flex h-screen flex-col bg-gradient-to-b from-gray-900 via-gray-850 to-gray-800 text-white w-full shadow-xl",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-blue-900/40 bg-gradient-to-br from-gray-900 to-blue-900/40",children:[(0,r.jsxs)("div",{className:"flex items-center mb-5",children:[r.jsx("div",{className:"w-11 h-11 mr-3 relative flex-shrink-0",children:r.jsx(n.default,{src:"/logo.png",alt:"LegacyCore Logo",width:44,height:44,className:"object-contain"})}),(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"font-bold text-xl text-white",children:"Agent AI"}),r.jsx("p",{className:"text-xs text-blue-200/70 font-light",children:"Powered by LegacyCore"})]})]}),(0,r.jsxs)("button",{onClick:l,className:"w-full flex items-center justify-center py-3 px-4 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-md transition-all duration-200 ease-in-out transform hover:scale-[1.02] hover:shadow-lg border border-blue-500/30",children:[r.jsx(i.Z,{size:18,className:"mr-2"}),r.jsx("span",{className:"font-medium",children:"New Chat"})]})]}),p&&r.jsx("div",{className:"border-b border-blue-900/20 p-4 bg-gray-800/40",children:(0,r.jsxs)("div",{className:"flex items-center",children:[p.avatar_url?r.jsx(n.default,{src:p.avatar_url,alt:p.user_metadata?.name||"User",width:38,height:38,className:"rounded-full mr-3 ring-2 ring-blue-500/30 border border-white/10"}):r.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center mr-3 shadow-md border border-white/10",children:r.jsx("span",{className:"text-sm font-semibold text-white",children:(p.user_metadata?.name||p.email||"U").charAt(0).toUpperCase()})}),(0,r.jsxs)("div",{className:"text-sm truncate",children:[r.jsx("p",{className:"font-semibold text-white",children:p.user_metadata?.name||"Agent"}),r.jsx("p",{className:"text-gray-300 text-xs truncate",children:p.email})]})]})}),r.jsx("div",{className:"p-4 border-b border-blue-900/20 bg-gray-800/20",children:(0,r.jsxs)("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(c.Z,{size:16,className:"text-blue-300/70"})}),r.jsx("input",{type:"text",placeholder:"Search chats...",className:"block w-full pl-10 pr-3 py-2.5 rounded-lg bg-gray-700/60 border border-blue-500/20 focus:ring-2 focus:ring-blue-500/70 focus:border-blue-500 focus:outline-none text-sm transition-all duration-200 text-white shadow-inner",value:f,onChange:e=>y(e.target.value)})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-blue-600/40 scrollbar-track-gray-800/40",children:0===$.length?(0,r.jsxs)("div",{className:"p-6 text-center text-gray-400",children:[r.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-800/80 mb-4",children:r.jsx(c.Z,{size:24,className:"text-blue-400"})}),r.jsx("p",{className:"text-sm font-medium text-gray-300",children:f?"No chats match your search":"No chats yet"}),r.jsx("p",{className:"text-xs text-blue-300/50 mt-1",children:f?"Try another search term":"Start a new conversation"})]}):r.jsx("div",{className:"divide-y divide-blue-900/10",children:$.map(e=>r.jsx("div",{className:`relative ${t===e.id?"bg-blue-600/20 border-l-4 border-l-blue-500":"hover:bg-gray-700/40 border-l-4 border-l-transparent"} transition-all duration-200 cursor-pointer`,onMouseEnter:()=>b(e.id),onMouseLeave:()=>{b(null),k||S(null)},children:(0,r.jsxs)("div",{className:"px-4 py-3.5",onClick:()=>s(e.id),children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[v===e.id?r.jsx("input",{type:"text",value:N,onChange:e=>C(e.target.value),onBlur:()=>A(e.id),onKeyDown:t=>_(t,e.id),autoFocus:!0,className:"flex-1 px-2 py-1 mr-2 bg-gray-700 text-white border border-blue-500/30 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",onClick:e=>e.stopPropagation()}):r.jsx("h3",{className:"font-medium text-sm truncate text-white",style:{maxWidth:"80%"},children:e.title||"New Chat"}),r.jsx("span",{className:"text-xs text-blue-300/70",children:L(e.createdAt)})]}),!v&&r.jsx("p",{className:"text-xs text-gray-400 truncate mt-1",children:e.messages.length>0?e.messages[e.messages.length-1].content.substring(0,50)+(e.messages[e.messages.length-1].content.length>50?"...":""):"No messages yet"}),(w===e.id||k===e.id)&&!v&&r.jsx("div",{className:"absolute top-2 right-2 flex items-center space-x-1",children:k===e.id?(0,r.jsxs)("div",{className:"flex items-center bg-gray-900/90 rounded-lg overflow-hidden shadow-lg border border-gray-700/50",children:[(0,r.jsxs)("button",{onClick:t=>{t.stopPropagation(),m(e.id),S(null)},className:"px-2 py-1.5 text-xs bg-red-600 hover:bg-red-700 text-white flex items-center",title:"Confirm Delete",children:[r.jsx(d.Z,{size:14,className:"mr-1"}),"Delete"]}),(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),S(null)},className:"px-2 py-1.5 text-xs bg-gray-700 hover:bg-gray-800 text-white flex items-center",title:"Cancel",children:[r.jsx(u.Z,{size:14,className:"mr-1"}),"Cancel"]})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:t=>D(t,e.id,e.title),className:"p-1.5 rounded-full bg-gray-800/80 hover:bg-blue-600/80 text-gray-400 hover:text-white transition-all duration-200",title:"Edit Chat Title",children:r.jsx(g.Z,{size:14})}),r.jsx("button",{onClick:t=>E(t,e.id),className:"p-1.5 rounded-full bg-gray-800/80 hover:bg-red-600/80 text-gray-400 hover:text-white transition-all duration-200",title:"Delete Chat",children:r.jsx(h.Z,{size:14})})]})})]})},e.id))})}),r.jsx("div",{className:"p-3 text-center border-t border-blue-900/30 text-xs text-gray-500 bg-gradient-to-t from-gray-900 to-gray-800/70",children:r.jsx("p",{children:"LegacyCore Agent AI v1.0"})})]})};var x=s(78012);let p=({id:e,role:t,content:s,timestamp:l,onDelete:n})=>{let[o,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1);return(0,r.jsxs)("div",{className:`px-4 py-3 flex ${"user"===t?"justify-end":"justify-start"}`,children:["assistant"===t&&r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 
          bg-teal-600 text-white mr-3`,children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),r.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),r.jsx("circle",{cx:"15.5",cy:"8.5",r:"1.5"}),r.jsx("path",{d:"M8.5 14a4 4 0 0 0 7 0"})]})}),(0,r.jsxs)("div",{className:`max-w-[75%] ${"user"===t?"bg-indigo-600 text-white":"bg-gray-800 text-gray-100"} 
        rounded-lg px-4 py-3 shadow-md`,children:[r.jsx("div",{className:"flex justify-between items-start",children:n&&e&&r.jsx("div",{className:"flex items-center text-xs opacity-0 group-hover:opacity-100 absolute top-2 right-2",children:r.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),c?(i(!0),n&&e&&n(e)):(d(!0),setTimeout(()=>{d(!1)},3e3))},disabled:o,className:`p-1 rounded ${c?"bg-red-600 text-white":"text-gray-400 hover:text-gray-300 hover:bg-gray-700"} transition-colors`,"aria-label":c?"Confirm delete":"Delete message",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M3 6h18"}),r.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})]})})})}),r.jsx("div",{className:"prose prose-invert max-w-none message-content",children:s.includes("<div")||s.includes("<span")||s.includes("<br")||s.includes("<code")||s.includes("list-item")?r.jsx("div",{dangerouslySetInnerHTML:{__html:s},className:"formatted-content"}):r.jsx("div",{className:"whitespace-pre-wrap",children:s})}),l&&r.jsx("div",{className:"text-xs mt-2 opacity-75",children:new Date(l).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),"user"===t&&r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 
          bg-indigo-600 text-white ml-3`,children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),r.jsx("circle",{cx:"12",cy:"7",r:"4"})]})})]})},f=e=>e.includes("Error:")||e.includes("I apologize")||e.includes("sorry")?"error":[/\$\d+(\.\d+)?/g,/\d+%/g,/total:/i,/summary:/i,/statistics:/i,/\|\s*[\w\s]+\s*\|/g,/\b(database|query|result)\b/i].some(t=>t.test(e))?"data":(e.match(/\d+\.\s+/g)||[]).length+(e.match(/^\s*[\*\-\•]\s+/gm)||[]).length>3?"list":"conversation",y=e=>e.replace(/\n{2,}/g,"<br><br>").replace(/\n/g," ").replace(/(\d+\.\s+)([^\n]+)/g,'<span class="text-teal-300">$1</span>$2<br>').replace(/^[\*\-\•]\s+([^\n]+)/gm,"• $1<br>").replace(/"([^"]+)"/g,'<span class="text-indigo-300">"$1"</span>').replace(/!(Important|Note|Warning|Tip):/gi,'<strong class="text-yellow-300">$1:</strong>').replace(/`([^`]+)`/g,'<code class="bg-gray-700 rounded px-1 py-0.5 text-sm">$1</code>'),w=e=>e.replace(/\n{2,}/g,"<br><br>").replace(/(\$\d+(\.\d+)?)/g,'<span class="text-green-400 font-medium">$1</span>').replace(/(\d+%)/g,'<span class="text-indigo-300 font-medium">$1</span>').replace(/\n?(#+)\s+([^\n]+)/g,(e,t,s)=>{let r=t.length;return`<div class="font-bold text-${1===r?"xl":2===r?"lg":"md"} my-3 text-teal-300">${s}</div>`}).replace(/(Total:|Summary:|Results:|Statistics:)(\s*[\w\s\$\d\.\,]+)/gi,'<div class="my-2"><span class="text-teal-300 font-medium">$1</span>$2</div>').replace(/`([^`]+)`/g,'<code class="bg-gray-700 rounded px-1 py-0.5 text-sm">$1</code>').replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank" class="text-blue-400 underline">$1</a>'),b=e=>{let t=e.replace(/"list-item">/g,"");if(t.split(/(\d+\.\s+|\*\s+|\-\s+|\•\s+)/).length<=1)return y(t);let s=t.search(/(\d+\.\s+|\*\s+|\-\s+|\•\s+)/),r=s>0?t.substring(0,s):"",a=t.substring(s);return(r?y(r)+"<br><br>":"")+a.replace(/(\d+\.\s+)([^\n]+)/g,'<div class="list-item"><span class="text-teal-300 font-medium">$1</span>$2</div>').replace(/^[\*\-\•]\s+([^\n]+)/gm,'<div class="list-item">$1</div>').replace(/\n/g,"<br>").replace(/"([^"]+)"/g,'<span class="text-indigo-300">"$1"</span>').replace(/!(Important|Note|Warning|Tip):/gi,'<strong class="text-yellow-300">$1:</strong>')},v=e=>`<div class="text-red-400">${e}</div>`,j=e=>{if(!e)return"";let t=e.trim();switch(f(t=(t=t.replace(/"list-item">([^<\n]*)/g,"<li>$1</li>")).replace(/"list-item">\s*-\s*([^<\n]*)/g,"<li>$1</li>"))){case"data":return w(t);case"list":return b(t);case"error":return v(t);default:return y(t)}},N=()=>{let{user:e,loading:t}=(0,o.E)(),[s,n]=(0,a.useState)(""),[i,c]=(0,a.useState)([]),[d,u]=(0,a.useState)(!1),[g,h]=(0,a.useState)([]),[f,y]=(0,a.useState)(null),[w,b]=(0,a.useState)(!0),[v,N]=(0,a.useState)(!1),C=(0,a.useRef)(null);(0,a.useRef)(null);let k=(0,a.useRef)(null);(0,a.useRef)(null),(0,a.useRef)(null);let[S,$]=(0,a.useState)(""),[D,A]=(0,a.useState)({messageCount:0,lastAction:"Initial load"});(0,a.useEffect)(()=>{t||(async()=>{if(!e){h([]),b(!1);return}b(!0);try{let e=await x.A.getChats();h(e),e.length>0&&!f&&(y(e[0].id),c(e[0].messages))}catch(e){console.error("Error loading chats:",e)}finally{b(!1)}})()},[e,t]),(0,a.useEffect)(()=>{$((0,l.Z)()),C.current&&(C.current.scrollTop=C.current.scrollHeight)},[]),(0,a.useEffect)(()=>{if(C.current){let e=setTimeout(()=>{let e=C.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},100);return()=>clearTimeout(e)}},[i,d]),(0,a.useEffect)(()=>{let e=e=>{"/"===e.key&&document.activeElement!==k.current&&(e.preventDefault(),k.current?.focus())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let _=async(t,s)=>{console.log("Attempting to connect to webhook with:",{message:t,sessionId:s});try{let r=await fetch("https://n8n-mybh5-u38603.vm.elestio.app/webhook/AICHAT",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({message:t,sessionId:s,agentId:e?.id||"",timestamp:new Date().toISOString()})});if(console.log("Webhook response status:",r.status),r.status>=200&&r.status<300){let e=await r.json().catch(()=>({}));return console.log("Webhook raw response data:",e),{success:!0,data:e}}{let e=await r.text().catch(()=>"Unknown error");return console.error(`Webhook error: ${r.status}`,e),{success:!1,error:`Webhook error: ${r.status}`,details:e}}}catch(e){return console.error("Webhook connection error:",e),{success:!1,error:"Failed to connect to webhook",details:e.message||"Unknown error occurred"}}},E=async()=>{if(e)try{let e=await x.A.createChat();if(!e){console.error("Failed to create new chat");return}h([e,...g]),y(e.id),c([]),A({messageCount:0,lastAction:"Created new chat"})}catch(e){console.error("Error creating new chat:",e)}},L=async e=>{y(e);let t=g.find(t=>t.id===e);if(t)c(t.messages);else{let t=await x.A.getChat(e);t&&c(t.messages)}A({messageCount:t?.messages.length||0,lastAction:"Selected chat"})},P=async e=>{let t=g.filter(t=>t.id!==e);h(t),f===e&&(t.length>0?(y(t[0].id),c(t[0].messages)):(y(null),c([])));try{if(console.log(`Attempting to delete chat ${e} and its messages...`),await x.A.deleteChat(e))console.log(`Successfully deleted chat ${e}`);else{console.error("Failed to delete chat from Supabase");let t=await x.A.getChats();if(h(t),f===e&&t.some(t=>t.id===e)){y(e);let s=t.find(t=>t.id===e);s&&c(s.messages)}}}catch(e){console.error("Error deleting chat:",e)}},M=async(e,t)=>{await x.A.updateChatTitle(e,t)&&h(g.map(s=>s.id===e?{...s,title:t}:s))},T=async e=>{if(e&&e.preventDefault(),!s.trim())return;if(!f){let e=await x.A.createChat(s);if(e)y(e.id),h([e,...g]);else{console.error("Failed to create new chat");return}}u(!0);let t={role:"user",content:s,timestamp:new Date().toISOString()},r=[...i,t];c(r),await x.A.addMessage(f,t),n(""),A({messageCount:r.length,lastAction:"Added user message"});try{let e=await _(s,S);if(e){let t;if(e.success&&e.data){if("string"==typeof e.data)t=e.data;else if(e.data.response)t=e.data.response;else if(e.data.output)t=e.data.output;else if(e.data.text)t=e.data.text;else if(e.data.message)t=e.data.message;else try{t=JSON.stringify(e.data)}catch(e){t="Received data in an unexpected format."}}else t=e.error?`Error: ${e.error}. ${e.details||""}`:"No readable response received from the assistant.";let a=j(t),l={role:"assistant",content:a,timestamp:new Date().toISOString()},n=[...r,l];if(c(n),await x.A.addMessage(f,l),A({messageCount:n.length,lastAction:"Added assistant response"}),1===r.length){let e=s.length>30?`${s.substring(0,30)}...`:s;await x.A.updateChatTitle(f,e);let t=g.map(t=>t.id===f?{...t,title:e,messages:n}:t);h(t)}else{let e=g.map(e=>e.id===f?{...e,messages:n}:e);h(e)}}}catch(t){console.error("Error sending message to webhook:",t);let e={role:"assistant",content:"I apologize, but I encountered an error while processing your request. Please try again later.",timestamp:new Date().toISOString()};c([...r,e]),await x.A.addMessage(f,e)}finally{u(!1)}},q=async e=>{if(f)try{if(console.log(`Attempting to delete message ${e}...`),await x.A.deleteMessage(e)){console.log(`Successfully deleted message ${e}`);let t=i.filter(t=>t.id!==e);c(t);let s=g.map(t=>t.id===f?{...t,messages:t.messages.filter(t=>t.id!==e)}:t);h(s),A({messageCount:t.length,lastAction:"Deleted message"})}else console.error(`Failed to delete message ${e}`)}catch(e){console.error("Error deleting message:",e)}};return(0,r.jsxs)("div",{className:"h-full flex flex-col bg-gray-900 text-white",children:[!1,(0,r.jsxs)("div",{className:"flex flex-grow overflow-hidden",children:[r.jsx("div",{className:"w-64 border-r border-gray-800 hidden lg:block overflow-hidden",children:r.jsx(m,{chats:g,activeChat:f,onChatSelect:L,onNewChat:E,onDeleteChat:P,onUpdateChatTitle:M})}),(0,r.jsxs)("div",{className:"flex-grow flex flex-col overflow-hidden",children:[(0,r.jsxs)("div",{className:"lg:hidden bg-gray-800 p-4 flex items-center border-b border-gray-700",children:[r.jsx("button",{onClick:()=>N(!0),className:"p-2 mr-2 rounded hover:bg-gray-700 transition-colors",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),r.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),r.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})}),r.jsx("h1",{className:"text-xl font-semibold",children:"LegacyChat"})]}),r.jsx("div",{className:"flex-grow overflow-y-auto",ref:C,children:0===i.length?(0,r.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:r.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),r.jsx("h3",{className:"text-xl font-bold mb-2",children:"Welcome to LegacyChat"}),r.jsx("p",{className:"text-gray-400 max-w-md",children:"Ask me anything about insurance, policies, or how I can assist you with your clients."})]}):(0,r.jsxs)("div",{children:[i.map((e,t)=>r.jsx(p,{id:e.id,role:e.role,content:e.content,timestamp:e.timestamp,onDelete:q},`${f}-${t}`)),d&&(0,r.jsxs)("div",{className:"px-4 py-3 flex justify-start",children:[r.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 bg-teal-600 text-white mr-3",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),r.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),r.jsx("circle",{cx:"15.5",cy:"8.5",r:"1.5"}),r.jsx("path",{d:"M8.5 14a4 4 0 0 0 7 0"})]})}),r.jsx("div",{className:"max-w-[75%] bg-gray-800 text-gray-100 rounded-lg px-4 py-3 shadow-md",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("div",{className:"typing-indicator",children:[r.jsx("span",{className:"typing-dot"}),r.jsx("span",{className:"typing-dot"}),r.jsx("span",{className:"typing-dot"})]}),r.jsx("span",{children:"Thinking..."})]})})]})]})}),r.jsx("div",{className:"border-t border-gray-800 p-4",children:(0,r.jsxs)("form",{onSubmit:T,className:"flex items-end gap-2",children:[r.jsx("div",{className:"flex-grow relative",children:r.jsx("textarea",{value:s,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),T())},placeholder:"Type your message...",rows:1,className:"w-full p-3 bg-gray-800 rounded-lg border border-gray-700 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 text-white resize-none"})}),r.jsx("button",{type:"submit",disabled:d||!s.trim(),className:`p-3 rounded-lg ${d||!s.trim()?"bg-gray-800 text-gray-600 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"} transition-colors`,children:d?(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),r.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]})})]})})]}),v&&(0,r.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden",children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:()=>N(!1)}),r.jsx("div",{className:"fixed inset-y-0 left-0 w-64 bg-gray-800 z-50 shadow-xl",children:r.jsx(m,{chats:g,activeChat:f,onChatSelect:e=>{L(e),N(!1)},onNewChat:()=>{E(),N(!1)},onDeleteChat:P,onUpdateChatTitle:M})})]})]})]})}},72239:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(10326);s(17577);var a=s(37711),l=s(35047),n=s(34009);function o({children:e}){let{role:t,loading:s}=(0,n.q)();return s?r.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):"agent"!==t&&"admin"!==t&&"manager"!==t?(console.log("AgentLayout: Unauthorized role, redirecting to login"),(0,l.redirect)("/login"),null):r.jsx(a.M,{children:r.jsx("div",{className:"h-full",children:e})})}},58234:(e,t,s)=>{"use strict";s.d(t,{E:()=>l});var r=s(17577),a=s(69701);let l=()=>{let[e,t]=(0,r.useState)(null),[s,l]=(0,r.useState)(null),[n,o]=(0,r.useState)(!0),i=(0,a.e)();return(0,r.useEffect)(()=>{(async()=>{let{data:{session:e}}=await i.auth.getSession();l(e),t(e?.user||null),o(!1)})();let{data:{subscription:e}}=i.auth.onAuthStateChange((e,s)=>{l(s),t(s?.user||null),o(!1)});return()=>{e.unsubscribe()}},[i]),{user:e,session:s,loading:n}}},78012:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var r=s(69701);let a=[{id:(0,s(22665).Z)(),title:"Demo Chat (Database Setup Required)",messages:[{role:"assistant",content:"Welcome to the AI chat! This is a demo chat because your database tables need to be set up. Please run the migrations to enable full functionality.",timestamp:new Date().toISOString()}],createdAt:new Date().toISOString()}],l=(0,r.e)(),n=e=>e&&("42P01"===e.code||e.message?.includes("does not exist")||e.message?.toLowerCase().includes("relation")&&e.message?.toLowerCase().includes("does not exist")),o={async getChats(){try{let{data:e,error:t}=await l.from("chats").select("*").order("created_at",{ascending:!1});if(t){if(console.error("Error fetching chats:",t),n(t))return console.log("Chats table does not exist, returning mock data"),a;return[]}return await Promise.all(e.map(async e=>{try{let{data:t,error:s}=await l.from("messages").select("*").eq("chat_id",e.id).order("created_at",{ascending:!0});if(s)return console.error(`Error fetching messages for chat ${e.id}:`,s),{id:e.id,title:e.title,messages:[],createdAt:e.created_at};return{id:e.id,title:e.title,messages:t.map(e=>({role:e.role,content:e.content,timestamp:e.created_at})),createdAt:e.created_at}}catch(t){return console.error(`Error processing chat ${e.id}:`,t),{id:e.id,title:e.title,messages:[],createdAt:e.created_at}}}))}catch(e){return console.error("Unexpected error in getChats:",e),a}},async createChat(e=""){try{let t=e?e.substring(0,30)+(e.length>30?"...":""):`New chat ${new Date().toLocaleDateString()}`,{data:s}=await l.auth.getUser(),r=s?.user?.id;if(!r)return console.error("No user ID found"),null;let{data:o,error:i}=await l.from("chats").insert({title:t,user_id:r}).select().single();if(i){if(console.error("Error creating chat:",i),n(i))return console.log("Chats table does not exist, returning mock chat"),a[0];return null}return{id:o.id,title:o.title,messages:[],createdAt:o.created_at}}catch(e){return console.error("Unexpected error in createChat:",e),a[0]}},async getChat(e){try{if(a.some(t=>t.id===e))return a.find(t=>t.id===e)||null;let{data:t,error:s}=await l.from("chats").select("*").eq("id",e).single();if(s){if(console.error(`Error fetching chat ${e}:`,s),n(s))return console.log("Chats table does not exist, returning mock chat"),a[0];return null}try{let{data:s,error:r}=await l.from("messages").select("*").eq("chat_id",e).order("created_at",{ascending:!0});if(r)return console.error(`Error fetching messages for chat ${e}:`,r),n(r),{id:t.id,title:t.title,messages:[],createdAt:t.created_at};return{id:t.id,title:t.title,messages:s.map(e=>({role:e.role,content:e.content,timestamp:e.created_at})),createdAt:t.created_at}}catch(s){return console.error(`Error processing messages for chat ${e}:`,s),{id:t.id,title:t.title,messages:[],createdAt:t.created_at}}}catch(e){return console.error("Unexpected error in getChat:",e),a[0]}},async addMessage(e,t){try{if(a.some(t=>t.id===e))return console.log("Mock chat detected, simulating successful message add"),!0;let{error:s}=await l.from("messages").insert({chat_id:e,role:t.role,content:t.content,created_at:t.timestamp||new Date().toISOString()});if(s)return console.error(`Error adding message to chat ${e}:`,s),!1;let{error:r}=await l.from("chats").update({updated_at:new Date().toISOString()}).eq("id",e);return r&&console.error(`Error updating chat timestamp for ${e}:`,r),!0}catch(e){return console.error("Unexpected error in addMessage:",e),!1}},async deleteChat(e){try{if(a.some(t=>t.id===e))return console.log("Mock chat detected, simulating successful deletion"),!0;let{error:t,count:s}=await l.from("messages").delete().eq("chat_id",e);t?console.error(`Error deleting messages for chat ${e}:`,t):console.log(`Successfully deleted ${s} messages for chat ${e}`);let{error:r}=await l.from("chats").delete().eq("id",e);if(r)return console.error(`Error deleting chat ${e}:`,r),!1;return console.log(`Successfully deleted chat ${e}`),!0}catch(e){return console.error("Unexpected error in deleteChat:",e),!1}},async updateChatTitle(e,t){try{if(a.some(t=>t.id===e))return console.log("Mock chat detected, simulating successful title update"),!0;let{error:s}=await l.from("chats").update({title:t,updated_at:new Date().toISOString()}).eq("id",e);if(s)return console.error(`Error updating title for chat ${e}:`,s),!1;return!0}catch(e){return console.error("Unexpected error in updateChatTitle:",e),!1}},async deleteMessage(e){try{if(a.some(t=>t.messages.some(t=>t.id===e)))return console.log("Mock message detected, simulating successful deletion"),!0;let{error:t}=await l.from("messages").delete().eq("id",e);if(t)return console.error(`Error deleting message ${e}:`,t),!1;return console.log(`Successfully deleted message ${e}`),!0}catch(e){return console.error("Unexpected error in deleteMessage:",e),!1}}}},45281:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>l,default:()=>o});var r=s(68570);let a=(0,r.createProxy)(String.raw`C:\Users\Ronel\Downloads\New folder (5)\legacycore\legacy-core\src\app\agent\ai-chat\page.tsx`),{__esModule:l,$$typeof:n}=a;a.default;let o=(0,r.createProxy)(String.raw`C:\Users\Ronel\Downloads\New folder (5)\legacycore\legacy-core\src\app\agent\ai-chat\page.tsx#default`)},1409:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>l,default:()=>o});var r=s(68570);let a=(0,r.createProxy)(String.raw`C:\Users\Ronel\Downloads\New folder (5)\legacycore\legacy-core\src\app\agent\layout.tsx`),{__esModule:l,$$typeof:n}=a;a.default;let o=(0,r.createProxy)(String.raw`C:\Users\Ronel\Downloads\New folder (5)\legacycore\legacy-core\src\app\agent\layout.tsx#default`)},24879:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,3841,9813,224,6256,9344,7711],()=>s(91713));module.exports=r})();