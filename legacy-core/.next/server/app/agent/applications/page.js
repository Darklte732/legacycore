(()=>{var e={};e.id=7414,e.ids=[7414],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},46145:e=>{"use strict";e.exports=require("@supabase/supabase-js")},14300:e=>{"use strict";e.exports=require("buffer")},39637:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>p,pages:()=>d,routeModule:()=>u,tree:()=>c}),s(42179),s(97996),s(1409),s(48385),s(12523);var a=s(23191),i=s(88716),l=s(37922),n=s.n(l),r=s(95231),o={};for(let e in r)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>r[e]);s.d(t,o);let c=["",{children:["agent",{children:["applications",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,42179)),"C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\agent\\applications\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,97996)),"C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\agent\\applications\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,1409)),"C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\agent\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,48385)),"C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,12523)),"C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\not-found.tsx"]}],d=["C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\agent\\applications\\page.tsx"],p="/agent/applications/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/agent/applications/page",pathname:"/agent/applications",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},27681:(e,t,s)=>{Promise.resolve().then(s.bind(s,26296))},58408:(e,t,s)=>{Promise.resolve().then(s.bind(s,72239))},35303:()=>{},24230:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(76557).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},31540:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(76557).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},63685:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(76557).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},20544:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(76557).Z)("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]])},91470:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(76557).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},26296:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>es});var a=s(10326);s(65408);var i=s(17577),l=s(35047),n=s(79332),r=s(29752),o=s(91664),c=s(50384),d=s(18986),p=s(54659),m=s(87888),u=s(32933),h=s(31540),_=s(76557);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,_.Z)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),y=(0,_.Z)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);var x=s(83855);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let g=(0,_.Z)("UploadCloud",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m16 16-4-4-4 4",key:"119tzi"}]]);var v=s(24230),j=s(20544),b=s(91470),w=s(75290),N=s(63685),S=s(56019),P=s(38978),k=s(69701),C=s(56627),$=s(38227),A=s(24118),D=s(82015),I=s(41156),E=s(82631),M=s(93095),R=s(77335),Z="Progress",[U,O]=(0,M.b)(Z),[Q,q]=U(Z),z=i.forwardRef((e,t)=>{var s,i;let{__scopeProgress:l,value:n=null,max:r,getValueLabel:o=L,...c}=e;(r||0===r)&&!Y(r)&&console.error((s=`${r}`,`Invalid prop \`max\` of value \`${s}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let d=Y(r)?r:100;null===n||W(n,d)||console.error((i=`${n}`,`Invalid prop \`value\` of value \`${i}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let p=W(n,d)?n:null,m=V(p)?o(p,d):void 0;return(0,a.jsx)(Q,{scope:l,value:p,max:d,children:(0,a.jsx)(R.WV.div,{"aria-valuemax":d,"aria-valuemin":0,"aria-valuenow":V(p)?p:void 0,"aria-valuetext":m,role:"progressbar","data-state":B(p,d),"data-value":p??void 0,"data-max":d,...c,ref:t})})});z.displayName=Z;var F="ProgressIndicator",T=i.forwardRef((e,t)=>{let{__scopeProgress:s,...i}=e,l=q(F,s);return(0,a.jsx)(R.WV.div,{"data-state":B(l.value,l.max),"data-value":l.value??void 0,"data-max":l.max,...i,ref:t})});function L(e,t){return`${Math.round(e/t*100)}%`}function B(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function V(e){return"number"==typeof e}function Y(e){return V(e)&&!isNaN(e)&&e>0}function W(e,t){return V(e)&&!isNaN(e)&&e<=t&&e>=0}T.displayName=F;var G=s(51223);let H=i.forwardRef(({className:e,value:t,...s},i)=>a.jsx(z,{ref:i,className:(0,G.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...s,children:a.jsx(T,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));H.displayName=z.displayName;var X=s(29280),J=s(44794),K=s(64719),ee=s(1012);let et=()=>(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx($.O,{className:"h-8 w-48"}),a.jsx($.O,{className:"h-8 w-24"})]}),a.jsx("div",{className:"space-y-2",children:[,,,,,].fill(0).map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between border-b pb-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx($.O,{className:"h-4 w-64"}),a.jsx($.O,{className:"h-3 w-32"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[a.jsx($.O,{className:"h-6 w-24"}),a.jsx($.O,{className:"h-6 w-6 rounded-full"})]})]},t))})]});function es(){let[e,t]=(0,i.useState)([]),[s,_]=(0,i.useState)(!0),[$,M]=(0,i.useState)("all"),R=(0,l.useRouter)(),{toast:Z}=(0,C.pm)(),U=(0,k.e)(),[O,Q]=(0,i.useState)(""),[q,z]=(0,i.useState)([]),[F,T]=(0,i.useState)(""),[L,B]=(0,i.useState)(!1),[V,Y]=(0,i.useState)(!1),[W,G]=(0,i.useState)("paste"),[es,ea]=(0,i.useState)(null),[ei,el]=(0,i.useState)(0),[en,er]=(0,i.useState)({}),[eo,ec]=(0,i.useState)([]),[ed,ep]=(0,i.useState)(!1),[em,eu]=(0,i.useState)(0),[eh,e_]=(0,i.useState)(0),[ef,ey]=(0,i.useState)(!1),[ex,eg]=(0,i.useState)([]),[ev,ej]=(0,i.useState)(!1),[eb,ew]=(0,i.useState)(null),[eN,eS]=(0,i.useState)({}),[eP,ek]=(0,i.useState)({}),[eC,e$]=(0,i.useState)(!1),[eA,eD]=(0,i.useState)(!1),[eI,eE]=(0,i.useState)({}),[eM,eR]=(0,i.useState)(""),[eZ,eU]=(0,i.useState)(!1),eO=(0,i.useRef)(!1),eQ=()=>{let t=e.length,s=e.filter(e=>"Approved"===e.status).length;return{totalPolicies:t,approvedPolicies:s,needsAttentionPolicies:e.filter(e=>"Needs Attention"===e.policy_health).length,paidPolicies:e.filter(e=>("Approved"===e.status||"Live"===e.status||"1st Month Paid"===e.status)&&"Paid"===e.paid_status).length,totalAnnualPremium:e.reduce((e,t)=>e+12*("number"==typeof t.monthly_premium?t.monthly_premium:parseFloat(t.monthly_premium||"0")),0)}};async function eq(){try{_(!0),console.log("Starting to fetch applications...");let{data:{session:e}}=await U.auth.getSession();if(console.log("Session information:",e?{id:e.user?.id,email:e.user?.email,isAuthenticated:!!e}:"No session found"),!e&&eO.current){Z({title:"Session expired",description:"Your session has expired. Please refresh the page to log in again.",variant:"destructive"}),_(!1);return}if(e)eO.current=!0;else{Z({title:"Authentication required",description:"Please log in to view your applications.",variant:"destructive"}),_(!1);return}console.log("Fetching applications from Supabase..."),console.log("Using agent_id:",e.user.id),console.log("Checking available tables in database...");let{data:s,error:a}=await U.from("agent_applications").select("*").eq("agent_id",e.user.id).order("created_at",{ascending:!1});if(a){console.error("Error fetching from agent_applications:",a),Z({title:"Error fetching applications",description:a.message,variant:"destructive"}),_(!1);return}if(s&&s.length>0){console.log(`✅ Table agent_applications exists and contains data for this agent.`),console.log(`✅ Successfully loaded ${s.length} applications from agent_applications table.`);let e=s.map(e=>{if(e.commission_amount&&"number"==typeof e.commission_amount&&e.commission_amount>0)return e;let t=0,s=0;e.ap&&e.ap>0?s="number"==typeof e.ap?e.ap:parseFloat(e.ap):e.monthly_premium?(t="number"==typeof e.monthly_premium?e.monthly_premium:parseFloat(e.monthly_premium),s=12*t):e.premium&&(t="number"==typeof e.premium?e.premium:parseFloat(e.premium||"0"),s=12*t);let a=e.split_percentage||20,i=(100-a)/100*s;return!isNaN(i)&&i>0?{...e,commission_amount:i}:e});t(e),console.log("Loaded applications from database with commission calculations:",e)}else console.log("No applications found for this agent."),t([]);console.log("All loaded applications:",s)}catch(e){console.error("Error fetching applications:",e),Z({title:"Error loading applications",description:e.message||"An unexpected error occurred",variant:"destructive"})}finally{_(!1)}}let ez=e.filter(e=>{if("all"===$)return!0;let t=(e.status||"").toLowerCase(),s=(e.paid_status||"").toLowerCase();(e.commission_status||"").toLowerCase();let a=(e.notes||"").toLowerCase(),i=(e.policy_health||"").toLowerCase();switch($){case"approved":return t.includes("approved");case"pending-first-payment":return"pending first payment"===i||i.includes("pending first")||i.includes("first payment")||t.includes("approved")&&s.includes("unpaid")&&!i.includes("active");case"pending-payment":return t.includes("approved")&&(s.includes("unpaid")||!s)&&"pending first payment"!==i;case"paid-issued":return s.includes("paid")&&(t.includes("live")||t.includes("approved")||t.includes("issued")||t.includes("1st month"))&&!t.includes("not")&&!t.includes("cancel")&&"pending first payment"!==i;case"needs-attention":return i.includes("needs attention");case"not-taken":return t.includes("not taken")||t.includes("not-taken");case"cancelled":return t.includes("cancel")||t.includes("cancella")||a.includes("cancel")||e.commission_status?.toLowerCase().includes("cancel")||a.includes("return")||a.includes("nsf")||a.includes("insuffic")||a.includes("funds")||a.includes("draft return");default:return!0}}),eF=e=>{let t=e.trim().split(/[\r\n]+/);if(t.length<2)return!1;let s=(t[0].match(/\t/g)||[]).length,a=t.length>1?(t[1].match(/\t/g)||[]).length:0;return s>0&&s===a},eT=(e,t)=>{let s={"proposed insured":"proposed_insured",proposed_insured:"proposed_insured","client name":"proposed_insured",client_name:"proposed_insured","customer name":"proposed_insured",customer_name:"proposed_insured","insured name":"proposed_insured",insured_name:"proposed_insured",name:"proposed_insured","full name":"proposed_insured",full_name:"proposed_insured",client:"proposed_insured",insured:"proposed_insured","client phone number":"client_phone_number",client_phone_number:"client_phone_number","phone number":"client_phone_number",phone_number:"client_phone_number",phone:"client_phone_number",telephone:"client_phone_number",cell:"client_phone_number",mobile:"client_phone_number",contact:"client_phone_number","client email":"client_email",client_email:"client_email",email:"client_email","e-mail":"client_email",e_mail:"client_email",mail:"client_email","client state":"client_state",client_state:"client_state",state:"client_state",province:"client_state",st:"client_state",month:"month",mo:"month",mth:"month","policy submit date":"policy_submit_date",policy_submit_date:"policy_submit_date","submit date":"policy_submit_date","submission date":"policy_submit_date","application date":"policy_submit_date","date submitted":"policy_submit_date",date_submitted:"policy_submit_date",submitted:"policy_submit_date","policy #":"policy_number","policy#":"policy_number","policy no":"policy_number","policy number":"policy_number",policy_number:"policy_number","policy id":"policy_number",policy_id:"policy_number","policy num":"policy_number",policy_num:"policy_number",carrier:"carrier",company:"carrier",provider:"carrier",insurer:"carrier","insurance company":"carrier","carrier name":"carrier",carrier_name:"carrier",product:"product","policy type":"product",policy_type:"product","insurance type":"product",insurance_type:"product",plan:"product","coverage type":"product",coverage_type:"product","monthly premium":"monthly_premium",monthly_premium:"monthly_premium","premium monthly":"monthly_premium",premium_monthly:"monthly_premium",monthly:"monthly_premium","mo premium":"monthly_premium",mo_premium:"monthly_premium",ap:"ap","annual premium":"ap",annual_premium:"ap","yearly premium":"ap",yearly_premium:"ap","premium annual":"ap",premium_annual:"ap",annual:"ap",yearly:"ap",status:"status","application status":"status",application_status:"status","policy status":"status",policy_status:"status","current status":"status",current_status:"status","paid status":"paid_status",paid_status:"paid_status","payment status":"paid_status",payment_status:"paid_status",paid:"paid_status","closed by agent":"closed_by_agent",closed_by_agent:"closed_by_agent","agent closed":"closed_by_agent","closed by":"closed_by_agent",closed_by:"closed_by_agent","point of sale":"point_of_sale",point_of_sale:"point_of_sale",pos:"point_of_sale","sale location":"point_of_sale",sale_location:"point_of_sale","pms form filled out":"pms_form_filled_out",pms_form_filled_out:"pms_form_filled_out","pms form":"pms_form_filled_out",pms_form:"pms_form_filled_out","split with":"split_with",split_with:"split_with","agent split":"split_with",agent_split:"split_with","shared with":"split_with",shared_with:"split_with",split:"split_with","effective policy date":"effective_policy_date",effective_policy_date:"effective_policy_date","effective date":"effective_policy_date",effective_date:"effective_policy_date","start date":"effective_policy_date",start_date:"effective_policy_date","policy start date":"effective_policy_date",policy_start_date:"effective_policy_date","effective policy status":"effective_policy_status",effective_policy_status:"effective_policy_status",notes:"notes",comments:"notes",remarks:"notes","notes for pay":"notes_for_pay",notes_for_pay:"notes_for_pay","payment notes":"notes_for_pay",payment_notes:"notes_for_pay","paid split":"paid_split",paid_split:"paid_split","paid split?":"paid_split","commission status":"commission_status",commission_status:"commission_status","comm status":"commission_status",comm_status:"commission_status","commission paid date":"commission_paid_date",commission_paid_date:"commission_paid_date","comm paid date":"commission_paid_date",comm_paid_date:"commission_paid_date","commission amount":"commission_amount",commission_amount:"commission_amount","comm amount":"commission_amount",comm_amount:"commission_amount","payment cycle":"policy_payment_cycle",payment_cycle:"policy_payment_cycle","policy payment cycle":"policy_payment_cycle",policy_payment_cycle:"policy_payment_cycle"},a={};t.forEach(e=>{a[e]="unmapped"}),t.forEach(e=>{let t=e.toLowerCase().trim();if(s[t]){a[e]=s[t];return}for(let[i,l]of Object.entries(s))if(t.includes(i)){a[e]=l;return}t.includes("phone")?a[e]="client_phone_number":t.includes("email")?a[e]="client_email":t.includes("state")?a[e]="client_state":t.includes("policy")&&(t.includes("num")||t.includes("#"))?a[e]="policy_number":t.includes("premium")&&!t.includes("annual")?a[e]="monthly_premium":t.includes("premium")&&t.includes("annual")?a[e]="ap":t.includes("notes")&&!t.includes("pay")&&(a[e]="notes")}),console.log("Auto-mapped columns:",a),er(a)};async function eL(){Y(!0),el(0),eg([]);try{if(0===Object.keys(en).length){T("Please map at least one column before importing"),Y(!1);return}if(!q||0===q.length){T("No data to import"),Y(!1);return}let{data:{session:e}}=await U.auth.getSession();if(!e){T("You must be logged in to import data"),Y(!1);return}let t=e=>{if(null==e||""===e)return null;if("number"==typeof e)return e;if("string"==typeof e){let t=e.replace(/[$,]/g,"").trim();if(!t)return null;let s=parseFloat(t);return isNaN(s)?null:s}return null},s=e=>{if(!e)return null;try{if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}/.test(e))return e.split("T")[0];if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(e)){let[t,s,a]=e.split("/").map(e=>parseInt(e,10));return`${a}-${t.toString().padStart(2,"0")}-${s.toString().padStart(2,"0")}`}if(/^\d{1,2}-\d{1,2}-\d{4}$/.test(e)){let[t,s,a]=e.split("-").map(e=>parseInt(e,10));return`${a}-${t.toString().padStart(2,"0")}-${s.toString().padStart(2,"0")}`}let t=new Date(e);return isNaN(t.getTime())?null:t.toISOString().split("T")[0]}if(e instanceof Date)return e.toISOString().split("T")[0]}catch(t){console.error("Date conversion error:",t,"for value:",e)}return null},a=e=>{if("boolean"==typeof e)return e;if("string"==typeof e){let t=e.trim().toLowerCase();return["yes","true","y","1","on","checked"].includes(t)}return"number"==typeof e&&1===e};console.log("Processing bulk data import for",q.length,"records");let i=q.map((i,l)=>{let n={agent_id:e.user.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return Object.entries(en).forEach(([e,l])=>{if("unmapped"!==l){let r=i[e];if(null!=r)switch(l){case"pms_form_filled_out":n[l]=a(r);break;case"monthly_premium":case"ap":case"commission_amount":n[l]=t(r);break;case"policy_submit_date":case"effective_policy_date":case"commission_paid_date":n[l]=s(r);break;default:if("string"==typeof r){let e=r.trim();n[l]=""===e?null:e}else void 0!==r&&(n[l]=String(r))}}}),(!n.commission_amount||0===n.commission_amount)&&n.monthly_premium&&n.monthly_premium>0&&(n.commission_amount=4.5*n.monthly_premium,console.log(`Auto-calculated commission for record ${l+1}: $${n.commission_amount.toFixed(2)} from premium $${n.monthly_premium}`)),n}),l=[],n=[];if(i.forEach((e,t)=>{let s=[];e.proposed_insured||s.push("Client name (Proposed Insured) is required"),e.client_phone_number||s.push("Client phone number is required"),e.carrier||e.carrier_id||s.push("Carrier information is required"),e.product||s.push("Product/Policy type is required"),s.length>0?n.push(`Row ${t+2}: ${s.join(", ")}`):l.push(e)}),0===l.length){T("No valid records to import. Please check the validation errors and try again."),ey(!1),Y(!1);return}console.log(`Validated ${l.length} records out of ${i.length}`);let r=[];for(let e=0;e<l.length;e+=5)r.push(l.slice(e,e+5));console.log(`Processing ${r.length} batches with batch size 5`);let o=0,c=0,d=[...n];for(let e=0;e<r.length;e++){let t=r[e];try{console.log(`Processing batch ${e+1} with ${t.length} records`);let{data:s,error:a}=await U.from("agent_applications").insert(t).select("id");a?(console.error(`Batch ${e+1} error:`,a),c+=t.length,d.push(`Batch ${e+1} error: ${a.message||"Unknown database error"}`)):(console.log(`Batch ${e+1} success:`,s),o+=s.length,d.push(`Batch ${e+1}: Successfully imported ${s.length} records`))}catch(s){console.error(`Exception in batch ${e+1}:`,s),c+=t.length,d.push(`Batch ${e+1} error: ${s.message||"Unknown error"}`)}let s=Math.round((e+1)/r.length*100);el(s),eg(d),await new Promise(e=>setTimeout(e,300))}ey(!0),Y(!1),el(100),eg(d),o>0?c>0?T(`Partial success: ${o} records imported, ${c} failed. See details below.`):(T(null),Z({title:"Import successful",description:`Successfully imported all ${o} records.`}),B(!1),Q(""),z([]),er({}),ep(!1),eq()):T(`Import failed: All ${c} records failed to import. See details below.`)}catch(e){console.error("Unexpected error during import:",e),T(`Import failed: ${e.message||"Unknown error"}`),ey(!1),Y(!1),el(0),eg([`System error: ${e.message||"Unknown error"}`])}finally{Y(!1)}}let eB=S.z.map(e=>"actions"===e.id?{...e,cell:({row:e})=>{let t=e.original;return(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsxs)(o.z,{variant:"outline",size:"sm",className:"h-8 px-3 text-xs bg-blue-50 border-blue-200 text-blue-600 hover:bg-blue-100",onClick:()=>{console.log("Navigating to edit page for application:",t.id),window.location.href=`/agent/applications/${t.id}/edit`},children:[a.jsx(f,{className:"h-3.5 w-3.5 mr-1.5"}),"Edit"]}),(0,a.jsxs)(o.z,{variant:"outline",size:"sm",className:"h-8 px-3 text-xs text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200",onClick:()=>eV(t.id),disabled:eZ,children:[a.jsx(y,{className:"h-3.5 w-3.5 mr-1.5"}),"Delete"]}),a.jsx(K.c,{applicationId:t.id})]})}}:e),eV=async e=>{if(e)try{eU(!0);let{data:{session:s},error:a}=await U.auth.getSession();if(a){console.error("Error getting session:",a),Z({title:"Authentication Error",description:"Unable to verify your session. Please refresh the page and try again.",variant:"destructive"}),eU(!1);return}if(!s){Z({title:"Authentication Error",description:"You must be logged in to delete applications. Please refresh the page and try again.",variant:"destructive"}),eU(!1);return}if(!window.confirm("Are you sure you want to delete this application?")){eU(!1);return}console.log(`Attempting to delete application: ${e}`);try{let{error:s}=await U.from("agent_applications").delete().eq("id",e);if(s)throw console.log("Direct delete failed, falling back to API:",s.message),Error("Direct delete failed");console.log("Application deleted successfully via direct RLS access"),t(t=>t.filter(t=>t.id!==e)),Z({title:"Success",description:"Application deleted successfully"});return}catch(e){console.log("Falling back to API route for deletion")}let i=await fetch("/api/applications/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({applicationId:e,userId:s.user.id}),credentials:"include"});if(!i.ok){if(401===i.status){Z({title:"Session Expired",description:"Your session has expired. Please refresh the page to log in again.",variant:"destructive"});return}if(403===i.status){Z({title:"Permission Denied",description:"You do not have permission to delete this application.",variant:"destructive"});return}let e=await i.json();throw Error(e.error||"Failed to delete application")}let l=await i.json();l.success?(t(t=>t.filter(t=>t.id!==e)),Z({title:"Success",description:"Application deleted successfully"})):(console.error("Error deleting application:",l.error),Z({title:"Error",description:l.error||"Failed to delete application",variant:"destructive"}))}catch(e){console.error("Error deleting application:",e),Z({title:"Error",description:e.message||"An unexpected error occurred",variant:"destructive"})}finally{eU(!1)}};return a.jsx(E.pn,{children:(0,a.jsxs)("div",{className:"container mx-auto py-6 space-y-6",children:[a.jsx("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"My Insurance Applications"}),a.jsx("p",{className:"text-muted-foreground",children:"Manage your insurance applications and payment history"})]})}),!s&&a.jsx(()=>{let e=eQ();return a.jsx("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[a.jsx(r.Zb,{className:"stat-card total card-hover-effect",children:a.jsx(r.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"stat-info",children:[a.jsx("p",{className:"stat-label",children:"Total Policies"}),a.jsx("h3",{className:"stat-value",children:e.totalPolicies})]}),a.jsx("div",{className:"stat-icon",children:a.jsx(d.Z,{className:"h-6 w-6"})})]})})}),a.jsx(r.Zb,{className:"stat-card approved card-hover-effect",children:a.jsx(r.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"stat-info",children:[a.jsx("p",{className:"stat-label",children:"Approved"}),a.jsx("h3",{className:"stat-value",children:e.approvedPolicies})]}),a.jsx("div",{className:"stat-icon",children:a.jsx(p.Z,{className:"h-6 w-6"})})]})})}),a.jsx(r.Zb,{className:"stat-card attention card-hover-effect",children:a.jsx(r.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"stat-info",children:[a.jsx("p",{className:"stat-label",children:"Needs Attention"}),a.jsx("h3",{className:"stat-value",children:e.needsAttentionPolicies})]}),a.jsx("div",{className:"stat-icon",children:a.jsx(m.Z,{className:"h-6 w-6"})})]})})}),a.jsx(r.Zb,{className:"stat-card paid card-hover-effect",children:a.jsx(r.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"stat-info",children:[a.jsx("p",{className:"stat-label",children:"Paid Policies"}),a.jsx("h3",{className:"stat-value",children:e.paidPolicies})]}),a.jsx("div",{className:"stat-icon",children:a.jsx(u.Z,{className:"h-6 w-6"})})]})})}),a.jsx(r.Zb,{className:"stat-card premium card-hover-effect",children:a.jsx(r.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"stat-info",children:[a.jsx("p",{className:"stat-label",children:"Annual Premium"}),(0,a.jsxs)("h3",{className:"stat-value",children:["$",e.totalAnnualPremium.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),a.jsx("div",{className:"stat-icon",children:a.jsx(h.Z,{className:"h-6 w-6"})})]})})})]})})},{}),a.jsx(P.tE,{}),(0,a.jsxs)("div",{className:"h-full flex flex-col overflow-hidden",children:[a.jsx(r.Zb,{className:"mb-4",children:a.jsx(r.Ol,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("div",{}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(o.z,{onClick:()=>R.push("/agent/applications/new"),className:"flex items-center gap-2",children:[a.jsx(x.Z,{className:"h-4 w-4"})," New Application"]}),(0,a.jsxs)(A.Vq,{open:L,onOpenChange:B,children:[a.jsx(A.hg,{asChild:!0,children:a.jsx(o.z,{variant:"outline",children:"Bulk Add Applications"})}),(0,a.jsxs)(A.cZ,{className:"w-[90vw] max-h-[85vh] max-w-[1000px] overflow-auto bg-background border shadow-lg p-4",style:{backgroundColor:"white"},children:[(0,a.jsxs)(A.fK,{children:[a.jsx(A.$N,{children:"Bulk Add Applications"}),a.jsx(A.Be,{children:"Import multiple applications at once from a spreadsheet or CSV file."})]}),ef?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-10",children:[a.jsx("div",{className:"mb-4 rounded-full bg-green-100 p-3",children:a.jsx(p.Z,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-semibold",children:"Import Successful"}),a.jsx("p",{className:"text-center text-muted-foreground mt-2",children:"Your applications have been imported successfully."}),ex.length>0&&(0,a.jsxs)("div",{className:"mt-4 max-h-[200px] overflow-auto border rounded p-3 text-sm w-full",children:[a.jsx("h4",{className:"font-medium mb-2",children:"Import Details:"}),a.jsx("ul",{className:"list-disc pl-5 space-y-1",children:ex.map((e,t)=>a.jsx("li",{className:e.includes("error")?"text-red-600":"text-green-600",children:e},t))})]}),a.jsx(o.z,{className:"mt-6",onClick:()=>{B(!1),Q(""),z([]),T(""),ep(!1),G("paste"),ea(null),el(0),er({}),ec([]),eu(0),e_(0),ey(!1),eg([])},children:"Close"})]}):V&&ei>0?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-10",children:[a.jsx(H,{value:ei,className:"w-full max-w-md mb-4"}),(0,a.jsxs)("p",{className:"text-center text-sm text-muted-foreground",children:["Importing your applications... ",ei,"%"]})]}):ed?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mt-4 mb-6",children:[a.jsx("h3",{className:"text-lg font-medium mb-2",children:"Map Your Columns"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mb-4",children:["We've found ",q.length," rows. Please match each column to the appropriate field in our system."]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3 mb-4",children:[(0,a.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>{if(!q||0===q.length){T("No data available to map");return}let e={"proposed insured":"proposed_insured",proposed_insured:"proposed_insured","client name":"proposed_insured","customer name":"proposed_insured","full name":"proposed_insured",name:"proposed_insured",client:"proposed_insured",insured:"proposed_insured","client phone":"client_phone_number","client phone number":"client_phone_number",client_phone_number:"client_phone_number","phone number":"client_phone_number",phone:"client_phone_number",contact:"client_phone_number",mobile:"client_phone_number",cell:"client_phone_number","client email":"client_email",client_email:"client_email",email:"client_email","e-mail":"client_email","client state":"client_state",client_state:"client_state",state:"client_state",st:"client_state",month:"month",mth:"month",mo:"month","policy submit date":"policy_submit_date",policy_submit_date:"policy_submit_date","submit date":"policy_submit_date","date submitted":"policy_submit_date","submission date":"policy_submit_date","application date":"policy_submit_date","policy number":"policy_number",policy_number:"policy_number","policy #":"policy_number","policy#":"policy_number","policy no":"policy_number","policy no.":"policy_number",policy_no:"policy_number",carrier:"carrier",carrier_id:"carrier_id","insurance company":"carrier","insurance provider":"carrier",company:"carrier",provider:"carrier",product:"product","policy type":"product",policy_type:"product",type:"product",plan:"product","monthly premium":"monthly_premium",monthly_premium:"monthly_premium",premium:"monthly_premium",monthly:"monthly_premium","mo premium":"monthly_premium",ap:"ap","annual premium":"ap",annual_premium:"ap","yearly premium":"ap",annual:"ap",status:"status","application status":"status","app status":"status","policy status":"status","paid status":"paid_status",paid_status:"paid_status","payment status":"paid_status","closed by agent":"closed_by_agent",closed_by_agent:"closed_by_agent","agent closed":"closed_by_agent","closed by":"closed_by_agent","point of sale":"point_of_sale",point_of_sale:"point_of_sale",pos:"point_of_sale","sale location":"point_of_sale","pms form filled out":"pms_form_filled_out",pms_form_filled_out:"pms_form_filled_out","pms form":"pms_form_filled_out",pms:"pms_form_filled_out","split with":"split_with",split_with:"split_with","agent split":"split_with",split:"split_with","effective policy date":"effective_policy_date",effective_policy_date:"effective_policy_date","effective date":"effective_policy_date","start date":"effective_policy_date","effective policy status":"effective_policy_status",effective_policy_status:"effective_policy_status",notes:"notes",comments:"notes",remarks:"notes","notes for pay":"notes_for_pay",notes_for_pay:"notes_for_pay","payment notes":"notes_for_pay","paid split":"paid_split",paid_split:"paid_split","paid split?":"paid_split","commission status":"commission_status",commission_status:"commission_status","comm status":"commission_status","commission paid date":"commission_paid_date",commission_paid_date:"commission_paid_date","comm paid date":"commission_paid_date","policy payment cycle":"policy_payment_cycle",policy_payment_cycle:"policy_payment_cycle","payment cycle":"policy_payment_cycle",cycle:"policy_payment_cycle","commission amount":"commission_amount",commission_amount:"commission_amount","comm amount":"commission_amount"},t={};Object.keys(q[0]||{}).forEach(e=>{t[e]="unmapped"}),Object.keys(q[0]||{}).forEach(s=>{let a=s.toLowerCase().trim();if(e[a]){t[s]=e[a];return}for(let[i,l]of Object.entries(e))if(a.includes(i.toLowerCase())){t[s]=l;return}a.includes("phone")||a.includes("mobile")||a.includes("cell")?t[s]="client_phone_number":a.includes("email")?t[s]="client_email":a.includes("state")?t[s]="client_state":a.includes("premium")&&!a.includes("annual")?t[s]="monthly_premium":a.includes("premium")&&a.includes("annual")?t[s]="ap":a.includes("policy")&&(a.includes("number")||a.includes("#"))?t[s]="policy_number":a.includes("date")&&a.includes("submit")?t[s]="policy_submit_date":(a.includes("name")||a.includes("insured"))&&(t[s]="proposed_insured")}),console.log("Auto-mapped fields:",t),er(t),Z({title:"Auto-mapping applied",description:"Column mappings have been automatically determined based on column names."})},children:[a.jsx(j.Z,{className:"h-4 w-4 mr-2"}),"Auto-map columns"]}),(0,a.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>{let e={};Object.keys(q[0]||{}).forEach(t=>{e[t]="unmapped"}),er(e)},children:[a.jsx(b.Z,{className:"h-4 w-4 mr-2"}),"Clear all mappings"]})]})]}),a.jsx("div",{className:"max-h-[50vh] overflow-auto border rounded-md",children:(0,a.jsxs)(I.iA,{children:[a.jsx(I.xD,{className:"bg-muted sticky top-0 z-10",children:a.jsx(I.SC,{className:"hover:bg-transparent",children:Object.keys(q[0]||{}).map(e=>(0,a.jsxs)(I.ss,{className:"text-xs text-center p-2 border-r border-gray-200 last:border-r-0",children:[a.jsx("div",{className:"mb-2 font-bold text-gray-900 break-words max-w-[150px]",children:e}),(0,a.jsxs)(X.Ph,{value:en[e]||"unmapped",onValueChange:t=>{er(s=>({...s,[e]:t}))},children:[a.jsx(X.i4,{className:`h-8 text-xs bg-white w-full max-w-[150px] mx-auto ${en[e]&&"unmapped"!==en[e]?"bg-blue-50 border-blue-300 text-blue-700":""}`,children:a.jsx(X.ki,{placeholder:"Select field..."})}),(0,a.jsxs)(X.Bw,{className:"max-h-[300px]",children:[(0,a.jsxs)(X.DI,{children:[a.jsx(X.n5,{children:"Basic Client Info"}),a.jsx(X.Ql,{value:"unmapped",children:"- Ignore this column -"}),a.jsx(X.Ql,{value:"proposed_insured",children:"Proposed Insured"}),a.jsx(X.Ql,{value:"client_phone_number",children:"Client Phone Number"}),a.jsx(X.Ql,{value:"client_state",children:"Client State"}),a.jsx(X.Ql,{value:"client_email",children:"Client Email"})]}),(0,a.jsxs)(X.DI,{children:[a.jsx(X.n5,{children:"Policy Basics"}),a.jsx(X.Ql,{value:"policy_number",children:"Policy Number"}),a.jsx(X.Ql,{value:"carrier",children:"Carrier"}),a.jsx(X.Ql,{value:"carrier_id",children:"Carrier ID"}),a.jsx(X.Ql,{value:"product",children:"Product"}),a.jsx(X.Ql,{value:"monthly_premium",children:"Monthly Premium"}),a.jsx(X.Ql,{value:"ap",children:"AP (Annual Premium)"}),a.jsx(X.Ql,{value:"status",children:"Status"}),a.jsx(X.Ql,{value:"paid_status",children:"Paid Status"})]}),(0,a.jsxs)(X.DI,{children:[a.jsx(X.n5,{children:"Dates"}),a.jsx(X.Ql,{value:"month",children:"Month"}),a.jsx(X.Ql,{value:"policy_submit_date",children:"Policy Submit Date"}),a.jsx(X.Ql,{value:"effective_policy_date",children:"Effective Policy Date"}),a.jsx(X.Ql,{value:"commission_paid_date",children:"Commission Paid Date"})]}),(0,a.jsxs)(X.DI,{children:[a.jsx(X.n5,{children:"Agent Information"}),a.jsx(X.Ql,{value:"closed_by_agent",children:"Closed By Agent"}),a.jsx(X.Ql,{value:"point_of_sale",children:"Point of Sale"}),a.jsx(X.Ql,{value:"pms_form_filled_out",children:"PMS Form Filled Out"}),a.jsx(X.Ql,{value:"split_with",children:"Split With"}),a.jsx(X.Ql,{value:"paid_split",children:"Paid Split"})]}),(0,a.jsxs)(X.DI,{children:[a.jsx(X.n5,{children:"Commission & Status"}),a.jsx(X.Ql,{value:"effective_policy_status",children:"Effective Policy Status"}),a.jsx(X.Ql,{value:"commission_status",children:"Commission Status"}),a.jsx(X.Ql,{value:"policy_payment_cycle",children:"Policy Payment Cycle"}),a.jsx(X.Ql,{value:"commission_amount",children:"Commission Amount"})]}),(0,a.jsxs)(X.DI,{children:[a.jsx(X.n5,{children:"Notes"}),a.jsx(X.Ql,{value:"notes",children:"Notes"}),a.jsx(X.Ql,{value:"notes_for_pay",children:"Notes for Pay"})]})]})]})]},`header-${e}`))})}),a.jsx(I.RM,{children:q.slice(0,5).map((e,t)=>a.jsx(I.SC,{className:t%2==0?"bg-gray-50":"",children:Object.keys(e).map(s=>a.jsx(I.pj,{className:"p-2 border-r border-gray-200 last:border-r-0 text-xs",children:"string"==typeof e[s]?e[s]:String(e[s]||"")},`cell-${t}-${s}`))},`preview-row-${t}`))})]})}),(0,a.jsxs)("div",{className:"mt-4 bg-gray-50 p-3 rounded-md border border-gray-200",children:[(0,a.jsxs)("p",{className:"text-sm font-medium",children:["Preview of first 5 rows (",q.length," total rows found)"]}),(0,a.jsxs)("div",{className:"flex gap-6 mt-2",children:[(0,a.jsxs)("div",{className:"text-sm",children:[a.jsx("span",{className:"font-bold",children:"Required fields: "}),a.jsx("span",{className:en.proposed_insured?"text-green-600":"text-red-500",children:"Proposed Insured"}),",",a.jsx("span",{className:en.carrier?"text-green-600":"text-red-500",children:" Carrier"}),",",a.jsx("span",{className:en.product?"text-green-600":"text-red-500",children:" Product"})]}),(0,a.jsxs)("div",{className:"text-sm",children:[a.jsx("span",{className:"font-bold",children:"Mapped: "}),a.jsx("span",{className:"font-mono",children:Object.values(en).filter(e=>e&&"ignore"!==e).length})," of ",a.jsx("span",{className:"font-mono",children:Object.keys(q[0]||{}).length})," columns"]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end mt-6 space-x-2",children:[a.jsx(o.z,{variant:"outline",onClick:()=>ep(!1),children:"Back"}),a.jsx(o.z,{onClick:eL,disabled:V||0===Object.values(en).filter(Boolean).length,className:0===Object.values(en).filter(Boolean).length?"opacity-50 cursor-not-allowed":"",children:V?(0,a.jsxs)(a.Fragment,{children:[a.jsx(w.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Importing..."]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(N.Z,{className:"mr-2 h-4 w-4"}),"Import Applications"]})})]})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)(c.mQ,{defaultValue:"paste",className:"mt-4",onValueChange:e=>{G(e),T("")},children:[(0,a.jsxs)(c.dr,{className:"grid w-full max-w-md grid-cols-2",children:[a.jsx(c.SP,{value:"paste",children:"Paste Data"}),a.jsx(c.SP,{value:"upload",children:"Upload CSV"})]}),a.jsx(c.nU,{value:"paste",className:"mt-4",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(J._,{htmlFor:"bulkData",children:"Paste your spreadsheet data"}),a.jsx(D.g,{id:"bulkData",placeholder:"Paste data from Excel, Google Sheets, or CSV",className:"min-h-[200px] font-mono text-xs",value:O,onChange:e=>{Q(e.target.value),T("")}})]}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[a.jsx("p",{children:"Tips for pasting data:"}),(0,a.jsxs)("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[a.jsx("li",{children:"Make sure your data includes a header row"}),a.jsx("li",{children:"Supported delimiters: comma, tab, semicolon"}),a.jsx("li",{children:"Copy directly from Excel, Google Sheets, or other spreadsheet apps"})]})]})]})}),a.jsx(c.nU,{value:"upload",className:"mt-4",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-lg p-12",children:[a.jsx(g,{className:"h-8 w-8 text-muted-foreground mb-4"}),a.jsx("p",{className:"mb-4 text-sm text-muted-foreground text-center",children:"Drag and drop your CSV file here, or click to select a file"}),a.jsx("input",{type:"file",accept:".csv,.xls,.xlsx,.txt",onChange:e=>{let t=e.target.files?.[0];if(!t)return;T(""),ea(t);let s=new FileReader;s.onload=e=>{let t=e.target?.result;t&&Q(t)},s.onerror=()=>{T("Failed to read file. Please try again.")},s.readAsText(t)},className:"hidden",id:"file-upload"}),a.jsx(o.z,{asChild:!0,variant:"outline",size:"sm",children:a.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer",children:"Choose File"})}),es&&(0,a.jsxs)("div",{className:"mt-4 text-sm",children:["Selected: ",a.jsx("span",{className:"font-medium",children:es.name})]})]})})]}),F&&a.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded mt-4 text-sm",children:F}),(0,a.jsxs)("div",{className:"flex justify-end mt-6 space-x-2",children:[a.jsx(o.z,{variant:"outline",onClick:()=>B(!1),children:"Cancel"}),(0,a.jsxs)(o.z,{onClick:function(){T(""),ep(!1);try{let e;if(!O||""===O.trim()){T("Please enter or upload data first"),z([]);return}let t=eF(O),s=O.trim().replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n").filter(e=>""!==e.trim());if(s.length<2){T("Please include at least one header row and one data row"),z([]);return}console.log(`Processing ${s.length} lines of data`);let a=s[0];if(t)e="	",console.log("Excel paste detected, using tab delimiter");else{let t=(a.match(/,/g)||[]).length,s=(a.match(/\t/g)||[]).length,i=(a.match(/\|/g)||[]).length,l=(a.match(/;/g)||[]).length;e=t>=s&&t>=i&&t>=l?",":s>=t&&s>=i&&s>=l?"	":l>=t&&l>=s&&l>=i?";":i>=t&&i>=s&&i>=l?"|":","}console.log("Detected delimiter:",e,"in line:",a);let i=[],l=(e,t)=>e.trim()||`Column_${t+1}`;if(","===e){let t;let s=[],n=/(?:,|\n|^)("(?:(?:"")*[^"]*)*"|[^",\n]*|(?:\n|$))/g;for(;null!==(t=n.exec(a+","));){let e=t[1];e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1).replace(/""/g,'"')),s.push(e)}i=s.length>1?s.map(l):a.split(e).map((e,t)=>l(e.trim().replace(/^"|"$/g,""),t))}else i=a.split(e).map((e,t)=>l(e.trim(),t));if(console.log("Detected headers:",i),i.length<=1){T(`Could not parse headers properly. Detected only ${i.length} columns with delimiter "${e}". Try a different file format or delimiter.`),z([]);return}ec(["proposed_insured","client_phone_number","client_state","client_email","policy_type","coverage_amount","monthly_premium","annual_premium","carrier","product","status","paid_status","policy_number","month","policy_submit_date","effective_policy_date","point_of_sale","notes","notes_for_pay","paid_split","client_state","policy_","closed_by_agent","ap","client_name","insured_name","customer_name","name","phone","email","premium","commission","company","carrier_name","effective_date","submit_date","commission_status","commission_paid_date","policy_payment_cycle","commission_amount","split_with","effective_policy_status","pms_form_filled_out"]);let n=0,r=0,o=s.slice(1).filter(Boolean).map((t,s)=>{if(!t.trim())return r++,null;let a=[];if(","===e){let s;let i=[],l=/(?:,|\n|^)("(?:(?:"")*[^"]*)*"|[^",\n]*|(?:\n|$))/g;for(;null!==(s=l.exec(t+","));){let e=s[1];e&&e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1).replace(/""/g,'"')),i.push(void 0!==e?e:"")}a=i.length>1?i:t.split(e).map(e=>e.trim().replace(/^"|"$/g,""))}else a="	"===e?t.split(e):t.replace(/"([^"]*)"/g,(t,s)=>s.replace(RegExp(e,"g"),"___DELIMITER___")).split(e).map(t=>t.replace(/___DELIMITER___/g,e).trim());for(;a.length<i.length;)a.push("");a.length>i.length&&(a=a.slice(0,i.length));let l={};return i.forEach((e,t)=>{if(e){let s=a[t]||"";if(s.match(/^[$]?[0-9,.]+$/)){let t=parseFloat(s.replace(/[$,]/g,""));l[e]=isNaN(t)?s:t}else if(s.match(/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}$/))try{let t=new Date(s);isNaN(t.getTime())?l[e]=s:l[e]=t.toISOString().split("T")[0]}catch(t){l[e]=s}else l[e]=s}}),n++,l}).filter(Boolean);eu(n),e_(r),o.length>0?(console.log(`Parsed ${o.length} valid rows, first row:`,o[0]),z(o),ep(!0),eT(o[0],i)):(T("No valid data rows found. Please check your data format."),z([]))}catch(e){console.error("Error parsing bulk data:",e),T(`Failed to parse data: ${e.message}. Please check format and try again.`),z([])}},disabled:"paste"===W&&!O.trim()||"file"===W&&!es,className:("paste"!==W||O.trim())&&("file"!==W||es)?"":"opacity-50 cursor-not-allowed",children:[a.jsx(v.Z,{className:"mr-2 h-4 w-4"}),"Continue to Mapping"]})]})]})]})]})]})]})})}),a.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsxs)(c.mQ,{value:$,onValueChange:function(e){M(e)},className:"flex-1 flex flex-col",children:[(0,a.jsxs)(c.dr,{className:"mb-4",children:[a.jsx(c.SP,{value:"all",children:"All Applications"}),a.jsx(c.SP,{value:"approved",children:"Approved"}),a.jsx(c.SP,{value:"pending-first-payment",children:"Pending First Payment"}),a.jsx(c.SP,{value:"pending-payment",children:"Pending Payment"}),a.jsx(c.SP,{value:"paid-issued",children:"Paid & Issued"}),a.jsx(c.SP,{value:"not-taken",children:"Not Taken"}),a.jsx(c.SP,{value:"needs-attention",children:"Needs Attention"}),a.jsx(c.SP,{value:"cancelled",children:"Cancelled"})]}),a.jsx(c.nU,{value:"all",className:"flex-1 overflow-hidden",children:s?a.jsx(et,{}):a.jsx(ee.S,{children:a.jsx(n.w,{columns:eB,data:ez,state:{rowSelection:eP},onRowSelectionChange:ek})})}),a.jsx(c.nU,{value:"approved",className:"flex-1 overflow-hidden",children:s?a.jsx(et,{}):a.jsx(ee.S,{children:a.jsx(n.w,{columns:eB,data:ez,state:{rowSelection:eP},onRowSelectionChange:ek})})}),a.jsx(c.nU,{value:"pending-first-payment",className:"flex-1 overflow-hidden",children:s?a.jsx(et,{}):a.jsx(ee.S,{children:a.jsx(n.w,{columns:eB,data:ez,state:{rowSelection:eP},onRowSelectionChange:ek})})}),a.jsx(c.nU,{value:"pending-payment",className:"flex-1 overflow-hidden",children:s?a.jsx(et,{}):a.jsx(ee.S,{children:a.jsx(n.w,{columns:eB,data:ez,state:{rowSelection:eP},onRowSelectionChange:ek})})}),a.jsx(c.nU,{value:"paid-issued",className:"flex-1 overflow-hidden",children:s?a.jsx(et,{}):a.jsx(ee.S,{children:a.jsx(n.w,{columns:eB,data:ez,state:{rowSelection:eP},onRowSelectionChange:ek})})}),a.jsx(c.nU,{value:"not-taken",className:"flex-1 overflow-hidden",children:s?a.jsx(et,{}):a.jsx(ee.S,{children:a.jsx(n.w,{columns:eB,data:ez,state:{rowSelection:eP},onRowSelectionChange:ek})})}),a.jsx(c.nU,{value:"needs-attention",className:"flex-1 overflow-hidden",children:s?a.jsx(et,{}):a.jsx(ee.S,{children:a.jsx(n.w,{columns:eB,data:ez,state:{rowSelection:eP},onRowSelectionChange:ek})})}),a.jsx(c.nU,{value:"cancelled",className:"flex-1 overflow-hidden",children:s?a.jsx(et,{}):a.jsx(ee.S,{children:a.jsx(n.w,{columns:eB,data:ez,state:{rowSelection:eP},onRowSelectionChange:ek})})})]})})]})]})})}},72239:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var a=s(10326);s(17577);var i=s(37711),l=s(35047),n=s(34009);function r({children:e}){let{role:t,loading:s}=(0,n.q)();return s?a.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):"agent"!==t&&"admin"!==t&&"manager"!==t?(console.log("AgentLayout: Unauthorized role, redirecting to login"),(0,l.redirect)("/login"),null):a.jsx(i.M,{children:a.jsx("div",{className:"h-full",children:e})})}},82015:(e,t,s)=>{"use strict";s.d(t,{g:()=>n});var a=s(10326),i=s(17577),l=s(51223);let n=i.forwardRef(({className:e,...t},s)=>a.jsx("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...t}));n.displayName="Textarea"},97996:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(19510);function i({children:e}){return a.jsx("div",{children:e})}s(71159)},42179:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>l,default:()=>r});var a=s(68570);let i=(0,a.createProxy)(String.raw`C:\Users\Ronel\Downloads\New folder (5)\legacycore\legacy-core\src\app\agent\applications\page.tsx`),{__esModule:l,$$typeof:n}=i;i.default;let r=(0,a.createProxy)(String.raw`C:\Users\Ronel\Downloads\New folder (5)\legacycore\legacy-core\src\app\agent\applications\page.tsx#default`)},1409:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>l,default:()=>r});var a=s(68570);let i=(0,a.createProxy)(String.raw`C:\Users\Ronel\Downloads\New folder (5)\legacycore\legacy-core\src\app\agent\layout.tsx`),{__esModule:l,$$typeof:n}=i;i.default;let r=(0,a.createProxy)(String.raw`C:\Users\Ronel\Downloads\New folder (5)\legacycore\legacy-core\src\app\agent\layout.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[8948,3841,9813,224,825,7344,8624,4026,3579,5999,2812,1379,9344,7711,2e3,6575],()=>s(39637));module.exports=a})();