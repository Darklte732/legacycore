"use strict";(()=>{var e={};e.id=1567,e.ids=[1567],e.modules={92885:e=>{e.exports=require("@supabase/supabase-js")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},69066:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>_,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var a={};t.r(a),t.d(a,{GET:()=>u});var s=t(49303),o=t(88716),n=t(60670),i=t(20344),c=t(71615),l=t(87070);async function u(e){let r=new URL(e.url).searchParams,t=r.get("type")||"summary",a=r.get("startDate")||new Date(new Date().setMonth(new Date().getMonth()-12)).toISOString().split("T")[0],s=r.get("endDate")||new Date().toISOString().split("T")[0],o=parseInt(r.get("limit")||"5"),n=(0,i.createRouteHandlerClient)({cookies:c.cookies});try{let{data:{user:e}}=await n.auth.getUser();if(!e)return l.NextResponse.json({error:"Unauthorized"},{status:401});let{data:r,error:i}=await n.from("profiles").select("*").eq("id",e.id).single();if(i||!r)return l.NextResponse.json({error:"Profile not found"},{status:404});if("manager"!==r.role)return l.NextResponse.json({error:"Forbidden: Only managers can access analytics"},{status:403});let c=r.organization_id,u={};switch(t){case"summary":let{data:p,error:d}=await n.rpc("get_analytics_policy_summary",{org_uuid:c}),{data:m,error:g}=await n.rpc("get_analytics_commission_summary",{org_uuid:c});if(d||g)return console.error("Policy error:",d),console.error("Commission error:",g),l.NextResponse.json({error:"Error fetching summary data"},{status:500});let _=p.reduce((e,r)=>e+parseInt(r.total_policies),0),y=p.reduce((e,r)=>e+parseFloat(r.total_premium),0),f=m.reduce((e,r)=>e+parseFloat(r.total_commissions||0),0),x=_>0?p.reduce((e,r)=>e+parseInt(r.approved_policies),0)/_*100:0;u={summary:{totalPolicies:_,totalPremium:y,totalCommissions:f,approvalRate:x},policySummary:p,commissionSummary:m};break;case"monthly":let{data:h,error:j}=await n.rpc("get_monthly_policy_stats",{org_uuid:c,start_date:a,end_date:s});if(j)return console.error("Monthly stats error:",j),l.NextResponse.json({error:"Error fetching monthly data"},{status:500});u={monthlyStats:h};break;case"carriers":let{data:w,error:R}=await n.rpc("get_analytics_carrier_performance",{org_uuid:c});if(R)return console.error("Carriers error:",R),l.NextResponse.json({error:"Error fetching carrier data"},{status:500});u={carriers:w.sort((e,r)=>parseFloat(r.total_premium)-parseFloat(e.total_premium))};break;case"agents":let{data:b,error:q}=await n.rpc("get_analytics_agent_performance",{org_uuid:c});if(q)return console.error("Agents error:",q),l.NextResponse.json({error:"Error fetching agent data"},{status:500});u={agents:b.sort((e,r)=>parseFloat(r.total_premium)-parseFloat(e.total_premium)).slice(0,o)};break;case"policies":let{data:v,error:N}=await n.from("policies").select(`
            id, 
            policy_number, 
            premium, 
            status, 
            submission_date, 
            effective_date,
            clients(first_name, last_name),
            products(name, carrier_id),
            carriers:products(name)
          `).eq("organization_id",c).order("submission_date",{ascending:!1}).limit(20);if(N)return console.error("Policies error:",N),l.NextResponse.json({error:"Error fetching policy data"},{status:500});u={recentPolicies:v};break;default:return l.NextResponse.json({error:"Invalid analytics type requested"},{status:400})}return l.NextResponse.json(u)}catch(e){return console.error("Analytics API error:",e),l.NextResponse.json({error:"Internal Server Error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"C:\\Users\\Ronel\\Downloads\\New folder (5)\\legacycore\\legacy-core\\src\\app\\api\\analytics\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:g}=p,_="/api/analytics/route";function y(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,5972,958],()=>t(69066));module.exports=a})();