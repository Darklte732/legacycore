(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2985],{99037:function(e,r,t){Promise.resolve().then(t.bind(t,10050))},81066:function(e,r,t){"use strict";t.d(r,{Z:function(){return i}});var a=t(2265),o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,r)=>{let t=(0,a.forwardRef)((t,i)=>{let{color:s="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:u="",children:m,...g}=t;return(0,a.createElement)("svg",{ref:i,...o,width:l,height:l,stroke:s,strokeWidth:d?24*Number(c)/Number(l):c,className:["lucide",`lucide-${n(e)}`,u].join(" "),...g},[...r.map(e=>{let[r,t]=e;return(0,a.createElement)(r,t)}),...Array.isArray(m)?m:[m]])});return t.displayName=`${e}`,t}},11240:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(81066).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},10050:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return s}});var a=t(57437);t(2265);var o=t(6683),n=t(82157),i=t(11240);function s(){let{role:e,loading:r}=(0,o.q)();return((0,n.e)(),r)?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:"Loading..."}):(0,a.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,a.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[(0,a.jsx)(i.Z,{className:"h-8 w-8"}),"Agent Management"]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Agents List"}),(0,a.jsx)("p",{className:"text-gray-600",children:"This page will display a list of all agents and their performance metrics."})]})]})}},6683:function(e,r,t){"use strict";t.d(r,{q:function(){return n}});var a=t(2265),o=t(82157);let n=()=>{let[e,r]=(0,a.useState)(null),[t,n]=(0,a.useState)(!0),[i,s]=(0,a.useState)(!1),[l,c]=(0,a.useState)(0),d=(0,o.e)(),u=()=>{console.log("Clearing all role-related cookies to prevent conflicts"),document.cookie="force_manager_view=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="test_role=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="admin_redirected=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="handling_redirect=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"},m=async(e,r)=>{console.log("⚠️ SECURITY: Forcing removal of admin role for unauthorized user"),u();try{await d.from("profiles").update({role:"agent"}).eq("id",e),console.log("Updated database role from admin to agent");let{error:r}=await d.auth.updateUser({data:{role:"agent"}});r&&console.error("Error updating user metadata:",r),setTimeout(()=>window.location.href="/agent/dashboard",100)}catch(e){console.error("Error clearing admin role:",e)}},g=async(e,r)=>{try{console.log(`Synchronizing user metadata role to match database: ${r}`);let{error:e}=await d.auth.updateUser({data:{role:r}});e&&console.error("Error updating user metadata:",e)}catch(e){console.error("Error synchronizing roles:",e)}},h=e=>{let r=Date.now();if(i||r-l<2e3){console.log("Preventing potential redirect loop");return}s(!0),c(r),document.cookie="handling_redirect=true; path=/; max-age=5",setTimeout(()=>{console.log(`Redirecting to /${e}/dashboard`),window.location.href=`/${e}/dashboard`,s(!1)},100)};return(0,a.useEffect)(()=>{let e=async()=>{try{let e=window.location.pathname,o=e.startsWith("/admin"),i=e.startsWith("/manager"),s=e.startsWith("/agent");if(o||i||s){let e=document.cookie.split("; ").find(e=>e.startsWith("test_role="))?.split("=")[1];s&&e&&"agent"!==e&&(console.log(`Path is /agent but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u()),i&&e&&"manager"!==e&&(console.log(`Path is /manager but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u()),o&&e&&"admin"!==e&&(console.log(`Path is /admin but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u())}if(document.cookie.includes("handling_redirect=true")){console.log("Skipping role check - redirect in progress"),n(!1);return}let l=document.cookie.split("; ").find(e=>e.startsWith("force_manager_view="))?.split("=")[1],c=document.cookie.split("; ").find(e=>e.startsWith("test_role="))?.split("=")[1],{data:{session:f}}=await d.auth.getSession();if(!f){r(null),n(!1);return}let p=["980ebab6-9e1a-4c53-876a-978c8c640f7e","adbdb861-5ce8-4b5c-af50-7deb93a687c1"];if(f.user.user_metadata?.role==="admin"&&!p.includes(f.user.id)){await m(f.user.id,f.user.email||""),r("agent"),n(!1);return}if("true"===l){console.log("⚠️ FORCED MANAGER VIEW: Using manager role from force_manager_view cookie"),await a(f.user.id,f.user.email,"manager"),r("manager"),n(!1);return}if(s){console.log("\uD83D\uDC49 On agent path, ensuring agent role and sidebar"),c&&u(),r("agent"),n(!1);return}if(i){console.log("\uD83D\uDC49 On manager path, ensuring manager role and sidebar"),c&&u(),r("manager"),n(!1);return}if(o){if(p.includes(f.user.id)){console.log("\uD83D\uDC49 On admin path with valid admin ID, ensuring admin role and sidebar"),c&&u(),r("admin"),n(!1);return}console.log("⚠️ SECURITY: Non-admin attempting to access admin path"),u(),h("agent");return}if("56e8e969-76fd-4d69-a8ca-3e315487c2c4"===f.user.id){console.log("⚠️ APPLYING ROLE OVERRIDE: Setting role to manager for santosUser"),await a(f.user.id,f.user.email,"manager"),r("manager"),n(!1);return}if(c&&["admin","manager","agent"].includes(c)){if("admin"===c&&!p.includes(f.user.id)){console.log("⚠️ SECURITY: Unauthorized admin access attempt via cookie. Defaulting to agent role."),document.cookie="test_role=agent; path=/; max-age=86400",r("agent"),n(!1);return}console.log(`⚠️ DEVELOPMENT MODE: Using ${c} role from test_role cookie`),r(c),n(!1);return}let{data:w}=await d.from("profiles").select("role").eq("id",f.user.id).single();if(w&&w.role){if(console.log(`Using role from database profile: ${w.role}`),"admin"===w.role&&!p.includes(f.user.id)){console.warn("⚠️ SECURITY: Unauthorized admin role in database. Correcting to agent."),await m(f.user.id,f.user.email||""),r("agent"),n(!1);return}if(f.user.user_metadata?.role&&f.user.user_metadata.role!==w.role&&(console.warn(`⚠️ Role mismatch: metadata (${f.user.user_metadata.role}) vs database (${w.role}). Using database role.`),await g(f.user.id,w.role)),r(w.role),e.startsWith("/admin")&&"admin"!==w.role){console.log(`⚠️ Path mismatch: User with role ${w.role} on admin path. Redirecting...`),n(!1),h(w.role);return}if(e.startsWith("/manager")&&"manager"!==w.role){console.log(`⚠️ Path mismatch: User with role ${w.role} on manager path. Redirecting...`),n(!1),h(w.role);return}if(e.startsWith("/agent")&&"agent"!==w.role){console.log(`⚠️ Path mismatch: User with role ${w.role} on agent path. Redirecting...`),n(!1),h(w.role);return}n(!1);return}if(f.user.user_metadata?.role&&["admin","manager","agent"].includes(f.user.user_metadata.role)){if("admin"===f.user.user_metadata.role&&!p.includes(f.user.id)){console.warn("⚠️ SECURITY: Unauthorized admin role in metadata. Correcting to agent."),await m(f.user.id,f.user.email||""),r("agent"),n(!1);return}console.log(`Using role from user metadata (no profile): ${f.user.user_metadata.role}`),await t(f.user.id,f.user.email,f.user.user_metadata.role),r(f.user.user_metadata.role)}else console.log("No role found. Defaulting to agent role."),await t(f.user.id,f.user.email||"","agent"),r("agent");n(!1)}catch(e){console.error("Error determining user role:",e),r(null),n(!1)}},t=async(e,r,t)=>{try{let{error:a}=await d.from("profiles").insert({id:e,email:r,role:t}).select();a&&console.error("Error creating user profile:",a)}catch(e){console.error("Error in profile creation:",e)}},a=async(e,r,a)=>{try{let{data:o}=await d.from("profiles").select("role").eq("id",e).single();o?o.role!==a&&(await d.from("profiles").update({role:a}).eq("id",e),console.log(`Updated profile role from ${o.role} to ${a}`)):(await t(e,r,a),console.log(`Created new profile with role ${a}`))}catch(e){console.error("Error ensuring profile has role:",e)}};e();let{data:{subscription:o}}=d.auth.onAuthStateChange((t,a)=>{if(!a){r(null);return}e()});return()=>{o.unsubscribe()}},[d,i,l]),{role:e,loading:t,isAdmin:"admin"===e,isManager:"manager"===e,isAgent:"agent"===e}}},82157:function(e,r,t){"use strict";t.d(r,{e:function(){return o}});var a=t(64392);let o=()=>(0,a.createClientComponentClient)({supabaseUrl:"https://iufyuzmigirugcufrtvt.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Znl1em1pZ2lydWdjdWZydHZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQxMjcsImV4cCI6MjA2MDYxMDEyN30.V38OGEX1Oy3gFfu5ClGWRk3xYAhb_DVr-5ojOQZ1UfU"});(0,a.createClientComponentClient)({supabaseUrl:"https://iufyuzmigirugcufrtvt.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Znl1em1pZ2lydWdjdWZydHZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQxMjcsImV4cCI6MjA2MDYxMDEyN30.V38OGEX1Oy3gFfu5ClGWRk3xYAhb_DVr-5ojOQZ1UfU"})}},function(e){e.O(0,[4392,2971,7023,1744],function(){return e(e.s=99037)}),_N_E=e.O()}]);