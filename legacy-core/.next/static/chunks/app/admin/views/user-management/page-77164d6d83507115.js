(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[604],{75084:function(e,a,t){Promise.resolve().then(t.bind(t,41350))},41350:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return w}});var s=t(57437),r=t(2265),l=t(82157),n=t(54817),i=t(43267),o=t(26032),d=t(54174),c=t(4086),m=t(6649),u=t(10883),x=t(74697),h=t(59061),f=t(32308),g=t(6683);let p=[{id:"1",email:"admin@example.com",first_name:"Admin",last_name:"User",role:"admin",avatar_url:null,created_at:new Date().toISOString(),organization_id:null},{id:"2",email:"manager@example.com",first_name:"Manager",last_name:"User",role:"manager",avatar_url:null,created_at:new Date().toISOString(),organization_id:null},{id:"3",email:"agent1@example.com",first_name:"John",last_name:"Agent",role:"agent",avatar_url:null,created_at:new Date().toISOString(),organization_id:null},{id:"4",email:"agent2@example.com",first_name:"Jane",last_name:"Agent",role:"agent",avatar_url:null,created_at:new Date().toISOString(),organization_id:null}];function w(){let{role:e,loading:a}=(0,g.q)(),[t,w]=(0,r.useState)([]),[y,b]=(0,r.useState)([]),[j,N]=(0,r.useState)(!0),[_,v]=(0,r.useState)(""),[k,S]=(0,r.useState)(!1),[U,C]=(0,r.useState)("create"),[D,E]=(0,r.useState)(null),[A,F]=(0,r.useState)({email:"",first_name:"",last_name:"",role:"agent"}),[L,P]=(0,r.useState)(!1),[R,Z]=(0,r.useState)(""),[I,M]=(0,r.useState)(!1),$=(0,l.e)();(0,r.useEffect)(()=>{!a&&e&&z("admin"===e)},[a,e]),(0,r.useEffect)(()=>{if(""===_.trim())b(t);else{let e=_.toLowerCase();b(t.filter(a=>a.email.toLowerCase().includes(e)||(a.first_name?.toLowerCase()||"").includes(e)||(a.last_name?.toLowerCase()||"").includes(e)||(a.role?.toLowerCase()||"").includes(e)))}},[_,t]);let z=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];N(!0);try{console.log("Fetching user profiles...",e?"as admin":"as regular user");let{data:a}=await $.auth.getSession();if(!a.session){console.error("No active session found"),Z("Not authenticated. Please sign in again."),M(!0),w(p),b(p),N(!1);return}let{data:t,error:s}=await $.from("profiles").select("*").order("created_at",{ascending:!1});if(s){if(console.error("Error fetching profiles:",s),e&&("PGRST301"===s.code||s.message.includes("permission denied"))){console.log("Admin user encountered permission issue - checking if RLS policy is active");try{let{data:e,error:a}=await $.rpc("get_all_profiles");if(!a&&e){console.log("Successfully fetched profiles using RPC function:",e.length),w(e),b(e),M(!1),N(!1);return}}catch(e){console.error("RPC method failed:",e)}}console.log("Falling back to demo data due to error"),w(p),b(p),M(!0),Z(`Using demo data - Your account may not have permission to view all profiles. ${s.message}`)}else t&&0!==t.length?(console.log("Profiles fetched successfully:",t.length,"profiles found"),w(t),b(t),M(!1)):(console.log("No profiles found in the database"),e&&console.log("Admin user found no profiles - using demo data for demonstration"),w(p),b(p),M(!0),Z("No user profiles found in the database. Using demo data for visualization purposes."))}catch(e){console.error("Error in fetchUsers:",e),w(p),b(p),M(!0),Z("An unexpected error occurred. Using demo data instead.")}finally{N(!1)}},O=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;C(e),E(a),"create"===e?F({email:"",first_name:"",last_name:"",role:"agent"}):"edit"===e&&a&&F({email:a.email||"",first_name:a.first_name||"",last_name:a.last_name||"",role:a.role||"agent"}),S(!0)},T=()=>{S(!1),Z("")},q=e=>{F({...A,[e.target.name]:e.target.value})},J=async a=>{if(a.preventDefault(),P(!0),Z(""),I){setTimeout(()=>{let e={id:Math.random().toString(36).substring(2,11),email:A.email,first_name:A.first_name,last_name:A.last_name,role:A.role,avatar_url:null,created_at:new Date().toISOString(),organization_id:null};w(a=>[e,...a]),b(a=>[e,...a]),T(),P(!1),alert("Demo mode: User would be created in a real environment")},1e3);return}try{try{let{data:e,error:a}=await $.auth.admin.createUser({email:A.email,password:H(12),email_confirm:!0,user_metadata:{first_name:A.first_name,last_name:A.last_name,role:A.role}});if(a)throw console.error("Error creating user with admin.createUser:",a),a;if(e.user){let{error:a}=await $.from("profiles").update({first_name:A.first_name,last_name:A.last_name,role:A.role}).eq("id",e.user.id);if(a)throw a}}catch(t){console.log("Admin create method failed, trying standard signup instead");let{data:e,error:a}=await $.auth.signUp({email:A.email,password:H(12),options:{data:{first_name:A.first_name,last_name:A.last_name,role:A.role}}});if(a)throw a}T(),"admin"===e&&z(!0)}catch(e){console.error("Error creating user:",e),Z(e.message||"Failed to create user")}finally{P(!1)}},G=async a=>{if(a.preventDefault(),D){if(P(!0),Z(""),I){setTimeout(()=>{w(e=>e.map(e=>e.id===D.id?{...e,first_name:A.first_name,last_name:A.last_name,role:A.role}:e)),b(e=>e.map(e=>e.id===D.id?{...e,first_name:A.first_name,last_name:A.last_name,role:A.role}:e)),T(),P(!1),alert("Demo mode: User would be updated in a real environment")},1e3);return}try{let{error:a}=await $.from("profiles").update({first_name:A.first_name,last_name:A.last_name,role:A.role}).eq("id",D.id);if(a)throw a;T(),"admin"===e&&z(!0)}catch(e){console.error("Error updating user:",e),Z(e.message||"Failed to update user")}finally{P(!1)}}},Y=async()=>{if(D){if(P(!0),I){setTimeout(()=>{w(e=>e.filter(e=>e.id!==D.id)),b(e=>e.filter(e=>e.id!==D.id)),T(),P(!1),alert("Demo mode: User would be deleted in a real environment")},1e3);return}try{try{let{error:e}=await $.auth.admin.deleteUser(D.id);if(e)throw e}catch(a){console.log("Admin delete method failed, trying direct profile deletion");let{error:e}=await $.from("profiles").delete().eq("id",D.id);if(e)throw e}T(),"admin"===e&&z(!0)}catch(e){console.error("Error deleting user:",e),Z(e.message||"Failed to delete user")}finally{P(!1)}}},B=async e=>{if(I){alert(`Demo mode: Password reset email would be sent to ${e} in a real environment`);return}try{let{error:a}=await $.auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/auth/callback?next=/reset-password`});if(a)throw a;alert(`Password reset email sent to ${e}`)}catch(e){console.error("Error sending reset email:",e),alert(`Error: ${e.message}`)}},H=e=>{let a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()-_=+",t="";for(let s=0;s<e;s++){let e=Math.floor(Math.random()*a.length);t+=a[e]}return t},K=e=>{switch(e){case"admin":return"bg-red-100 text-red-800";case"manager":return"bg-blue-100 text-blue-800";case"agent":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return a||j?(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):(0,s.jsx)(f.M,{userRole:e||"admin",children:(0,s.jsxs)("div",{className:"space-y-6 p-6",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"User Management"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Manage users and their access permissions"})]}),(0,s.jsxs)("div",{className:"flex space-x-4 w-full md:w-auto",children:[(0,s.jsxs)("div",{className:"relative flex-grow md:flex-grow-0",children:[(0,s.jsx)("input",{type:"text",placeholder:"Search users...",className:"pl-10 pr-4 py-2 border rounded-lg w-full",value:_,onChange:e=>v(e.target.value)}),(0,s.jsx)(n.Z,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),(0,s.jsxs)("button",{onClick:()=>O("create"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center",children:[(0,s.jsx)(i.Z,{className:"h-5 w-5 mr-2"}),"Add User"]})]})]}),I&&(0,s.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(o.Z,{className:"h-5 w-5 text-yellow-400"})}),(0,s.jsx)("div",{className:"ml-3",children:(0,s.jsx)("p",{className:"text-sm text-yellow-700",children:R||"Using demonstration data. In a production environment, this page would display real users from your Supabase database."})})]})}),(0,s.jsx)("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created At"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===y.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500",children:j?"Loading users...":"No users found"})}):y.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"h-10 w-10 flex-shrink-0",children:e.avatar_url?(0,s.jsx)("img",{className:"h-10 w-10 rounded-full object-cover",src:e.avatar_url,alt:`${e.first_name} ${e.last_name}`}):(0,s.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:(0,s.jsx)(d.Z,{className:"h-6 w-6 text-gray-500"})})}),(0,s.jsx)("div",{className:"ml-4",children:(0,s.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.first_name," ",e.last_name]})})]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("div",{className:"text-sm text-gray-900",children:e.email})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${K(e.role)}`,children:e.role||"No Role"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.created_at?new Date(e.created_at).toLocaleDateString():"N/A"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{onClick:()=>B(e.email),className:"text-indigo-600 hover:text-indigo-900 p-1",title:"Reset Password",children:(0,s.jsx)(c.Z,{className:"h-5 w-5"})}),(0,s.jsx)("button",{onClick:()=>O("edit",e),className:"text-blue-600 hover:text-blue-900 p-1",title:"Edit User",children:(0,s.jsx)(m.Z,{className:"h-5 w-5"})}),(0,s.jsx)("button",{onClick:()=>O("delete",e),className:"text-red-600 hover:text-red-900 p-1",title:"Delete User",children:(0,s.jsx)(u.Z,{className:"h-5 w-5"})})]})})]},e.id))})]})})}),k&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold",children:"create"===U?"Add New User":"edit"===U?"Edit User":"Delete User"}),(0,s.jsx)("button",{onClick:T,className:"text-gray-500 hover:text-gray-700",children:(0,s.jsx)(x.Z,{className:"h-5 w-5"})})]}),R&&"delete"!==U&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-md",children:R}),I&&"delete"!==U&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-yellow-100 text-yellow-700 rounded-md",children:"Demo mode: Changes will only be reflected in the UI and not saved to the database."}),"delete"===U?(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"mb-4",children:["Are you sure you want to delete user"," ",(0,s.jsxs)("span",{className:"font-semibold",children:[D?.first_name," ",D?.last_name," (",D?.email,")"]}),"? This action cannot be undone."]}),I&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-yellow-100 text-yellow-700 rounded-md",children:"Demo mode: This action will only affect the UI display."}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:T,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md",disabled:L,children:"Cancel"}),(0,s.jsx)("button",{type:"button",onClick:Y,className:"px-4 py-2 bg-red-600 text-white rounded-md",disabled:L,children:L?"Deleting...":"Delete User"})]})]}):(0,s.jsxs)("form",{onSubmit:"create"===U?J:G,children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,s.jsx)("input",{type:"email",name:"email",id:"email",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",placeholder:"user@example.com",value:A.email,onChange:q,disabled:"edit"===U})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"first_name",className:"block text-sm font-medium text-gray-700",children:"First Name"}),(0,s.jsx)("input",{type:"text",name:"first_name",id:"first_name",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",placeholder:"First Name",value:A.first_name,onChange:q})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"last_name",className:"block text-sm font-medium text-gray-700",children:"Last Name"}),(0,s.jsx)("input",{type:"text",name:"last_name",id:"last_name",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",placeholder:"Last Name",value:A.last_name,onChange:q})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:"Role"}),(0,s.jsxs)("select",{name:"role",id:"role",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",value:A.role,onChange:q,children:[(0,s.jsx)("option",{value:"agent",children:"Agent"}),(0,s.jsx)("option",{value:"manager",children:"Manager"}),(0,s.jsx)("option",{value:"admin",children:"Admin"})]})]}),"create"===U&&!I&&(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"A password reset email will be sent to the user."})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:T,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md",disabled:L,children:"Cancel"}),(0,s.jsxs)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md flex items-center",disabled:L,children:[(0,s.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),L?"create"===U?"Creating...":"Updating...":"create"===U?"Create User":"Update User"]})]})]})]})})})]})})}}},function(e){e.O(0,[4392,7138,6648,3676,2308,2971,7023,1744],function(){return e(e.s=75084)}),_N_E=e.O()}]);