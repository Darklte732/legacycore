(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7414],{28682:function(e,t,s){Promise.resolve().then(s.bind(s,9032))},71976:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,s(81066).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},37164:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,s(81066).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},58184:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,s(81066).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},91727:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,s(81066).Z)("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]])},59738:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,s(81066).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},9032:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return es}});var i=s(57437);s(27224);var a=s(2265),l=s(16463),n=s(58052),r=s(48185),o=s(89733),c=s(86864),d=s(83014),m=s(15862),p=s(77515),u=s(22468),h=s(37164),_=s(81066);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,_.Z)("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),y=(0,_.Z)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);var x=s(92513);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let g=(0,_.Z)("UploadCloud",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m16 16-4-4-4 4",key:"119tzi"}]]);var v=s(71976),j=s(91727),b=s(59738),N=s(74109),w=s(58184),S=s(17750),P=s(84379),k=s(82157),C=s(78068),$=s(2183),A=s(54662),E=s(4919),I=s(47304),D=s(89736),Z=s(98324),O=s(18676),M="Progress",[Q,z]=(0,Z.b)(M),[F,R]=Q(M),L=a.forwardRef((e,t)=>{var s,a;let{__scopeProgress:l,value:n=null,max:r,getValueLabel:o=B,...c}=e;(r||0===r)&&!Y(r)&&console.error((s=`${r}`,`Invalid prop \`max\` of value \`${s}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let d=Y(r)?r:100;null===n||W(n,d)||console.error((a=`${n}`,`Invalid prop \`value\` of value \`${a}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let m=W(n,d)?n:null,p=V(m)?o(m,d):void 0;return(0,i.jsx)(F,{scope:l,value:m,max:d,children:(0,i.jsx)(O.WV.div,{"aria-valuemax":d,"aria-valuemin":0,"aria-valuenow":V(m)?m:void 0,"aria-valuetext":p,role:"progressbar","data-state":q(m,d),"data-value":m??void 0,"data-max":d,...c,ref:t})})});L.displayName=M;var T="ProgressIndicator",U=a.forwardRef((e,t)=>{let{__scopeProgress:s,...a}=e,l=R(T,s);return(0,i.jsx)(O.WV.div,{"data-state":q(l.value,l.max),"data-value":l.value??void 0,"data-max":l.max,...a,ref:t})});function B(e,t){return`${Math.round(e/t*100)}%`}function q(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function V(e){return"number"==typeof e}function Y(e){return V(e)&&!isNaN(e)&&e>0}function W(e,t){return V(e)&&!isNaN(e)&&e<=t&&e>=0}U.displayName=T;var H=s(49354);let G=a.forwardRef((e,t)=>{let{className:s,value:a,...l}=e;return(0,i.jsx)(L,{ref:t,className:(0,H.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...l,children:(0,i.jsx)(U,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})})});G.displayName=L.displayName;var X=s(2128),J=s(70402),K=s(93095),ee=s(55813);let et=()=>(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)($.O,{className:"h-8 w-48"}),(0,i.jsx)($.O,{className:"h-8 w-24"})]}),(0,i.jsx)("div",{className:"space-y-2",children:[,,,,,].fill(0).map((e,t)=>(0,i.jsxs)("div",{className:"flex items-center justify-between border-b pb-2",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)($.O,{className:"h-4 w-64"}),(0,i.jsx)($.O,{className:"h-3 w-32"})]}),(0,i.jsxs)("div",{className:"flex space-x-2",children:[(0,i.jsx)($.O,{className:"h-6 w-24"}),(0,i.jsx)($.O,{className:"h-6 w-6 rounded-full"})]})]},t))})]});function es(){let[e,t]=(0,a.useState)([]),[s,_]=(0,a.useState)(!0),[$,Z]=(0,a.useState)("all"),O=(0,l.useRouter)(),{toast:M}=(0,C.pm)(),Q=(0,k.e)(),[z,F]=(0,a.useState)(""),[R,L]=(0,a.useState)([]),[T,U]=(0,a.useState)(""),[B,q]=(0,a.useState)(!1),[V,Y]=(0,a.useState)(!1),[W,H]=(0,a.useState)("paste"),[es,ei]=(0,a.useState)(null),[ea,el]=(0,a.useState)(0),[en,er]=(0,a.useState)({}),[eo,ec]=(0,a.useState)([]),[ed,em]=(0,a.useState)(!1),[ep,eu]=(0,a.useState)(0),[eh,e_]=(0,a.useState)(0),[ef,ey]=(0,a.useState)(!1),[ex,eg]=(0,a.useState)([]),[ev,ej]=(0,a.useState)(!1),[eb,eN]=(0,a.useState)(null),[ew,eS]=(0,a.useState)({}),[eP,ek]=(0,a.useState)({}),[eC,e$]=(0,a.useState)(!1),[eA,eE]=(0,a.useState)(!1),[eI,eD]=(0,a.useState)({}),[eZ,eO]=(0,a.useState)(""),[eM,eQ]=(0,a.useState)(!1),ez=(0,a.useRef)(!1),eF=()=>{let t=e.length,s=e.filter(e=>"Approved"===e.status).length;return{totalPolicies:t,approvedPolicies:s,needsAttentionPolicies:e.filter(e=>"Needs Attention"===e.policy_health).length,paidPolicies:e.filter(e=>("Approved"===e.status||"Live"===e.status||"1st Month Paid"===e.status)&&"Paid"===e.paid_status).length,totalAnnualPremium:e.reduce((e,t)=>e+12*("number"==typeof t.monthly_premium?t.monthly_premium:parseFloat(t.monthly_premium||"0")),0)}};async function eR(){try{_(!0),console.log("Starting to fetch applications...");let{data:{session:e}}=await Q.auth.getSession();if(console.log("Session information:",e?{id:e.user?.id,email:e.user?.email,isAuthenticated:!!e}:"No session found"),!e&&ez.current){M({title:"Session expired",description:"Your session has expired. Please refresh the page to log in again.",variant:"destructive"}),_(!1);return}if(e)ez.current=!0;else{M({title:"Authentication required",description:"Please log in to view your applications.",variant:"destructive"}),_(!1);return}console.log("Fetching applications from Supabase..."),console.log("Using agent_id:",e.user.id),console.log("Checking available tables in database...");let{data:s,error:i}=await Q.from("agent_applications").select("*").eq("agent_id",e.user.id).order("created_at",{ascending:!1});if(i){console.error("Error fetching from agent_applications:",i),M({title:"Error fetching applications",description:i.message,variant:"destructive"}),_(!1);return}if(s&&s.length>0){console.log(`✅ Table agent_applications exists and contains data for this agent.`),console.log(`✅ Successfully loaded ${s.length} applications from agent_applications table.`);let e=s.map(e=>{if(e.commission_amount&&"number"==typeof e.commission_amount&&e.commission_amount>0)return e;let t=0,s=0;e.ap&&e.ap>0?s="number"==typeof e.ap?e.ap:parseFloat(e.ap):e.monthly_premium?(t="number"==typeof e.monthly_premium?e.monthly_premium:parseFloat(e.monthly_premium),s=12*t):e.premium&&(t="number"==typeof e.premium?e.premium:parseFloat(e.premium||"0"),s=12*t);let i=e.split_percentage||20,a=(100-i)/100*s;return!isNaN(a)&&a>0?{...e,commission_amount:a}:e});t(e),console.log("Loaded applications from database with commission calculations:",e)}else console.log("No applications found for this agent."),t([]);console.log("All loaded applications:",s)}catch(e){console.error("Error fetching applications:",e),M({title:"Error loading applications",description:e.message||"An unexpected error occurred",variant:"destructive"})}finally{_(!1)}}(0,a.useEffect)(()=>{(async function(){try{let{data:{session:e}}=await Q.auth.getSession();if(!e){O.push("/login");return}try{let{data:t}=await Q.from("profiles").select("role").eq("id",e.user.id).single();t&&"agent"!==t.role&&M({title:"Access Notice",description:"This page is intended for agents. Some features may be limited.",variant:"default"})}catch(e){console.warn("Could not verify role, proceeding anyway:",e)}eR()}catch(e){console.error("Authentication check failed:",e),M({title:"Authentication Notice",description:"We couldn't verify your session. Some features may be limited.",variant:"default"}),eR()}})()},[O]),(0,a.useEffect)(()=>{e.length>0&&(console.log("All loaded applications:",e),e.forEach(e=>{"Live"===e.status&&"Paid"===e.paid_status&&console.log("Should be in Paid & Issued:",e),(e.proposed_insured?.includes("Rawlings")||e.proposed_insured?.includes("Curtis"))&&console.log("Found specific application:",e)}),console.log("Direct filtered Live and Paid applications:",e.filter(e=>"Live"===e.status&&"Paid"===e.paid_status)),console.log("Status values present:",[...new Set(e.map(e=>e.status))]),console.log("Paid status values present:",[...new Set(e.map(e=>e.paid_status))]))},[e]);let eL=e.filter(e=>{if("all"===$)return!0;let t=(e.status||"").toLowerCase(),s=(e.paid_status||"").toLowerCase();(e.commission_status||"").toLowerCase();let i=(e.notes||"").toLowerCase(),a=(e.policy_health||"").toLowerCase();switch($){case"approved":return t.includes("approved");case"pending-first-payment":return"pending first payment"===a||a.includes("pending first")||a.includes("first payment")||t.includes("approved")&&s.includes("unpaid")&&!a.includes("active");case"pending-payment":return t.includes("approved")&&(s.includes("unpaid")||!s)&&"pending first payment"!==a;case"paid-issued":return s.includes("paid")&&(t.includes("live")||t.includes("approved")||t.includes("issued")||t.includes("1st month"))&&!t.includes("not")&&!t.includes("cancel")&&"pending first payment"!==a;case"needs-attention":return a.includes("needs attention");case"not-taken":return t.includes("not taken")||t.includes("not-taken");case"cancelled":return t.includes("cancel")||t.includes("cancella")||i.includes("cancel")||e.commission_status?.toLowerCase().includes("cancel")||i.includes("return")||i.includes("nsf")||i.includes("insuffic")||i.includes("funds")||i.includes("draft return");default:return!0}}),eT=e=>{let t=e.trim().split(/[\r\n]+/);if(t.length<2)return!1;let s=(t[0].match(/\t/g)||[]).length,i=t.length>1?(t[1].match(/\t/g)||[]).length:0;return s>0&&s===i},eU=(e,t)=>{let s={"proposed insured":"proposed_insured",proposed_insured:"proposed_insured","client name":"proposed_insured",client_name:"proposed_insured","customer name":"proposed_insured",customer_name:"proposed_insured","insured name":"proposed_insured",insured_name:"proposed_insured",name:"proposed_insured","full name":"proposed_insured",full_name:"proposed_insured",client:"proposed_insured",insured:"proposed_insured","client phone number":"client_phone_number",client_phone_number:"client_phone_number","phone number":"client_phone_number",phone_number:"client_phone_number",phone:"client_phone_number",telephone:"client_phone_number",cell:"client_phone_number",mobile:"client_phone_number",contact:"client_phone_number","client email":"client_email",client_email:"client_email",email:"client_email","e-mail":"client_email",e_mail:"client_email",mail:"client_email","client state":"client_state",client_state:"client_state",state:"client_state",province:"client_state",st:"client_state",month:"month",mo:"month",mth:"month","policy submit date":"policy_submit_date",policy_submit_date:"policy_submit_date","submit date":"policy_submit_date","submission date":"policy_submit_date","application date":"policy_submit_date","date submitted":"policy_submit_date",date_submitted:"policy_submit_date",submitted:"policy_submit_date","policy #":"policy_number","policy#":"policy_number","policy no":"policy_number","policy number":"policy_number",policy_number:"policy_number","policy id":"policy_number",policy_id:"policy_number","policy num":"policy_number",policy_num:"policy_number",carrier:"carrier",company:"carrier",provider:"carrier",insurer:"carrier","insurance company":"carrier","carrier name":"carrier",carrier_name:"carrier",product:"product","policy type":"product",policy_type:"product","insurance type":"product",insurance_type:"product",plan:"product","coverage type":"product",coverage_type:"product","monthly premium":"monthly_premium",monthly_premium:"monthly_premium","premium monthly":"monthly_premium",premium_monthly:"monthly_premium",monthly:"monthly_premium","mo premium":"monthly_premium",mo_premium:"monthly_premium",ap:"ap","annual premium":"ap",annual_premium:"ap","yearly premium":"ap",yearly_premium:"ap","premium annual":"ap",premium_annual:"ap",annual:"ap",yearly:"ap",status:"status","application status":"status",application_status:"status","policy status":"status",policy_status:"status","current status":"status",current_status:"status","paid status":"paid_status",paid_status:"paid_status","payment status":"paid_status",payment_status:"paid_status",paid:"paid_status","closed by agent":"closed_by_agent",closed_by_agent:"closed_by_agent","agent closed":"closed_by_agent","closed by":"closed_by_agent",closed_by:"closed_by_agent","point of sale":"point_of_sale",point_of_sale:"point_of_sale",pos:"point_of_sale","sale location":"point_of_sale",sale_location:"point_of_sale","pms form filled out":"pms_form_filled_out",pms_form_filled_out:"pms_form_filled_out","pms form":"pms_form_filled_out",pms_form:"pms_form_filled_out","split with":"split_with",split_with:"split_with","agent split":"split_with",agent_split:"split_with","shared with":"split_with",shared_with:"split_with",split:"split_with","effective policy date":"effective_policy_date",effective_policy_date:"effective_policy_date","effective date":"effective_policy_date",effective_date:"effective_policy_date","start date":"effective_policy_date",start_date:"effective_policy_date","policy start date":"effective_policy_date",policy_start_date:"effective_policy_date","effective policy status":"effective_policy_status",effective_policy_status:"effective_policy_status",notes:"notes",comments:"notes",remarks:"notes","notes for pay":"notes_for_pay",notes_for_pay:"notes_for_pay","payment notes":"notes_for_pay",payment_notes:"notes_for_pay","paid split":"paid_split",paid_split:"paid_split","paid split?":"paid_split","commission status":"commission_status",commission_status:"commission_status","comm status":"commission_status",comm_status:"commission_status","commission paid date":"commission_paid_date",commission_paid_date:"commission_paid_date","comm paid date":"commission_paid_date",comm_paid_date:"commission_paid_date","commission amount":"commission_amount",commission_amount:"commission_amount","comm amount":"commission_amount",comm_amount:"commission_amount","payment cycle":"policy_payment_cycle",payment_cycle:"policy_payment_cycle","policy payment cycle":"policy_payment_cycle",policy_payment_cycle:"policy_payment_cycle"},i={};t.forEach(e=>{i[e]="unmapped"}),t.forEach(e=>{let t=e.toLowerCase().trim();if(s[t]){i[e]=s[t];return}for(let[a,l]of Object.entries(s))if(t.includes(a)){i[e]=l;return}t.includes("phone")?i[e]="client_phone_number":t.includes("email")?i[e]="client_email":t.includes("state")?i[e]="client_state":t.includes("policy")&&(t.includes("num")||t.includes("#"))?i[e]="policy_number":t.includes("premium")&&!t.includes("annual")?i[e]="monthly_premium":t.includes("premium")&&t.includes("annual")?i[e]="ap":t.includes("notes")&&!t.includes("pay")&&(i[e]="notes")}),console.log("Auto-mapped columns:",i),er(i)};async function eB(){Y(!0),el(0),eg([]);try{if(0===Object.keys(en).length){U("Please map at least one column before importing"),Y(!1);return}if(!R||0===R.length){U("No data to import"),Y(!1);return}let{data:{session:e}}=await Q.auth.getSession();if(!e){U("You must be logged in to import data"),Y(!1);return}let t=e=>{if(null==e||""===e)return null;if("number"==typeof e)return e;if("string"==typeof e){let t=e.replace(/[$,]/g,"").trim();if(!t)return null;let s=parseFloat(t);return isNaN(s)?null:s}return null},s=e=>{if(!e)return null;try{if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}/.test(e))return e.split("T")[0];if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(e)){let[t,s,i]=e.split("/").map(e=>parseInt(e,10));return`${i}-${t.toString().padStart(2,"0")}-${s.toString().padStart(2,"0")}`}if(/^\d{1,2}-\d{1,2}-\d{4}$/.test(e)){let[t,s,i]=e.split("-").map(e=>parseInt(e,10));return`${i}-${t.toString().padStart(2,"0")}-${s.toString().padStart(2,"0")}`}let t=new Date(e);return isNaN(t.getTime())?null:t.toISOString().split("T")[0]}if(e instanceof Date)return e.toISOString().split("T")[0]}catch(t){console.error("Date conversion error:",t,"for value:",e)}return null},i=e=>{if("boolean"==typeof e)return e;if("string"==typeof e){let t=e.trim().toLowerCase();return["yes","true","y","1","on","checked"].includes(t)}return"number"==typeof e&&1===e};console.log("Processing bulk data import for",R.length,"records");let a=R.map((a,l)=>{let n={agent_id:e.user.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return Object.entries(en).forEach(e=>{let[l,r]=e;if("unmapped"!==r){let e=a[l];if(null==e)return;switch(r){case"pms_form_filled_out":n[r]=i(e);break;case"monthly_premium":case"ap":case"commission_amount":n[r]=t(e);break;case"policy_submit_date":case"effective_policy_date":case"commission_paid_date":n[r]=s(e);break;default:if("string"==typeof e){let t=e.trim();n[r]=""===t?null:t}else void 0!==e&&(n[r]=String(e))}}}),(!n.commission_amount||0===n.commission_amount)&&n.monthly_premium&&n.monthly_premium>0&&(n.commission_amount=4.5*n.monthly_premium,console.log(`Auto-calculated commission for record ${l+1}: $${n.commission_amount.toFixed(2)} from premium $${n.monthly_premium}`)),n}),l=[],n=[];if(a.forEach((e,t)=>{let s=[];e.proposed_insured||s.push("Client name (Proposed Insured) is required"),e.client_phone_number||s.push("Client phone number is required"),e.carrier||e.carrier_id||s.push("Carrier information is required"),e.product||s.push("Product/Policy type is required"),s.length>0?n.push(`Row ${t+2}: ${s.join(", ")}`):l.push(e)}),0===l.length){U("No valid records to import. Please check the validation errors and try again."),ey(!1),Y(!1);return}console.log(`Validated ${l.length} records out of ${a.length}`);let r=[];for(let e=0;e<l.length;e+=5)r.push(l.slice(e,e+5));console.log(`Processing ${r.length} batches with batch size 5`);let o=0,c=0,d=[...n];for(let e=0;e<r.length;e++){let t=r[e];try{console.log(`Processing batch ${e+1} with ${t.length} records`);let{data:s,error:i}=await Q.from("agent_applications").insert(t).select("id");i?(console.error(`Batch ${e+1} error:`,i),c+=t.length,d.push(`Batch ${e+1} error: ${i.message||"Unknown database error"}`)):(console.log(`Batch ${e+1} success:`,s),o+=s.length,d.push(`Batch ${e+1}: Successfully imported ${s.length} records`))}catch(s){console.error(`Exception in batch ${e+1}:`,s),c+=t.length,d.push(`Batch ${e+1} error: ${s.message||"Unknown error"}`)}let s=Math.round((e+1)/r.length*100);el(s),eg(d),await new Promise(e=>setTimeout(e,300))}ey(!0),Y(!1),el(100),eg(d),o>0?c>0?U(`Partial success: ${o} records imported, ${c} failed. See details below.`):(U(null),M({title:"Import successful",description:`Successfully imported all ${o} records.`}),q(!1),F(""),L([]),er({}),em(!1),eR()):U(`Import failed: All ${c} records failed to import. See details below.`)}catch(e){console.error("Unexpected error during import:",e),U(`Import failed: ${e.message||"Unknown error"}`),ey(!1),Y(!1),el(0),eg([`System error: ${e.message||"Unknown error"}`])}finally{Y(!1)}}let eq=S.z.map(e=>"actions"===e.id?{...e,cell:e=>{let{row:t}=e,s=t.original;return(0,i.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,i.jsxs)(o.z,{variant:"outline",size:"sm",className:"h-8 px-3 text-xs bg-blue-50 border-blue-200 text-blue-600 hover:bg-blue-100",onClick:()=>{console.log("Navigating to edit page for application:",s.id),window.location.href=`/agent/applications/${s.id}/edit`},children:[(0,i.jsx)(f,{className:"h-3.5 w-3.5 mr-1.5"}),"Edit"]}),(0,i.jsxs)(o.z,{variant:"outline",size:"sm",className:"h-8 px-3 text-xs text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200",onClick:()=>eV(s.id),disabled:eM,children:[(0,i.jsx)(y,{className:"h-3.5 w-3.5 mr-1.5"}),"Delete"]}),(0,i.jsx)(K.c,{applicationId:s.id})]})}}:e),eV=async e=>{if(e)try{eQ(!0);let{data:{session:s},error:i}=await Q.auth.getSession();if(i){console.error("Error getting session:",i),M({title:"Authentication Error",description:"Unable to verify your session. Please refresh the page and try again.",variant:"destructive"}),eQ(!1);return}if(!s){M({title:"Authentication Error",description:"You must be logged in to delete applications. Please refresh the page and try again.",variant:"destructive"}),eQ(!1);return}if(!window.confirm("Are you sure you want to delete this application?")){eQ(!1);return}console.log(`Attempting to delete application: ${e}`);try{let{error:s}=await Q.from("agent_applications").delete().eq("id",e);if(s)throw console.log("Direct delete failed, falling back to API:",s.message),Error("Direct delete failed");console.log("Application deleted successfully via direct RLS access"),t(t=>t.filter(t=>t.id!==e)),M({title:"Success",description:"Application deleted successfully"});return}catch(e){console.log("Falling back to API route for deletion")}let a=await fetch("/api/applications/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({applicationId:e,userId:s.user.id}),credentials:"include"});if(!a.ok){if(401===a.status){M({title:"Session Expired",description:"Your session has expired. Please refresh the page to log in again.",variant:"destructive"});return}if(403===a.status){M({title:"Permission Denied",description:"You do not have permission to delete this application.",variant:"destructive"});return}let e=await a.json();throw Error(e.error||"Failed to delete application")}let l=await a.json();l.success?(t(t=>t.filter(t=>t.id!==e)),M({title:"Success",description:"Application deleted successfully"})):(console.error("Error deleting application:",l.error),M({title:"Error",description:l.error||"Failed to delete application",variant:"destructive"}))}catch(e){console.error("Error deleting application:",e),M({title:"Error",description:e.message||"An unexpected error occurred",variant:"destructive"})}finally{eQ(!1)}};return(0,i.jsx)(D.pn,{children:(0,i.jsxs)("div",{className:"container mx-auto py-6 space-y-6",children:[(0,i.jsx)("div",{className:"flex justify-between items-center",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"My Insurance Applications"}),(0,i.jsx)("p",{className:"text-muted-foreground",children:"Manage your insurance applications and payment history"})]})}),!s&&(0,i.jsx)(()=>{let e=eF();return(0,i.jsx)("div",{className:"mb-6",children:(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[(0,i.jsx)(r.Zb,{className:"stat-card total card-hover-effect",children:(0,i.jsx)(r.aY,{className:"pt-6",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{className:"stat-info",children:[(0,i.jsx)("p",{className:"stat-label",children:"Total Policies"}),(0,i.jsx)("h3",{className:"stat-value",children:e.totalPolicies})]}),(0,i.jsx)("div",{className:"stat-icon",children:(0,i.jsx)(d.Z,{className:"h-6 w-6"})})]})})}),(0,i.jsx)(r.Zb,{className:"stat-card approved card-hover-effect",children:(0,i.jsx)(r.aY,{className:"pt-6",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{className:"stat-info",children:[(0,i.jsx)("p",{className:"stat-label",children:"Approved"}),(0,i.jsx)("h3",{className:"stat-value",children:e.approvedPolicies})]}),(0,i.jsx)("div",{className:"stat-icon",children:(0,i.jsx)(m.Z,{className:"h-6 w-6"})})]})})}),(0,i.jsx)(r.Zb,{className:"stat-card attention card-hover-effect",children:(0,i.jsx)(r.aY,{className:"pt-6",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{className:"stat-info",children:[(0,i.jsx)("p",{className:"stat-label",children:"Needs Attention"}),(0,i.jsx)("h3",{className:"stat-value",children:e.needsAttentionPolicies})]}),(0,i.jsx)("div",{className:"stat-icon",children:(0,i.jsx)(p.Z,{className:"h-6 w-6"})})]})})}),(0,i.jsx)(r.Zb,{className:"stat-card paid card-hover-effect",children:(0,i.jsx)(r.aY,{className:"pt-6",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{className:"stat-info",children:[(0,i.jsx)("p",{className:"stat-label",children:"Paid Policies"}),(0,i.jsx)("h3",{className:"stat-value",children:e.paidPolicies})]}),(0,i.jsx)("div",{className:"stat-icon",children:(0,i.jsx)(u.Z,{className:"h-6 w-6"})})]})})}),(0,i.jsx)(r.Zb,{className:"stat-card premium card-hover-effect",children:(0,i.jsx)(r.aY,{className:"pt-6",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{className:"stat-info",children:[(0,i.jsx)("p",{className:"stat-label",children:"Annual Premium"}),(0,i.jsxs)("h3",{className:"stat-value",children:["$",e.totalAnnualPremium.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,i.jsx)("div",{className:"stat-icon",children:(0,i.jsx)(h.Z,{className:"h-6 w-6"})})]})})})]})})},{}),(0,i.jsx)(P.tE,{}),(0,i.jsxs)("div",{className:"h-full flex flex-col overflow-hidden",children:[(0,i.jsx)(r.Zb,{className:"mb-4",children:(0,i.jsx)(r.Ol,{children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("div",{}),(0,i.jsxs)("div",{className:"flex space-x-2",children:[(0,i.jsxs)(o.z,{onClick:()=>O.push("/agent/applications/new"),className:"flex items-center gap-2",children:[(0,i.jsx)(x.Z,{className:"h-4 w-4"})," New Application"]}),(0,i.jsxs)(A.Vq,{open:B,onOpenChange:q,children:[(0,i.jsx)(A.hg,{asChild:!0,children:(0,i.jsx)(o.z,{variant:"outline",children:"Bulk Add Applications"})}),(0,i.jsxs)(A.cZ,{className:"w-[90vw] max-h-[85vh] max-w-[1000px] overflow-auto bg-background border shadow-lg p-4",style:{backgroundColor:"white"},children:[(0,i.jsxs)(A.fK,{children:[(0,i.jsx)(A.$N,{children:"Bulk Add Applications"}),(0,i.jsx)(A.Be,{children:"Import multiple applications at once from a spreadsheet or CSV file."})]}),ef?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center py-10",children:[(0,i.jsx)("div",{className:"mb-4 rounded-full bg-green-100 p-3",children:(0,i.jsx)(m.Z,{className:"h-8 w-8 text-green-600"})}),(0,i.jsx)("h3",{className:"text-xl font-semibold",children:"Import Successful"}),(0,i.jsx)("p",{className:"text-center text-muted-foreground mt-2",children:"Your applications have been imported successfully."}),ex.length>0&&(0,i.jsxs)("div",{className:"mt-4 max-h-[200px] overflow-auto border rounded p-3 text-sm w-full",children:[(0,i.jsx)("h4",{className:"font-medium mb-2",children:"Import Details:"}),(0,i.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:ex.map((e,t)=>(0,i.jsx)("li",{className:e.includes("error")?"text-red-600":"text-green-600",children:e},t))})]}),(0,i.jsx)(o.z,{className:"mt-6",onClick:()=>{q(!1),F(""),L([]),U(""),em(!1),H("paste"),ei(null),el(0),er({}),ec([]),eu(0),e_(0),ey(!1),eg([])},children:"Close"})]}):V&&ea>0?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center py-10",children:[(0,i.jsx)(G,{value:ea,className:"w-full max-w-md mb-4"}),(0,i.jsxs)("p",{className:"text-center text-sm text-muted-foreground",children:["Importing your applications... ",ea,"%"]})]}):ed?(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"mt-4 mb-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Map Your Columns"}),(0,i.jsxs)("p",{className:"text-sm text-muted-foreground mb-4",children:["We've found ",R.length," rows. Please match each column to the appropriate field in our system."]}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-3 mb-4",children:[(0,i.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>{if(!R||0===R.length){U("No data available to map");return}let e={"proposed insured":"proposed_insured",proposed_insured:"proposed_insured","client name":"proposed_insured","customer name":"proposed_insured","full name":"proposed_insured",name:"proposed_insured",client:"proposed_insured",insured:"proposed_insured","client phone":"client_phone_number","client phone number":"client_phone_number",client_phone_number:"client_phone_number","phone number":"client_phone_number",phone:"client_phone_number",contact:"client_phone_number",mobile:"client_phone_number",cell:"client_phone_number","client email":"client_email",client_email:"client_email",email:"client_email","e-mail":"client_email","client state":"client_state",client_state:"client_state",state:"client_state",st:"client_state",month:"month",mth:"month",mo:"month","policy submit date":"policy_submit_date",policy_submit_date:"policy_submit_date","submit date":"policy_submit_date","date submitted":"policy_submit_date","submission date":"policy_submit_date","application date":"policy_submit_date","policy number":"policy_number",policy_number:"policy_number","policy #":"policy_number","policy#":"policy_number","policy no":"policy_number","policy no.":"policy_number",policy_no:"policy_number",carrier:"carrier",carrier_id:"carrier_id","insurance company":"carrier","insurance provider":"carrier",company:"carrier",provider:"carrier",product:"product","policy type":"product",policy_type:"product",type:"product",plan:"product","monthly premium":"monthly_premium",monthly_premium:"monthly_premium",premium:"monthly_premium",monthly:"monthly_premium","mo premium":"monthly_premium",ap:"ap","annual premium":"ap",annual_premium:"ap","yearly premium":"ap",annual:"ap",status:"status","application status":"status","app status":"status","policy status":"status","paid status":"paid_status",paid_status:"paid_status","payment status":"paid_status","closed by agent":"closed_by_agent",closed_by_agent:"closed_by_agent","agent closed":"closed_by_agent","closed by":"closed_by_agent","point of sale":"point_of_sale",point_of_sale:"point_of_sale",pos:"point_of_sale","sale location":"point_of_sale","pms form filled out":"pms_form_filled_out",pms_form_filled_out:"pms_form_filled_out","pms form":"pms_form_filled_out",pms:"pms_form_filled_out","split with":"split_with",split_with:"split_with","agent split":"split_with",split:"split_with","effective policy date":"effective_policy_date",effective_policy_date:"effective_policy_date","effective date":"effective_policy_date","start date":"effective_policy_date","effective policy status":"effective_policy_status",effective_policy_status:"effective_policy_status",notes:"notes",comments:"notes",remarks:"notes","notes for pay":"notes_for_pay",notes_for_pay:"notes_for_pay","payment notes":"notes_for_pay","paid split":"paid_split",paid_split:"paid_split","paid split?":"paid_split","commission status":"commission_status",commission_status:"commission_status","comm status":"commission_status","commission paid date":"commission_paid_date",commission_paid_date:"commission_paid_date","comm paid date":"commission_paid_date","policy payment cycle":"policy_payment_cycle",policy_payment_cycle:"policy_payment_cycle","payment cycle":"policy_payment_cycle",cycle:"policy_payment_cycle","commission amount":"commission_amount",commission_amount:"commission_amount","comm amount":"commission_amount"},t={};Object.keys(R[0]||{}).forEach(e=>{t[e]="unmapped"}),Object.keys(R[0]||{}).forEach(s=>{let i=s.toLowerCase().trim();if(e[i]){t[s]=e[i];return}for(let[a,l]of Object.entries(e))if(i.includes(a.toLowerCase())){t[s]=l;return}i.includes("phone")||i.includes("mobile")||i.includes("cell")?t[s]="client_phone_number":i.includes("email")?t[s]="client_email":i.includes("state")?t[s]="client_state":i.includes("premium")&&!i.includes("annual")?t[s]="monthly_premium":i.includes("premium")&&i.includes("annual")?t[s]="ap":i.includes("policy")&&(i.includes("number")||i.includes("#"))?t[s]="policy_number":i.includes("date")&&i.includes("submit")?t[s]="policy_submit_date":(i.includes("name")||i.includes("insured"))&&(t[s]="proposed_insured")}),console.log("Auto-mapped fields:",t),er(t),M({title:"Auto-mapping applied",description:"Column mappings have been automatically determined based on column names."})},children:[(0,i.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Auto-map columns"]}),(0,i.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>{let e={};Object.keys(R[0]||{}).forEach(t=>{e[t]="unmapped"}),er(e)},children:[(0,i.jsx)(b.Z,{className:"h-4 w-4 mr-2"}),"Clear all mappings"]})]})]}),(0,i.jsx)("div",{className:"max-h-[50vh] overflow-auto border rounded-md",children:(0,i.jsxs)(I.iA,{children:[(0,i.jsx)(I.xD,{className:"bg-muted sticky top-0 z-10",children:(0,i.jsx)(I.SC,{className:"hover:bg-transparent",children:Object.keys(R[0]||{}).map(e=>(0,i.jsxs)(I.ss,{className:"text-xs text-center p-2 border-r border-gray-200 last:border-r-0",children:[(0,i.jsx)("div",{className:"mb-2 font-bold text-gray-900 break-words max-w-[150px]",children:e}),(0,i.jsxs)(X.Ph,{value:en[e]||"unmapped",onValueChange:t=>{er(s=>({...s,[e]:t}))},children:[(0,i.jsx)(X.i4,{className:`h-8 text-xs bg-white w-full max-w-[150px] mx-auto ${en[e]&&"unmapped"!==en[e]?"bg-blue-50 border-blue-300 text-blue-700":""}`,children:(0,i.jsx)(X.ki,{placeholder:"Select field..."})}),(0,i.jsxs)(X.Bw,{className:"max-h-[300px]",children:[(0,i.jsxs)(X.DI,{children:[(0,i.jsx)(X.n5,{children:"Basic Client Info"}),(0,i.jsx)(X.Ql,{value:"unmapped",children:"- Ignore this column -"}),(0,i.jsx)(X.Ql,{value:"proposed_insured",children:"Proposed Insured"}),(0,i.jsx)(X.Ql,{value:"client_phone_number",children:"Client Phone Number"}),(0,i.jsx)(X.Ql,{value:"client_state",children:"Client State"}),(0,i.jsx)(X.Ql,{value:"client_email",children:"Client Email"})]}),(0,i.jsxs)(X.DI,{children:[(0,i.jsx)(X.n5,{children:"Policy Basics"}),(0,i.jsx)(X.Ql,{value:"policy_number",children:"Policy Number"}),(0,i.jsx)(X.Ql,{value:"carrier",children:"Carrier"}),(0,i.jsx)(X.Ql,{value:"carrier_id",children:"Carrier ID"}),(0,i.jsx)(X.Ql,{value:"product",children:"Product"}),(0,i.jsx)(X.Ql,{value:"monthly_premium",children:"Monthly Premium"}),(0,i.jsx)(X.Ql,{value:"ap",children:"AP (Annual Premium)"}),(0,i.jsx)(X.Ql,{value:"status",children:"Status"}),(0,i.jsx)(X.Ql,{value:"paid_status",children:"Paid Status"})]}),(0,i.jsxs)(X.DI,{children:[(0,i.jsx)(X.n5,{children:"Dates"}),(0,i.jsx)(X.Ql,{value:"month",children:"Month"}),(0,i.jsx)(X.Ql,{value:"policy_submit_date",children:"Policy Submit Date"}),(0,i.jsx)(X.Ql,{value:"effective_policy_date",children:"Effective Policy Date"}),(0,i.jsx)(X.Ql,{value:"commission_paid_date",children:"Commission Paid Date"})]}),(0,i.jsxs)(X.DI,{children:[(0,i.jsx)(X.n5,{children:"Agent Information"}),(0,i.jsx)(X.Ql,{value:"closed_by_agent",children:"Closed By Agent"}),(0,i.jsx)(X.Ql,{value:"point_of_sale",children:"Point of Sale"}),(0,i.jsx)(X.Ql,{value:"pms_form_filled_out",children:"PMS Form Filled Out"}),(0,i.jsx)(X.Ql,{value:"split_with",children:"Split With"}),(0,i.jsx)(X.Ql,{value:"paid_split",children:"Paid Split"})]}),(0,i.jsxs)(X.DI,{children:[(0,i.jsx)(X.n5,{children:"Commission & Status"}),(0,i.jsx)(X.Ql,{value:"effective_policy_status",children:"Effective Policy Status"}),(0,i.jsx)(X.Ql,{value:"commission_status",children:"Commission Status"}),(0,i.jsx)(X.Ql,{value:"policy_payment_cycle",children:"Policy Payment Cycle"}),(0,i.jsx)(X.Ql,{value:"commission_amount",children:"Commission Amount"})]}),(0,i.jsxs)(X.DI,{children:[(0,i.jsx)(X.n5,{children:"Notes"}),(0,i.jsx)(X.Ql,{value:"notes",children:"Notes"}),(0,i.jsx)(X.Ql,{value:"notes_for_pay",children:"Notes for Pay"})]})]})]})]},`header-${e}`))})}),(0,i.jsx)(I.RM,{children:R.slice(0,5).map((e,t)=>(0,i.jsx)(I.SC,{className:t%2==0?"bg-gray-50":"",children:Object.keys(e).map(s=>(0,i.jsx)(I.pj,{className:"p-2 border-r border-gray-200 last:border-r-0 text-xs",children:"string"==typeof e[s]?e[s]:String(e[s]||"")},`cell-${t}-${s}`))},`preview-row-${t}`))})]})}),(0,i.jsxs)("div",{className:"mt-4 bg-gray-50 p-3 rounded-md border border-gray-200",children:[(0,i.jsxs)("p",{className:"text-sm font-medium",children:["Preview of first 5 rows (",R.length," total rows found)"]}),(0,i.jsxs)("div",{className:"flex gap-6 mt-2",children:[(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsx)("span",{className:"font-bold",children:"Required fields: "}),(0,i.jsx)("span",{className:en.proposed_insured?"text-green-600":"text-red-500",children:"Proposed Insured"}),",",(0,i.jsx)("span",{className:en.carrier?"text-green-600":"text-red-500",children:" Carrier"}),",",(0,i.jsx)("span",{className:en.product?"text-green-600":"text-red-500",children:" Product"})]}),(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsx)("span",{className:"font-bold",children:"Mapped: "}),(0,i.jsx)("span",{className:"font-mono",children:Object.values(en).filter(e=>e&&"ignore"!==e).length})," of ",(0,i.jsx)("span",{className:"font-mono",children:Object.keys(R[0]||{}).length})," columns"]})]})]}),(0,i.jsxs)("div",{className:"flex justify-end mt-6 space-x-2",children:[(0,i.jsx)(o.z,{variant:"outline",onClick:()=>em(!1),children:"Back"}),(0,i.jsx)(o.z,{onClick:eB,disabled:V||0===Object.values(en).filter(Boolean).length,className:0===Object.values(en).filter(Boolean).length?"opacity-50 cursor-not-allowed":"",children:V?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Importing..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"Import Applications"]})})]})]}):(0,i.jsxs)("div",{children:[(0,i.jsxs)(c.mQ,{defaultValue:"paste",className:"mt-4",onValueChange:e=>{H(e),U("")},children:[(0,i.jsxs)(c.dr,{className:"grid w-full max-w-md grid-cols-2",children:[(0,i.jsx)(c.SP,{value:"paste",children:"Paste Data"}),(0,i.jsx)(c.SP,{value:"upload",children:"Upload CSV"})]}),(0,i.jsx)(c.nU,{value:"paste",className:"mt-4",children:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid gap-2",children:[(0,i.jsx)(J._,{htmlFor:"bulkData",children:"Paste your spreadsheet data"}),(0,i.jsx)(E.g,{id:"bulkData",placeholder:"Paste data from Excel, Google Sheets, or CSV",className:"min-h-[200px] font-mono text-xs",value:z,onChange:e=>{F(e.target.value),U("")}})]}),(0,i.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,i.jsx)("p",{children:"Tips for pasting data:"}),(0,i.jsxs)("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[(0,i.jsx)("li",{children:"Make sure your data includes a header row"}),(0,i.jsx)("li",{children:"Supported delimiters: comma, tab, semicolon"}),(0,i.jsx)("li",{children:"Copy directly from Excel, Google Sheets, or other spreadsheet apps"})]})]})]})}),(0,i.jsx)(c.nU,{value:"upload",className:"mt-4",children:(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-lg p-12",children:[(0,i.jsx)(g,{className:"h-8 w-8 text-muted-foreground mb-4"}),(0,i.jsx)("p",{className:"mb-4 text-sm text-muted-foreground text-center",children:"Drag and drop your CSV file here, or click to select a file"}),(0,i.jsx)("input",{type:"file",accept:".csv,.xls,.xlsx,.txt",onChange:e=>{let t=e.target.files?.[0];if(!t)return;U(""),ei(t);let s=new FileReader;s.onload=e=>{let t=e.target?.result;t&&F(t)},s.onerror=()=>{U("Failed to read file. Please try again.")},s.readAsText(t)},className:"hidden",id:"file-upload"}),(0,i.jsx)(o.z,{asChild:!0,variant:"outline",size:"sm",children:(0,i.jsx)("label",{htmlFor:"file-upload",className:"cursor-pointer",children:"Choose File"})}),es&&(0,i.jsxs)("div",{className:"mt-4 text-sm",children:["Selected: ",(0,i.jsx)("span",{className:"font-medium",children:es.name})]})]})})]}),T&&(0,i.jsx)("div",{className:"bg-red-50 text-red-600 p-3 rounded mt-4 text-sm",children:T}),(0,i.jsxs)("div",{className:"flex justify-end mt-6 space-x-2",children:[(0,i.jsx)(o.z,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),(0,i.jsxs)(o.z,{onClick:function(){U(""),em(!1);try{let e;if(!z||""===z.trim()){U("Please enter or upload data first"),L([]);return}let t=eT(z),s=z.trim().replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n").filter(e=>""!==e.trim());if(s.length<2){U("Please include at least one header row and one data row"),L([]);return}console.log(`Processing ${s.length} lines of data`);let i=s[0];if(t)e="	",console.log("Excel paste detected, using tab delimiter");else{let t=(i.match(/,/g)||[]).length,s=(i.match(/\t/g)||[]).length,a=(i.match(/\|/g)||[]).length,l=(i.match(/;/g)||[]).length;e=t>=s&&t>=a&&t>=l?",":s>=t&&s>=a&&s>=l?"	":l>=t&&l>=s&&l>=a?";":a>=t&&a>=s&&a>=l?"|":","}console.log("Detected delimiter:",e,"in line:",i);let a=[],l=(e,t)=>e.trim()||`Column_${t+1}`;if(","===e){let t;let s=[],n=/(?:,|\n|^)("(?:(?:"")*[^"]*)*"|[^",\n]*|(?:\n|$))/g;for(;null!==(t=n.exec(i+","));){let e=t[1];e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1).replace(/""/g,'"')),s.push(e)}a=s.length>1?s.map(l):i.split(e).map((e,t)=>l(e.trim().replace(/^"|"$/g,""),t))}else a=i.split(e).map((e,t)=>l(e.trim(),t));if(console.log("Detected headers:",a),a.length<=1){U(`Could not parse headers properly. Detected only ${a.length} columns with delimiter "${e}". Try a different file format or delimiter.`),L([]);return}ec(["proposed_insured","client_phone_number","client_state","client_email","policy_type","coverage_amount","monthly_premium","annual_premium","carrier","product","status","paid_status","policy_number","month","policy_submit_date","effective_policy_date","point_of_sale","notes","notes_for_pay","paid_split","client_state","policy_","closed_by_agent","ap","client_name","insured_name","customer_name","name","phone","email","premium","commission","company","carrier_name","effective_date","submit_date","commission_status","commission_paid_date","policy_payment_cycle","commission_amount","split_with","effective_policy_status","pms_form_filled_out"]);let n=0,r=0,o=s.slice(1).filter(Boolean).map((t,s)=>{if(!t.trim())return r++,null;let i=[];if(","===e){let s;let a=[],l=/(?:,|\n|^)("(?:(?:"")*[^"]*)*"|[^",\n]*|(?:\n|$))/g;for(;null!==(s=l.exec(t+","));){let e=s[1];e&&e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1).replace(/""/g,'"')),a.push(void 0!==e?e:"")}i=a.length>1?a:t.split(e).map(e=>e.trim().replace(/^"|"$/g,""))}else i="	"===e?t.split(e):t.replace(/"([^"]*)"/g,(t,s)=>s.replace(RegExp(e,"g"),"___DELIMITER___")).split(e).map(t=>t.replace(/___DELIMITER___/g,e).trim());for(;i.length<a.length;)i.push("");i.length>a.length&&(i=i.slice(0,a.length));let l={};return a.forEach((e,t)=>{if(e){let s=i[t]||"";if(s.match(/^[$]?[0-9,.]+$/)){let t=parseFloat(s.replace(/[$,]/g,""));l[e]=isNaN(t)?s:t}else if(s.match(/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}$/))try{let t=new Date(s);isNaN(t.getTime())?l[e]=s:l[e]=t.toISOString().split("T")[0]}catch(t){l[e]=s}else l[e]=s}}),n++,l}).filter(Boolean);eu(n),e_(r),o.length>0?(console.log(`Parsed ${o.length} valid rows, first row:`,o[0]),L(o),em(!0),eU(o[0],a)):(U("No valid data rows found. Please check your data format."),L([]))}catch(e){console.error("Error parsing bulk data:",e),U(`Failed to parse data: ${e.message}. Please check format and try again.`),L([])}},disabled:"paste"===W&&!z.trim()||"file"===W&&!es,className:("paste"!==W||z.trim())&&("file"!==W||es)?"":"opacity-50 cursor-not-allowed",children:[(0,i.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"Continue to Mapping"]})]})]})]})]})]})]})})}),(0,i.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,i.jsxs)(c.mQ,{value:$,onValueChange:function(e){Z(e)},className:"flex-1 flex flex-col",children:[(0,i.jsxs)(c.dr,{className:"mb-4",children:[(0,i.jsx)(c.SP,{value:"all",children:"All Applications"}),(0,i.jsx)(c.SP,{value:"approved",children:"Approved"}),(0,i.jsx)(c.SP,{value:"pending-first-payment",children:"Pending First Payment"}),(0,i.jsx)(c.SP,{value:"pending-payment",children:"Pending Payment"}),(0,i.jsx)(c.SP,{value:"paid-issued",children:"Paid & Issued"}),(0,i.jsx)(c.SP,{value:"not-taken",children:"Not Taken"}),(0,i.jsx)(c.SP,{value:"needs-attention",children:"Needs Attention"}),(0,i.jsx)(c.SP,{value:"cancelled",children:"Cancelled"})]}),(0,i.jsx)(c.nU,{value:"all",className:"flex-1 overflow-hidden",children:s?(0,i.jsx)(et,{}):(0,i.jsx)(ee.S,{children:(0,i.jsx)(n.w,{columns:eq,data:eL,state:{rowSelection:eP},onRowSelectionChange:ek})})}),(0,i.jsx)(c.nU,{value:"approved",className:"flex-1 overflow-hidden",children:s?(0,i.jsx)(et,{}):(0,i.jsx)(ee.S,{children:(0,i.jsx)(n.w,{columns:eq,data:eL,state:{rowSelection:eP},onRowSelectionChange:ek})})}),(0,i.jsx)(c.nU,{value:"pending-first-payment",className:"flex-1 overflow-hidden",children:s?(0,i.jsx)(et,{}):(0,i.jsx)(ee.S,{children:(0,i.jsx)(n.w,{columns:eq,data:eL,state:{rowSelection:eP},onRowSelectionChange:ek})})}),(0,i.jsx)(c.nU,{value:"pending-payment",className:"flex-1 overflow-hidden",children:s?(0,i.jsx)(et,{}):(0,i.jsx)(ee.S,{children:(0,i.jsx)(n.w,{columns:eq,data:eL,state:{rowSelection:eP},onRowSelectionChange:ek})})}),(0,i.jsx)(c.nU,{value:"paid-issued",className:"flex-1 overflow-hidden",children:s?(0,i.jsx)(et,{}):(0,i.jsx)(ee.S,{children:(0,i.jsx)(n.w,{columns:eq,data:eL,state:{rowSelection:eP},onRowSelectionChange:ek})})}),(0,i.jsx)(c.nU,{value:"not-taken",className:"flex-1 overflow-hidden",children:s?(0,i.jsx)(et,{}):(0,i.jsx)(ee.S,{children:(0,i.jsx)(n.w,{columns:eq,data:eL,state:{rowSelection:eP},onRowSelectionChange:ek})})}),(0,i.jsx)(c.nU,{value:"needs-attention",className:"flex-1 overflow-hidden",children:s?(0,i.jsx)(et,{}):(0,i.jsx)(ee.S,{children:(0,i.jsx)(n.w,{columns:eq,data:eL,state:{rowSelection:eP},onRowSelectionChange:ek})})}),(0,i.jsx)(c.nU,{value:"cancelled",className:"flex-1 overflow-hidden",children:s?(0,i.jsx)(et,{}):(0,i.jsx)(ee.S,{children:(0,i.jsx)(n.w,{columns:eq,data:eL,state:{rowSelection:eP},onRowSelectionChange:ek})})})]})})]})]})})}},4919:function(e,t,s){"use strict";s.d(t,{g:function(){return n}});var i=s(57437),a=s(2265),l=s(49354);let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,i.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a})});n.displayName="Textarea"}},function(e){e.O(0,[8753,4392,7138,4868,9776,921,1172,1792,4602,1049,8530,2592,2741,1202,1580,158,2971,7023,1744],function(){return e(e.s=28682)}),_N_E=e.O()}]);