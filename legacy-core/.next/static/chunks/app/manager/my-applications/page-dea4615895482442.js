(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4745],{66724:function(e,s,a){Promise.resolve().then(a.bind(a,58714))},58714:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return w}});var t=a(57437);a(27224);var l=a(2265),n=a(16463),i=a(58052),c=a(48185),r=a(89733),d=a(86864),o=a(83014),h=a(15862),m=a(77515),u=a(22468),p=a(92513),x=a(17750),j=a(84379),N=a(82157),f=a(78068),v=a(2183),g=a(87138),y=a(89736),P=a(55813);let S=()=>(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(v.O,{className:"h-8 w-48"}),(0,t.jsx)(v.O,{className:"h-8 w-24"})]}),(0,t.jsx)("div",{className:"space-y-2",children:[,,,,,].fill(0).map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between border-b pb-2",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(v.O,{className:"h-4 w-64"}),(0,t.jsx)(v.O,{className:"h-3 w-32"})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(v.O,{className:"h-6 w-24"}),(0,t.jsx)(v.O,{className:"h-6 w-6 rounded-full"})]})]},s))})]});function w(){let[e,s]=(0,l.useState)([]),[a,v]=(0,l.useState)(!0),[w,_]=(0,l.useState)("all"),b=(0,n.useRouter)(),{toast:A}=(0,f.pm)(),D=(0,N.e)(),[U,C]=(0,l.useState)(""),[E,F]=(0,l.useState)([]),[k,Z]=(0,l.useState)(""),[z,O]=(0,l.useState)(!1),[I,L]=(0,l.useState)(!1),[Y,H]=(0,l.useState)("paste"),[M,$]=(0,l.useState)(null),[q,R]=(0,l.useState)(0),[B,T]=(0,l.useState)({}),[V,G]=(0,l.useState)([]),[Q,W]=(0,l.useState)(!1),[J,K]=(0,l.useState)(0),[X,ee]=(0,l.useState)(0),[es,ea]=(0,l.useState)(!1),[et,el]=(0,l.useState)([]),[en,ei]=(0,l.useState)(!1),[ec,er]=(0,l.useState)(null),[ed,eo]=(0,l.useState)({}),[eh,em]=(0,l.useState)({}),[eu,ep]=(0,l.useState)(!1),[ex,ej]=(0,l.useState)(!1),[eN,ef]=(0,l.useState)({}),[ev,eg]=(0,l.useState)(""),[ey,eP]=(0,l.useState)(!1),eS=(0,l.useRef)(!1),ew=()=>{let s=e.length,a=e.filter(e=>"Approved"===e.status).length;return{totalPolicies:s,approvedPolicies:a,needsAttentionPolicies:e.filter(e=>"Needs Attention"===e.policy_health).length,paidPolicies:e.filter(e=>("Approved"===e.status||"Live"===e.status||"1st Month Paid"===e.status)&&"Paid"===e.paid_status).length,totalAnnualPremium:e.reduce((e,s)=>e+12*("number"==typeof s.monthly_premium?s.monthly_premium:parseFloat(s.monthly_premium||"0")),0)}};async function e_(){v(!0);try{let{data:{user:e}}=await D.auth.getUser();if(!e)throw Error("User not authenticated");let a=e.id,{data:t,error:l}=await D.from("agent_applications").select(`
          *,
          client_state,
          created_by,
          manager_id,
          agent_id,
          product
        `).or(`created_by.eq.${a},manager_id.eq.${a}`);if(l)throw l;console.log(`Loaded ${t?.length||0} manager applications`);let n=t?.map(e=>{let s="Healthy";"Approved"===e.status||"Live"===e.status||"1st Month Paid"===e.status?s="Healthy":"Pending"===e.status||"In Progress"===e.status||"Submitted"===e.status?s="In Process":"Needs Attention"===e.status||"Incomplete"===e.status||"Not Taken"===e.status||"Lapsed"===e.status?s="Needs Attention":("Cancelled"===e.status||"Declined"===e.status)&&(s="Cancelled"),"Pending First Payment"===e.paid_status&&(s="Pending First Payment");let a=e.ap||null;if(!a&&e.monthly_premium){let s=0;e.monthly_premium&&(s="number"==typeof e.monthly_premium?e.monthly_premium:parseFloat(e.monthly_premium),a=12*s)}let t=e.commission_amount||0,l=e.created_at?new Date(e.created_at).toISOString():null;return{...e,policy_health:s,ap:a,commission_amount:t,created_at:l}})||[];s(n),console.log("All loaded applications:",n)}catch(e){console.error("Error fetching applications:",e),A({title:"Error",description:"Failed to load applications",variant:"destructive"})}finally{v(!1)}}function eb(s){return(console.log(`Filtering applications for tab: ${s}`),console.log("Available applications:",e.length),"all"===s)?e:"healthy"===s?e.filter(e=>"Healthy"===e.policy_health):"pendingFirstPayment"===s?e.filter(e=>"Pending First Payment"===e.paid_status):"needsAttention"===s?e.filter(e=>"Needs Attention"===e.policy_health):"cancelled"===s?e.filter(e=>"Cancelled"===e.policy_health||"Cancelled"===e.status||"Declined"===e.status):"paid"===s?e.filter(e=>"Paid"===e.paid_status):"unpaid"===s?e.filter(e=>"Unpaid"===e.paid_status):"inProcess"===s?e.filter(e=>"In Process"===e.policy_health):e}return(0,l.useEffect)(()=>{!async function(){v(!0);try{let{data:{session:e},error:s}=await D.auth.getSession();if(s)throw console.error("Error getting session:",s),Error("Authentication error: "+s.message);if(!e){console.log("No active session found, redirecting to login"),A({title:"Authentication Required",description:"Please log in to view applications",variant:"destructive"}),b.push("/login?redirect=/manager/my-applications");return}let{data:a,error:t}=await D.from("user_roles").select("role").eq("user_id",e.user.id).single();if(t&&"PGRST116"!==t.code&&console.error("Error fetching user role:",t),a&&!["manager","admin"].includes(a.role)){console.log("User does not have manager or admin role, redirecting"),A({title:"Access Denied",description:"You need manager permissions to access this page",variant:"destructive"}),b.push("/agent/dashboard");return}document.cookie="test_role=manager; path=/; max-age=86400",eS.current=!0,e_()}catch(e){console.error("Authentication error:",e),A({title:"Authentication Error",description:"Please try logging in again",variant:"destructive"}),b.push("/login?redirect=/manager/my-applications")}}()},[]),(0,t.jsx)(y.pn,{children:(0,t.jsx)("div",{className:"container mx-auto p-6",children:(0,t.jsxs)("div",{className:"flex flex-col space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Manager Applications"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Applications created by you or assigned to your management"})]}),a?(0,t.jsx)(S,{}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(()=>{let e=ew();return(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[(0,t.jsx)(c.Zb,{className:"stat-card total card-hover-effect",children:(0,t.jsx)(c.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"stat-info",children:[(0,t.jsx)("p",{className:"stat-label",children:"Total Policies"}),(0,t.jsx)("h3",{className:"stat-value",children:e.totalPolicies})]}),(0,t.jsx)("div",{className:"stat-icon",children:(0,t.jsx)(o.Z,{className:"h-6 w-6"})})]})})}),(0,t.jsx)(c.Zb,{className:"stat-card approved card-hover-effect",children:(0,t.jsx)(c.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"stat-info",children:[(0,t.jsx)("p",{className:"stat-label",children:"Approved"}),(0,t.jsx)("h3",{className:"stat-value",children:e.approvedPolicies})]}),(0,t.jsx)("div",{className:"stat-icon",children:(0,t.jsx)(h.Z,{className:"h-6 w-6"})})]})})}),(0,t.jsx)(c.Zb,{className:"stat-card attention card-hover-effect",children:(0,t.jsx)(c.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"stat-info",children:[(0,t.jsx)("p",{className:"stat-label",children:"Needs Attention"}),(0,t.jsx)("h3",{className:"stat-value",children:e.needsAttentionPolicies})]}),(0,t.jsx)("div",{className:"stat-icon",children:(0,t.jsx)(m.Z,{className:"h-6 w-6"})})]})})}),(0,t.jsx)(c.Zb,{className:"stat-card paid card-hover-effect",children:(0,t.jsx)(c.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"stat-info",children:[(0,t.jsx)("p",{className:"stat-label",children:"Paid/Issued"}),(0,t.jsx)("h3",{className:"stat-value",children:e.paidPolicies})]}),(0,t.jsx)("div",{className:"stat-icon",children:(0,t.jsx)(u.Z,{className:"h-6 w-6"})})]})})}),(0,t.jsx)(c.Zb,{className:"stat-card premium card-hover-effect",children:(0,t.jsx)(c.aY,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"stat-info",children:[(0,t.jsx)("p",{className:"stat-label",children:"Annual Premium"}),(0,t.jsxs)("h3",{className:"stat-value",children:["$",e.totalAnnualPremium.toLocaleString()]})]}),(0,t.jsx)("div",{className:"stat-icon",children:(0,t.jsxs)("svg",{fill:"none",className:"h-6 w-6",height:"24",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:[(0,t.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,t.jsx)("path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"}),(0,t.jsx)("path",{d:"M12 18V6"})]})})]})})})]})})},{}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("div",{className:"flex space-x-2 items-center",children:(0,t.jsx)(j.tE,{})}),(0,t.jsx)("div",{className:"flex space-x-2",children:(0,t.jsx)(g.default,{href:"/manager/script-assistant",children:(0,t.jsxs)(r.z,{children:[(0,t.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"New Application"]})})})]}),(0,t.jsxs)(d.mQ,{defaultValue:"all",className:"w-full",onValueChange:function(e){_(e)},children:[(0,t.jsxs)(d.dr,{className:"grid grid-cols-4 md:grid-cols-8 mb-4",children:[(0,t.jsx)(d.SP,{value:"all",children:"All"}),(0,t.jsxs)(d.SP,{value:"healthy",children:[(0,t.jsx)("span",{className:"hidden md:inline",children:"Healthy"}),(0,t.jsx)("span",{className:"md:hidden",children:"✅"})]}),(0,t.jsxs)(d.SP,{value:"pendingFirstPayment",children:[(0,t.jsx)("span",{className:"hidden md:inline",children:"Pending Payment"}),(0,t.jsx)("span",{className:"md:hidden",children:"\uD83D\uDCB0"})]}),(0,t.jsxs)(d.SP,{value:"needsAttention",children:[(0,t.jsx)("span",{className:"hidden md:inline",children:"Needs Attention"}),(0,t.jsx)("span",{className:"md:hidden",children:"⚠️"})]}),(0,t.jsxs)(d.SP,{value:"cancelled",children:[(0,t.jsx)("span",{className:"hidden md:inline",children:"Cancelled"}),(0,t.jsx)("span",{className:"md:hidden",children:"❌"})]}),(0,t.jsxs)(d.SP,{value:"paid",children:[(0,t.jsx)("span",{className:"hidden md:inline",children:"Paid"}),(0,t.jsx)("span",{className:"md:hidden",children:"\uD83D\uDCB5"})]}),(0,t.jsxs)(d.SP,{value:"unpaid",children:[(0,t.jsx)("span",{className:"hidden md:inline",children:"Unpaid"}),(0,t.jsx)("span",{className:"md:hidden",children:"\uD83D\uDCDD"})]}),(0,t.jsxs)(d.SP,{value:"inProcess",children:[(0,t.jsx)("span",{className:"hidden md:inline",children:"In Process"}),(0,t.jsx)("span",{className:"md:hidden",children:"⏳"})]})]}),(0,t.jsx)(d.nU,{value:"all",className:"space-y-4",children:(0,t.jsx)(P.S,{children:(0,t.jsx)(i.w,{columns:x.z,data:eb("all")})})}),(0,t.jsx)(d.nU,{value:"healthy",className:"space-y-4",children:(0,t.jsx)(P.S,{children:(0,t.jsx)(i.w,{columns:x.z,data:eb("healthy")})})}),(0,t.jsx)(d.nU,{value:"pendingFirstPayment",className:"space-y-4",children:(0,t.jsx)(P.S,{children:(0,t.jsx)(i.w,{columns:x.z,data:eb("pendingFirstPayment")})})}),(0,t.jsx)(d.nU,{value:"needsAttention",className:"space-y-4",children:(0,t.jsx)(P.S,{children:(0,t.jsx)(i.w,{columns:x.z,data:eb("needsAttention")})})}),(0,t.jsx)(d.nU,{value:"cancelled",className:"space-y-4",children:(0,t.jsx)(P.S,{children:(0,t.jsx)(i.w,{columns:x.z,data:eb("cancelled")})})}),(0,t.jsx)(d.nU,{value:"paid",className:"space-y-4",children:(0,t.jsx)(P.S,{children:(0,t.jsx)(i.w,{columns:x.z,data:eb("paid")})})}),(0,t.jsx)(d.nU,{value:"unpaid",className:"space-y-4",children:(0,t.jsx)(P.S,{children:(0,t.jsx)(i.w,{columns:x.z,data:eb("unpaid")})})}),(0,t.jsx)(d.nU,{value:"inProcess",className:"space-y-4",children:(0,t.jsx)(P.S,{children:(0,t.jsx)(i.w,{columns:x.z,data:eb("inProcess")})})})]})]})]})})})}}},function(e){e.O(0,[8753,4392,7138,4868,9776,921,1172,1792,4602,1049,8530,2592,2741,1202,1580,158,2971,7023,1744],function(){return e(e.s=66724)}),_N_E=e.O()}]);