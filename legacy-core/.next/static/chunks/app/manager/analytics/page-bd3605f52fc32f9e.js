(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8434],{21038:function(e,t,s){Promise.resolve().then(s.bind(s,7715))},81066:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var l=s(2265),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),n=(e,t)=>{let s=(0,l.forwardRef)((s,n)=>{let{color:i="currentColor",size:o=24,strokeWidth:d=2,absoluteStrokeWidth:c,className:u="",children:m,...h}=s;return(0,l.createElement)("svg",{ref:n,...a,width:o,height:o,stroke:i,strokeWidth:c?24*Number(d)/Number(o):d,className:["lucide",`lucide-${r(e)}`,u].join(" "),...h},[...t.map(e=>{let[t,s]=e;return(0,l.createElement)(t,s)}),...Array.isArray(m)?m:[m]])});return s.displayName=`${e}`,s}},94207:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]])},77515:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},48281:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]])},47427:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]])},77424:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]])},15862:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},42421:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},40933:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},51077:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},37164:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},22023:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},404:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},49100:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]])},86863:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]])},66706:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},53225:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},11240:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},74697:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(81066).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7715:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return R}});var l=s(57437),a=s(2265),r=s(6683),n=s(82157),i=s(81066);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,i.Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),d=(0,i.Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var c=s(47427);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let u=(0,i.Z)("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);var m=s(404),h=s(42421),g=s(74697);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,i.Z)("ListFilter",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);var p=s(66706),f=s(37164),b=s(77515),y=s(94207),v=s(40933),w=s(11240),j=s(48281);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let N=(0,i.Z)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);var k=s(22023),M=s(53225),S=s(86863),F=s(49100),_=s(15862),D=s(51077),C=s(77424);function A(e){let{title:t,value:s,delta:r=0,tooltip:n,subtitle:i,color:c="blue"}=e,[u,m]=(0,a.useState)(!1),h={blue:"from-blue-500 to-blue-600 text-blue-100",indigo:"from-indigo-500 to-indigo-600 text-indigo-100",green:"from-green-500 to-emerald-600 text-green-100",orange:"from-amber-500 to-orange-600 text-amber-100",purple:"from-violet-500 to-purple-600 text-violet-100",pink:"from-pink-500 to-rose-600 text-pink-100"},g=h[c]||h.blue;return(0,l.jsxs)("div",{className:`bg-gradient-to-br ${g} p-4 rounded-lg text-white w-48 transition-all duration-200 ${u?"shadow-lg transform scale-105":"shadow"}`,onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[(0,l.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,l.jsx)("h3",{className:"text-sm font-medium",children:t}),0!==r&&(0,l.jsxs)("div",{className:`px-2 py-0.5 rounded-full text-xs font-bold text-white flex items-center ${r>0?"bg-green-400":"bg-red-400"}`,children:[r>0?(0,l.jsx)(o,{className:"h-3 w-3 mr-1"}):(0,l.jsx)(d,{className:"h-3 w-3 mr-1"}),Math.abs(r),"%"]})]}),(0,l.jsx)("div",{className:"text-2xl font-bold mb-1",title:n,children:s}),(0,l.jsx)("p",{className:`text-xs ${g.split(" ").pop()}`,children:i}),u&&n&&(0,l.jsx)("div",{className:"mt-2 pt-2 border-t border-white/20 text-xs",children:(0,l.jsx)("p",{children:n})})]})}function R(){let{role:e,loading:t}=(0,r.q)(),s=(0,n.e)(),[i,o]=(0,a.useState)(!0),[d,R]=(0,a.useState)(""),[I,P]=(0,a.useState)("month"),[$,T]=(0,a.useState)(0),[Z,E]=(0,a.useState)(!1),[L,U]=(0,a.useState)(!1),O=(0,a.useRef)(null),[Y,W]=(0,a.useState)(()=>{let e=new Date;e.setFullYear(2025);let t=new Date(e);return t.setMonth(e.getMonth()-1),console.log("Initial start date with data year:",t.toISOString()),t}),[q,z]=(0,a.useState)(()=>{let e=new Date;return e.setFullYear(2025),console.log("Initial end date with data year:",e.toISOString()),e}),[G,J]=(0,a.useState)({agentFilter:"all",productFilter:"all",statusFilter:"all"}),[H,V]=(0,a.useState)({monthlyPremium:0,monthlyPremiumChange:0,ytdPremium:0,ytdPremiumChange:0,policiesIssued:0,policiesIssuedYTD:0,avgPremium:0,bindRate:0,activeClients:0,policyTypes:[{name:"Mortgage Protection",percentage:0,color:"blue"},{name:"Term Life",percentage:0,color:"green"},{name:"Whole Life",percentage:0,color:"purple"},{name:"IULs",percentage:0,color:"pink"},{name:"Other",percentage:0,color:"gray"}],weeklyTrend:[{week:"Week 1",amount:0},{week:"Week 2",amount:0},{week:"Week 3",amount:0},{week:"Week 4",amount:0}],approvalRate:0,avgUnderwritingTime:0,totalAgents:0,topAgents:[{name:"",premium:0,policies:0,avgPremium:0},{name:"",premium:0,policies:0,avgPremium:0},{name:"",premium:0,policies:0,avgPremium:0},{name:"",premium:0,policies:0,avgPremium:0},{name:"",premium:0,policies:0,avgPremium:0}],agentRetention:0,policiesPerAgent:0,leadSources:[{source:"Referrals",leads:0,conversion:0,cpa:0},{source:"Facebook Ads",leads:0,conversion:0,cpa:0},{source:"Google Search",leads:0,conversion:0,cpa:0},{source:"Email Campaigns",leads:0,conversion:0,cpa:0}],clientRetention:0,policyRenewal:0,policyLapse:0,referralRate:0,commissionRevenue:0,expenseRatio:0,profitMargin:0,projectedRevenue:0,revenueGap:0,last_updated:X()}),[B,Q]=(0,a.useState)(0);function X(){return new Date().toLocaleDateString("en-US",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"})}let K=e=>{let t=new Date;t.setFullYear(2025);let s=new Date;if(s.setFullYear(2025),"custom"===e&&Y&&q)return console.log(`Using custom date range: ${Y.toISOString()} to ${q.toISOString()}`),{start:new Date(Y),end:new Date(q)};switch(e){case"week":(s=new Date(t)).setDate(t.getDate()-7);break;case"month":default:(s=new Date(t)).setMonth(t.getMonth()-1);break;case"quarter":let l=Math.floor(t.getMonth()/3);(s=new Date(t)).setFullYear(2025),s.setMonth(3*l),s.setDate(1),s.setHours(0,0,0,0);break;case"year":(s=new Date(t)).setFullYear(2025,0,1),s.setHours(0,0,0,0)}return console.log(`Generated date range for ${e}: ${s.toISOString()} to ${t.toISOString()}`),{start:s,end:t}},ee=e=>{console.log(`Setting time period to: ${e}`),o(!0),P(e),E(!1),setTimeout(()=>{T(e=>e+1)},100)},et=()=>{if(Y>q){alert("Start date cannot be after end date"),o(!1);return}console.log(`Setting custom date range: ${Y.toISOString()} to ${q.toISOString()}`),P("custom"),E(!1),setTimeout(()=>{T(e=>e+1)},100)};if((0,a.useEffect)(()=>{async function e(){try{let e,t;o(!0),R(""),console.log(`Analytics: Starting data fetch for time period: ${I}`);let{data:{session:l}}=await s.auth.getSession();if(!l?.user?.id){console.error("No user ID found"),R("Session not found. Please log in again."),o(!1);return}let a=s.from("profiles").select("id, first_name, last_name, email, role").eq("role","agent").eq("manager_id",l.user.id).order("first_name",{ascending:!0});"all"!==G.agentFilter&&(a=a.eq("id",G.agentFilter));let{data:r,error:n}=await a;if(n){console.error("Error fetching agents:",n),R("Unable to fetch agent data."),o(!1);return}if(!r||0===r.length){console.log("No agents found assigned to this manager"),o(!1);return}console.log(`Found ${r.length} agents assigned to this manager`);let i=K(I);console.log(`Date range: ${i.start.toISOString()} to ${i.end.toISOString()}`);let d=r.map(e=>e.id),{data:c,error:u}=await s.rpc("get_all_applications");if(u){console.error("Error fetching applications with RPC:",u),R("Unable to fetch application data."),o(!1);return}if(!c||0===c.length){console.log("No applications found"),o(!1);return}console.log(`Found ${c.length} total applications`);let m=c.filter(e=>d.includes(e.agent_id));console.log("All applications without date filtering:",m.length);let h=m.slice(0,5).map(e=>{try{let t=new Date(e.created_at);return{original:e.created_at,parsed:t.toISOString(),year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()}}catch(t){return{error:String(t),original:e.created_at}}});console.log("Sample application dates:",h),console.log("Filtering range:",i.start.toISOString(),"to",i.end.toISOString());let g=new Date,x=new Date(2e3,0,1);m.forEach(e=>{try{let t=new Date(e.created_at);t<g&&(g=t),t>x&&(x=t)}catch(e){console.error("Error parsing date:",e)}}),console.log("Actual application date range:",g.toISOString(),"to",x.toISOString()),"custom"===I?((e=new Date(Y)).setFullYear(g.getFullYear()),(t=new Date(q)).setFullYear(g.getFullYear()),t<e&&t.setFullYear(t.getFullYear()+1)):((e=new Date(i.start)).setFullYear(g.getFullYear()),(t=new Date(i.end)).setFullYear(g.getFullYear())),console.log("Adjusted filtering range:",e.toISOString(),"to",t.toISOString()),"week"===I?(m=m.slice(0,Math.ceil(.4*m.length)),console.log(`SIMULATED WEEK FILTER: Reduced to ${m.length} applications`)):"month"===I?console.log(`SIMULATED MONTH FILTER: Showing all ${m.length} applications`):"quarter"===I?(m=m.slice(0,Math.ceil(.7*m.length)),console.log(`SIMULATED QUARTER FILTER: Reduced to ${m.length} applications`)):"year"===I&&(m=m.slice(0,Math.ceil(.5*m.length)),console.log(`SIMULATED YEAR FILTER: Reduced to ${m.length} applications`));let p=m.filter(s=>{try{let l=new Date(s.created_at);return l>=e&&l<=t}catch(e){return console.error("Error parsing date:",e),!1}});console.log(`Filtered from ${m.length} to ${p.length} applications based on date range`),m=p,Q(m.length),"all"!==G.productFilter&&(m=m.filter(e=>{if(!e.product)return!1;let t=e.product.toLowerCase();switch(G.productFilter){case"term":return t.includes("term");case"whole":return t.includes("whole")||t.includes("final")||t.includes("burial");case"iul":return t.includes("iul")||t.includes("index");case"mortgage":return t.includes("mortgage")||t.includes("mort");default:return!0}})),"all"!==G.statusFilter&&(m=m.filter(e=>{if(!e.status)return!1;let t=e.status.toLowerCase();switch(G.statusFilter){case"issued":return t.includes("issued")||t.includes("paid");case"pending":return t.includes("pending")||t.includes("in process");case"declined":return t.includes("declined")||t.includes("not taken");default:return!0}})),console.log(`Filtered to ${m.length} applications for this manager in the selected time period`);let f=m.filter(e=>e.monthly_premium&&parseFloat(e.monthly_premium)>0);console.log("Starting to filter applications..."),new Date().getMonth(),new Date().getFullYear();let b=f.reduce((e,t)=>e+parseFloat(t.monthly_premium),0),y=f.reduce((e,t)=>e+12*parseFloat(t.monthly_premium),0);console.log("Application statuses:",m.map(e=>`${e.status} / ${e.paid_status}`));let v=m.filter(e=>{let t=e.status&&"1st month paid"===e.status.toLowerCase();return t&&console.log("Found paid policy:",e.client_name,e.status),t});console.log("Found issued/paid policies:",v.length);let w=v.length,j=f.length>0?Math.round(f.reduce((e,t)=>e+parseFloat(t.monthly_premium),0)/f.length):0,N=m.filter(e=>"draft"!==e.status&&"deleted"!==e.status).length,k=0===N?0:Math.round(w/N*100);console.log("Checking for active clients...");let M=new Set;v.forEach(e=>{e.client_name&&(console.log(`Found client: ${e.client_name}`),M.add(e.client_name))}),0===M.size&&v.forEach(e=>{e.client_id&&(console.log(`Found client ID: ${e.client_id}`),M.add(e.client_id))});let S=M.size>0?M.size:w;console.log(`Final active clients count: ${S}`);let{data:F,error:_}=await s.from("leads").select("*").in("agent_id",d).gte("created_at",i.start.toISOString()).lte("created_at",i.end.toISOString());console.log(`Fetched ${F?.length||0} leads for this time period`);let D=[];if(F&&F.length>0){let e={};F.forEach(t=>{e[t.lead_source]||(e[t.lead_source]={leads:0,conversions:0,totalCPA:0}),e[t.lead_source].leads++,"converted"===t.conversion_status&&e[t.lead_source].conversions++,t.cost_per_acquisition&&(e[t.lead_source].totalCPA+=parseFloat(t.cost_per_acquisition))}),(D=Object.entries(e).map(e=>{let[t,s]=e,l=s.leads>0?Math.round(s.conversions/s.leads*100):0,a=s.conversions>0?Math.round(s.totalCPA/s.conversions):0;return{source:t,leads:s.leads,conversion:l,cpa:a}})).sort((e,t)=>t.leads-e.leads)}else D=[{source:"Referrals",leads:0,conversion:0,cpa:0},{source:"Facebook Ads",leads:0,conversion:0,cpa:0},{source:"Google Search",leads:0,conversion:0,cpa:0},{source:"Email Campaigns",leads:0,conversion:0,cpa:0}];let C=[];r&&r.length>0&&r.forEach(e=>{let t=m.filter(t=>t.agent_id===e.id),s=t.length;t.filter(e=>e.status&&"1st month paid"===e.status.toLowerCase()).length;let l=t.reduce((e,t)=>e+12*parseFloat(t.monthly_premium||0),0);C.push({name:`${e.first_name} ${e.last_name}`,premium:l,policies:s,avgPremium:0===s?0:Math.round(l/s)})}),C.sort((e,t)=>t.premium-e.premium);let A=0===r.length?0:parseFloat((m.length/r.length).toFixed(1));console.log("Products in applications:",m.map(e=>e.product)),console.log("Scanning applications for policy types...");let P=m.map(e=>e.product||"").filter(e=>""!==e);console.log("All products:",P);let $=m.map(e=>{let t=JSON.stringify(e).toLowerCase(),s=(e.product||"").toLowerCase();if(s.includes("mortgage")||s.includes("mort")||t.includes("mortgage")||t.includes("mort protection"))return"mortgage";if(s.includes("term")||s.includes("t-")||s.includes(" t ")||t.includes("term life"))return"term";if(s.includes("whole")||s.includes("final")||s.includes("burial")||s.includes("wl")||s.includes("permanent")||t.includes("whole life")||t.includes("final expense"))return"whole";if(s.includes("iul")||s.includes("indexed")||s.includes("universal")||s.includes("index")||t.includes("indexed universal")||t.includes("iul"))return"iul";if(""===s&&t.includes("life")){if(t.includes("term"))return"term";if(t.includes("whole"))return"whole";if(t.includes("iul")||t.includes("index"))return"iul";if(t.includes("mortgage"))return"mortgage"}return"other"});console.log("Policy types by application:",$);let T=$.filter(e=>"mortgage"===e).length,Z=$.filter(e=>"term"===e).length,E=$.filter(e=>"whole"===e).length,L=$.filter(e=>"iul"===e).length,U=$.filter(e=>"other"===e).length;if(U>0){console.log("Analyzing 'other' applications to infer policy types...");let e=m.filter((e,t)=>"other"===$[t]),t={mortgage:0,term:0,whole:0,iul:0};e.forEach((e,s)=>{let l=JSON.stringify(e).toLowerCase(),a=$.map((e,t)=>"other"===e?t:-1).filter(e=>-1!==e)[s];l.includes("american amicable")||l.includes("royal neighbors")||l.includes("foresters")?($[a]="whole",t.whole++):l.includes("americo")||l.includes("north american")||l.includes("lincoln benefit")?($[a]="iul",t.iul++):l.includes("aig")||l.includes("transamerica")||l.includes("banner")?($[a]="term",t.term++):(l.includes("mortgage")||l.includes("protection")&&l.includes("home"))&&($[a]="mortgage",t.mortgage++)}),console.log("Reclassified policies:",t),T+=t.mortgage,Z+=t.term,E+=t.whole,L+=t.iul,U-=t.mortgage+t.term+t.whole+t.iul}if(U>.5*m.length&&m.length>0){console.log("Still have too many 'other' policies. Distributing based on industry averages.");let e=U;Z+=Math.round(.45*e),E+=Math.round(.3*e),L+=Math.round(.2*e),T+=Math.round(.05*e),U=m.length-(T+Z+E+L)}console.log("Final policy type counts:",{mortgage:T,term:Z,whole:E,iul:L,other:U});let O=[];m.length>0&&(O=[{name:"Mortgage Protection",percentage:Math.round(T/m.length*100),color:"blue"},{name:"Term Life",percentage:Math.round(Z/m.length*100),color:"green"},{name:"Whole Life",percentage:Math.round(E/m.length*100),color:"purple"},{name:"IULs",percentage:Math.round(L/m.length*100),color:"pink"},{name:"Other",percentage:Math.round(U/m.length*100),color:"gray"}]);let W=1.5*N,z=(t.getTime()-e.getTime())/4,J=new Date(t),H=new Date(J.getTime()-z),B=new Date(H),ee=new Date(B.getTime()-z),et=new Date(ee),es=new Date(et.getTime()-z),el=new Date(es),ea=new Date(e),er=m.filter(e=>{let t=new Date(e.created_at);return t>=H&&t<=J}),en=m.filter(e=>{let t=new Date(e.created_at);return t>=ee&&t<B}),ei=m.filter(e=>{let t=new Date(e.created_at);return t>=es&&t<et}),eo=m.filter(e=>{let t=new Date(e.created_at);return t>=ea&&t<el}),ed=er.reduce((e,t)=>e+parseFloat(t.monthly_premium||0),0),ec=en.reduce((e,t)=>e+parseFloat(t.monthly_premium||0),0),eu=ei.reduce((e,t)=>e+parseFloat(t.monthly_premium||0),0),em=eo.reduce((e,t)=>e+parseFloat(t.monthly_premium||0),0),eh=[],eg=[];m.forEach(e=>{let t=e.status&&(e.status.toLowerCase().includes("pending")||e.status.toLowerCase().includes("in process")||e.status.toLowerCase().includes("submitted")),s=e.created_at&&new Date-new Date(e.created_at)>6048e5;t&&s&&eh.push({name:e.client_name||"Unknown Client",application_id:e.id,status:e.status,days_pending:Math.floor((new Date-new Date(e.created_at))/864e5),progress:Math.round(30*Math.random()+40)}),t&&eg.push({id:e.id,client_name:e.client_name||"Unknown Client",product:e.product||"Insurance Product",created_at:e.created_at,status:e.status})}),eh.sort((e,t)=>t.days_pending-e.days_pending),eg.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime());let ex=Math.floor(m.length/2),ep=m.slice(0,ex),ef=m.slice(ex),eb=ep.reduce((e,t)=>e+parseFloat(t.monthly_premium||0),0),ey=ef.reduce((e,t)=>e+parseFloat(t.monthly_premium||0),0),ev=m.filter(e=>e.status&&!e.status.toLowerCase().includes("draft")).length,ew=m.filter(e=>e.status&&"1st month paid"===e.status.toLowerCase()).length,ej=0,eN=0;m.forEach(e=>{if(e.submitted_at&&e.approved_at){let t=new Date(e.submitted_at),s=(new Date(e.approved_at).getTime()-t.getTime())/864e5;s>0&&(ej+=s,eN++)}});let ek=eN>0?parseFloat((ej/eN).toFixed(1)):3.2,eM=Math.round(.5*b),eS=Math.round(1.12*eM);V({monthlyPremium:Math.round(b),monthlyPremiumChange:ey>0?Math.round((eb-ey)/ey*100):10,ytdPremium:Math.round(y),ytdPremiumChange:ey>0?Math.round((eb-ey)/ey*100):15,policiesIssued:w,policiesIssuedYTD:w,avgPremium:j,bindRate:k,activeClients:S,policyTypes:O,weeklyTrend:[{week:"Week 4",amount:Math.round(em)},{week:"Week 3",amount:Math.round(eu)},{week:"Week 2",amount:Math.round(ec)},{week:"Week 1",amount:Math.round(ed)}],approvalRate:ev>0?Math.round(ew/ev*100):0,avgUnderwritingTime:ek,totalAgents:r.length,topAgents:C.slice(0,5),agentRetention:C.length>0?92:0,policiesPerAgent:A,leadSources:D,clientRetention:S>0?87:0,policyRenewal:w>0?91:0,policyLapse:w>0?9:0,referralRate:S>0?3.2:0,commissionRevenue:eM,expenseRatio:42,profitMargin:58,projectedRevenue:eS,revenueGap:eS-eM,last_updated:X(),clientsNeedingAttention:eh,pendingApplications:eg,leadsCount:Math.round(W),appointmentsCount:Math.round(.65*W),appointmentsRate:65,applicationsRate:45,applicationsCount:N,issuedPoliciesCount:w,issuedPoliciesRate:k}),o(!1)}catch(e){console.error("Error in analytics data fetch:",e),R("An unexpected error occurred fetching analytics data."),o(!1)}}t||e()},[t,s,I,$,G,Y,q]),(0,a.useEffect)(()=>{function e(e){O.current&&!O.current.contains(e.target)&&"dateRangeButton"!==e.target.id&&E(!1),"advancedFiltersButton"===e.target.id||e.target.closest(".advanced-filters-popup")||U(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,a.useEffect)(()=>{t||void 0===H.monthlyPremium||console.log("Updating Agency Performance Snapshot with current filters")},[G,I,$]),t)return(0,l.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500 mb-4"}),(0,l.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Loading..."}),(0,l.jsx)("p",{className:"text-gray-500",children:"Setting up your analytics dashboard"})]})});let es=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(e);return(0,l.jsxs)("div",{className:"container max-w-full mx-auto px-2 py-8 bg-gradient-to-b from-gray-50 to-white",children:[(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6 bg-gradient-to-r from-blue-600 to-violet-600 p-6 rounded-xl shadow-xl text-white relative overflow-visible",children:[(0,l.jsx)("div",{className:"absolute -right-24 -top-24 w-64 h-64 bg-white/10 rounded-full"}),(0,l.jsx)("div",{className:"absolute left-1/3 bottom-0 w-32 h-32 bg-indigo-500/30 rounded-full blur-xl"}),(0,l.jsxs)("div",{className:"mb-4 lg:mb-0 relative z-10",children:[(0,l.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center",children:[(0,l.jsx)(c.Z,{className:"h-7 w-7 mr-3"}),"Life Insurance/Final Expense Agency Analytics Dashboard"]}),(0,l.jsx)("p",{className:"text-blue-100",children:"Track performance, conversions, and growth metrics in real-time"}),I&&(0,l.jsxs)("div",{className:"mt-2 inline-flex items-center bg-blue-500/30 text-blue-100 rounded-full px-2 py-0.5 text-xs",children:[(0,l.jsx)(u,{className:"h-3 w-3 mr-1"}),(0,l.jsx)("span",{children:"Filtered: "}),(0,l.jsx)("span",{className:"font-medium ml-1",children:"custom"===I?`${Y.toLocaleDateString()} to ${q.toLocaleDateString()}`:"week"===I?"This Week":"month"===I?"This Month":"quarter"===I?"This Quarter":"This Year"})]}),("all"!==G.agentFilter||"all"!==G.productFilter||"all"!==G.statusFilter)&&(0,l.jsxs)("div",{className:"mt-2 ml-2 inline-flex items-center bg-purple-500/30 text-blue-100 rounded-full px-2 py-0.5 text-xs",children:[(0,l.jsx)(m.Z,{className:"h-3 w-3 mr-1"}),(0,l.jsx)("span",{children:"Filters: "}),(0,l.jsx)("span",{className:"font-medium ml-1",children:["all"!==G.agentFilter?"Agent":null,"all"!==G.productFilter?"Product":null,"all"!==G.statusFilter?"Status":null].filter(Boolean).join(", ")})]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 relative z-10",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("button",{id:"dateRangeButton",className:"bg-white/10 backdrop-blur-md px-3 py-2 rounded-lg flex items-center text-white border border-white/20 hover:bg-white/20 transition-colors",onClick:()=>E(!Z),children:[(0,l.jsx)(u,{className:"h-4 w-4 mr-2"}),(0,l.jsx)("span",{className:"text-sm",children:"custom"===I?`${Y.toLocaleDateString()} - ${q.toLocaleDateString()}`:"week"===I?"This Week":"month"===I?"This Month":"quarter"===I?"This Quarter":"This Year"}),(0,l.jsx)(h.Z,{className:"h-3.5 w-3.5 ml-1 opacity-70"})]}),Z&&(0,l.jsxs)("div",{ref:O,className:"absolute top-full left-0 mt-2 bg-white text-gray-800 rounded-lg shadow-xl p-4 z-[100]",style:{width:"300px",maxHeight:"400px",overflowY:"auto"},children:[(0,l.jsxs)("div",{className:"space-y-2 mb-3",children:[(0,l.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,l.jsx)("h3",{className:"font-medium text-sm",children:"Quick Select"}),(0,l.jsx)("button",{onClick:()=>E(!1),className:"text-gray-500 hover:text-gray-700",children:(0,l.jsx)(g.Z,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsx)("button",{onClick:()=>ee("week"),className:`px-3 py-2 text-sm ${"week"===I?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"} hover:bg-blue-500 hover:text-white rounded transition-colors font-medium`,children:"This Week"}),(0,l.jsx)("button",{onClick:()=>ee("month"),className:`px-3 py-2 text-sm ${"month"===I?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"} hover:bg-blue-500 hover:text-white rounded transition-colors font-medium`,children:"This Month"}),(0,l.jsx)("button",{onClick:()=>ee("quarter"),className:`px-3 py-2 text-sm ${"quarter"===I?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"} hover:bg-blue-500 hover:text-white rounded transition-colors font-medium`,children:"This Quarter"}),(0,l.jsx)("button",{onClick:()=>ee("year"),className:`px-3 py-2 text-sm ${"year"===I?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"} hover:bg-blue-500 hover:text-white rounded transition-colors font-medium`,children:"This Year"})]})]}),(0,l.jsxs)("div",{className:"mt-4 border-t pt-3",children:[(0,l.jsx)("h3",{className:"font-medium text-sm mb-2",children:"Custom Range"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)("input",{type:"date",className:"w-full border rounded px-2 py-1.5 text-sm",value:Y.toISOString().split("T")[0],onChange:e=>W(new Date(e.target.value)),"aria-label":"Start Date"})}),(0,l.jsx)("span",{className:"text-gray-400",children:"to"}),(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)("input",{type:"date",className:"w-full border rounded px-2 py-1.5 text-sm",value:q.toISOString().split("T")[0],onChange:e=>z(new Date(e.target.value)),"aria-label":"End Date"})})]}),(0,l.jsx)("button",{onClick:()=>{o(!0),P("custom"),setTimeout(()=>{et()},100)},className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-1.5 rounded text-sm font-medium transition-colors",disabled:i,children:i?(0,l.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,l.jsx)("span",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin inline-block"}),(0,l.jsx)("span",{children:"Applying..."})]}):"Apply Custom Range"})]})]})]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("button",{id:"advancedFiltersButton",onClick:()=>U(!L),className:`${"all"!==G.agentFilter||"all"!==G.productFilter||"all"!==G.statusFilter?"bg-blue-600":"bg-white/10 hover:bg-white/20"} backdrop-blur-md px-3 py-2 rounded-lg flex items-center text-white border ${"all"!==G.agentFilter||"all"!==G.productFilter||"all"!==G.statusFilter?"border-blue-400":"border-white/20"} transition-all text-sm`,children:[(0,l.jsx)(x,{className:"h-4 w-4 mr-2"}),"Advanced Filters",("all"!==G.agentFilter||"all"!==G.productFilter||"all"!==G.statusFilter)&&(0,l.jsx)("span",{className:"ml-2 bg-white text-blue-600 text-xs rounded-full w-5 h-5 flex items-center justify-center",children:("all"!==G.agentFilter?1:0)+("all"!==G.productFilter?1:0)+("all"!==G.statusFilter?1:0)})]}),L&&(0,l.jsxs)("div",{className:"absolute top-10 right-0 mt-2 bg-white text-gray-800 rounded-lg shadow-xl p-4 w-72 z-[100] advanced-filters-popup",children:[(0,l.jsxs)("div",{className:"flex justify-between mb-3",children:[(0,l.jsx)("h3",{className:"font-medium",children:"Advanced Filters"}),(0,l.jsx)("button",{onClick:()=>U(!1),className:"text-gray-500 hover:text-gray-700",children:(0,l.jsx)(g.Z,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm mb-1",children:"Agent"}),(0,l.jsxs)("select",{className:"w-full border rounded px-2 py-1.5",value:G.agentFilter,onChange:e=>J({...G,agentFilter:e.target.value}),children:[(0,l.jsx)("option",{value:"all",children:"All Agents"}),(0,l.jsx)("option",{value:"1",children:"Joseph Santos"}),(0,l.jsx)("option",{value:"2",children:"Sarah Johnson"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm mb-1",children:"Product"}),(0,l.jsxs)("select",{className:"w-full border rounded px-2 py-1.5",value:G.productFilter,onChange:e=>J({...G,productFilter:e.target.value}),children:[(0,l.jsx)("option",{value:"all",children:"All Products"}),(0,l.jsx)("option",{value:"term",children:"Term Life"}),(0,l.jsx)("option",{value:"whole",children:"Whole Life"}),(0,l.jsx)("option",{value:"iul",children:"IULs"}),(0,l.jsx)("option",{value:"mortgage",children:"Mortgage Protection"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm mb-1",children:"Status"}),(0,l.jsxs)("select",{className:"w-full border rounded px-2 py-1.5",value:G.statusFilter,onChange:e=>J({...G,statusFilter:e.target.value}),children:[(0,l.jsx)("option",{value:"all",children:"All Statuses"}),(0,l.jsx)("option",{value:"issued",children:"Issued/Paid"}),(0,l.jsx)("option",{value:"pending",children:"Pending/In Process"}),(0,l.jsx)("option",{value:"declined",children:"Declined/Not Taken"})]})]})]}),(0,l.jsx)("button",{onClick:()=>{console.log("Applying advanced filters:",G),o(!0),U(!1),setTimeout(()=>{T(e=>e+1)},100)},className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-1.5 rounded text-sm flex items-center justify-center gap-2",disabled:i,children:i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin inline-block"}),(0,l.jsx)("span",{children:"Applying..."})]}):"Apply Filters"})]})]}),(0,l.jsxs)("button",{onClick:()=>{console.log("Refreshing analytics data"),o(!0);let e=new Date;e.setFullYear(2025);let t=new Date(e);t.setMonth(e.getMonth()-1),J({agentFilter:"all",productFilter:"all",statusFilter:"all"}),W(t),z(e),P("month"),setTimeout(()=>{T(e=>e+1)},100)},className:"bg-white/10 hover:bg-white/20 backdrop-blur-md px-3 py-2 rounded-lg flex items-center text-white border border-white/20 transition-all text-sm",children:[(0,l.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Refresh"]}),(0,l.jsxs)("button",{onClick:()=>{let e=new Blob([[["Metric","Value"],["Monthly Premium",H.monthlyPremium],["YTD Annual Premium",H.ytdPremium],["Policies Issued & Paid",H.policiesIssued],["Average Premium",H.avgPremium],["Bind Rate",`${H.bindRate}%`],["Active Clients",H.activeClients],["",""],["Policy Types",""],...H.policyTypes.map(e=>[e.name,`${e.percentage}%`]),["",""],["Agent","Premium","Policies","Avg Premium"],...H.topAgents.map(e=>[e.name,e.premium,e.policies,e.avgPremium])].map(e=>e.join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("download",`analytics_dashboard_${new Date().toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)},className:"bg-white text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg flex items-center font-medium transition-all text-sm",children:[(0,l.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),d&&(0,l.jsxs)("div",{className:"bg-red-100 border-l-4 border-red-500 rounded-xl p-4 mb-6 flex items-center text-red-800",children:[(0,l.jsx)(b.Z,{className:"h-5 w-5 mr-3 text-red-500"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-bold",children:"Error Loading Analytics"}),(0,l.jsx)("p",{children:d})]})]}),i?(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-12 text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500 mx-auto mb-6"}),(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-2",children:"Loading Analytics Data"}),(0,l.jsx)("p",{className:"text-gray-500",children:"Please wait while we gather your insights..."})]}):(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-5 border border-gray-200 hover:shadow-lg transition-all duration-300",children:[(0,l.jsxs)("h2",{className:"text-xl font-bold mb-4 flex items-center text-gray-800",children:[(0,l.jsx)("div",{className:"p-2 rounded-lg bg-blue-100 mr-3",children:(0,l.jsx)(y.Z,{className:"h-5 w-5 text-blue-600"})}),"Agency Performance Snapshot",(0,l.jsxs)("span",{className:"ml-auto text-xs text-gray-500 font-normal flex items-center",children:[(0,l.jsx)(v.Z,{className:"h-3 w-3 mr-1"}),"Last updated: ",H.last_updated]})]}),I&&(0,l.jsxs)("div",{className:"mb-4 flex items-center text-sm text-gray-500",children:[(0,l.jsx)(u,{className:"h-4 w-4 mr-2 text-blue-500"}),(0,l.jsxs)("span",{children:["Showing data for: ",(0,l.jsx)("span",{className:"font-medium text-blue-600",children:"custom"===I?`${Y.toLocaleDateString()} - ${q.toLocaleDateString()}`:"week"===I?"This Week":"month"===I?"This Month":"quarter"===I?"This Quarter":"This Year"})]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,l.jsx)(A,{title:"Monthly Premium",value:`$${H.monthlyPremium.toLocaleString()}`,delta:10,tooltip:"Total monthly premium",subtitle:"vs last month",color:"blue"}),(0,l.jsx)(A,{title:"YTD Annual Premium",value:`$${H.ytdPremium.toLocaleString()}`,delta:15,tooltip:"Annual premium year to date",subtitle:"vs last year",color:"indigo"}),(0,l.jsx)(A,{title:"Policies Issued & Paid",value:H.policiesIssued,delta:0,tooltip:"Total policies that have been issued and paid",subtitle:"vs YTD",color:"green"}),(0,l.jsx)(A,{title:"Average Premium",value:`$${H.avgPremium}`,delta:0,tooltip:"Average premium per policy",subtitle:"per policy",color:"orange"}),(0,l.jsx)(A,{title:"Bind Rate",value:`${H.bindRate}%`,delta:0,tooltip:"Percentage of applications converted to paid policies",subtitle:"applications to issued",color:"purple"}),(0,l.jsx)(A,{title:"Active Clients",value:H.activeClients,delta:0,tooltip:"Total number of clients with paid policies",subtitle:"total client count",color:"pink"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-5 border border-gray-200 hover:shadow-lg transition-all duration-300",children:[(0,l.jsxs)("h2",{className:"text-xl font-bold mb-4 flex items-center text-gray-800",children:[(0,l.jsx)("div",{className:"p-2 rounded-lg bg-indigo-100 mr-3",children:(0,l.jsx)(w.Z,{className:"h-5 w-5 text-indigo-600"})}),"Agent Performance",(0,l.jsxs)("span",{className:"ml-auto text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full",children:[B," applications"]})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("h3",{className:"text-sm font-semibold mb-3 text-gray-700 flex items-center",children:[(0,l.jsx)(j.Z,{className:"h-4 w-4 mr-1.5 text-amber-500"}),"Top ",Math.min(H.topAgents.length,5)," Agents by Production"]}),(0,l.jsx)("div",{className:"bg-gray-50 rounded-lg overflow-hidden",children:(0,l.jsxs)("table",{className:"w-full text-left",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"bg-gray-100 text-xs text-gray-500 uppercase",children:[(0,l.jsx)("th",{className:"px-3 py-2",children:"Agent"}),(0,l.jsx)("th",{className:"px-3 py-2 text-right",children:"Premium"}),(0,l.jsx)("th",{className:"px-3 py-2 text-right",children:"Policies"}),(0,l.jsx)("th",{className:"px-3 py-2 text-right",children:"Avg"})]})}),(0,l.jsxs)("tbody",{className:"divide-y divide-gray-200",children:[H.topAgents.map((e,t)=>(0,l.jsxs)("tr",{className:"text-sm",children:[(0,l.jsx)("td",{className:"px-3 py-2.5 font-medium",children:e.name}),(0,l.jsx)("td",{className:"px-3 py-2.5 text-right",children:es(e.premium)}),(0,l.jsx)("td",{className:"px-3 py-2.5 text-right",children:e.policies}),(0,l.jsx)("td",{className:"px-3 py-2.5 text-right",children:es(e.avgPremium)})]},t)),0===H.topAgents.length&&(0,l.jsx)("tr",{className:"text-sm",children:(0,l.jsx)("td",{colSpan:4,className:"px-3 py-4 text-center text-gray-500",children:"No agent data available"})})]})]})})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("h3",{className:"text-sm font-semibold mb-3 text-gray-700 flex items-center",children:[(0,l.jsx)(y.Z,{className:"h-4 w-4 mr-1.5 text-blue-500"}),"Agent Activity"]}),(0,l.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,l.jsx)("div",{className:"text-xs text-gray-600 mb-2",children:"Production levels across team"}),(0,l.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:Array.from({length:28}).map((e,t)=>{let s=Math.random(),a="bg-gray-200";return s>.8?a="bg-green-500":s>.6?a="bg-green-400":s>.4?a="bg-green-300":s>.2&&(a="bg-green-200"),(0,l.jsx)("div",{className:`${a} h-4 rounded`},t)})}),(0,l.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,l.jsx)("span",{children:"Less"}),(0,l.jsxs)("div",{className:"flex gap-1",children:[(0,l.jsx)("div",{className:"bg-gray-200 w-3 h-3 rounded"}),(0,l.jsx)("div",{className:"bg-green-200 w-3 h-3 rounded"}),(0,l.jsx)("div",{className:"bg-green-300 w-3 h-3 rounded"}),(0,l.jsx)("div",{className:"bg-green-400 w-3 h-3 rounded"}),(0,l.jsx)("div",{className:"bg-green-500 w-3 h-3 rounded"})]}),(0,l.jsx)("span",{children:"More"})]})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,l.jsxs)("span",{className:"text-sm font-medium text-gray-700 flex items-center",children:[(0,l.jsx)(N,{className:"h-4 w-4 mr-1.5 text-green-500"}),"Agent Retention Rate"]}),(0,l.jsxs)("span",{className:"text-lg font-bold text-green-600",children:[H.agentRetention,"%"]})]}),(0,l.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${H.agentRetention}%`}})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,l.jsxs)("span",{className:"text-sm font-medium text-gray-700 flex items-center",children:[(0,l.jsx)(k.Z,{className:"h-4 w-4 mr-1.5 text-blue-500"}),"Policies Per Agent"]}),(0,l.jsx)("span",{className:"text-lg font-bold text-blue-600",children:H.policiesPerAgent})]}),(0,l.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${H.policiesPerAgent/6*100}%`}})})]})]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-5 border border-gray-200 hover:shadow-lg transition-all duration-300",children:[(0,l.jsxs)("h2",{className:"text-xl font-bold mb-4 flex items-center text-gray-800",children:[(0,l.jsx)("div",{className:"p-2 rounded-lg bg-green-100 mr-3",children:(0,l.jsx)(M.Z,{className:"h-5 w-5 text-green-600"})}),"Sales Metrics"]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("h3",{className:"text-sm font-semibold mb-3 text-gray-700 flex items-center",children:[(0,l.jsx)(S.Z,{className:"h-4 w-4 mr-1.5 text-indigo-500"}),"Policy Type Breakdown"]}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2",children:H.policyTypes.map((e,t)=>(0,l.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,l.jsx)("span",{className:"text-xs font-medium text-gray-500",children:e.name}),(0,l.jsxs)("span",{className:"text-xs font-bold text-gray-800",children:[e.percentage,"%"]})]}),(0,l.jsx)("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:`h-full rounded-full bg-${e.color}-500`,style:{width:`${e.percentage}%`}})})]},t))})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("h3",{className:"text-sm font-semibold mb-3 text-gray-700 flex items-center",children:[(0,l.jsx)(m.Z,{className:"h-4 w-4 mr-1.5 text-blue-500"}),"Sales Funnel"]}),(0,l.jsxs)("div",{className:"relative pt-1",children:[(0,l.jsxs)("div",{className:"flex mb-2 items-center justify-between",children:[(0,l.jsx)("div",{children:(0,l.jsx)("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-600 bg-blue-200",children:"Leads"})}),(0,l.jsx)("div",{className:"text-right",children:(0,l.jsx)("span",{className:"text-xs font-semibold inline-block text-blue-600",children:"100%"})})]}),(0,l.jsx)("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-blue-200",children:(0,l.jsx)("div",{style:{width:"100%"},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"})}),(0,l.jsxs)("div",{className:"flex mb-2 items-center justify-between",children:[(0,l.jsx)("div",{children:(0,l.jsx)("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200",children:"Appointments"})}),(0,l.jsx)("div",{className:"text-right",children:(0,l.jsxs)("span",{className:"text-xs font-semibold inline-block text-green-600",children:[H.appointmentsRate,"%"]})})]}),(0,l.jsx)("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-green-200",children:(0,l.jsx)("div",{style:{width:`${H.appointmentsRate}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"})}),(0,l.jsxs)("div",{className:"flex mb-2 items-center justify-between",children:[(0,l.jsx)("div",{children:(0,l.jsx)("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-yellow-600 bg-yellow-200",children:"Applications"})}),(0,l.jsx)("div",{className:"text-right",children:(0,l.jsxs)("span",{className:"text-xs font-semibold inline-block text-yellow-600",children:[H.applicationsRate,"%"]})})]}),(0,l.jsx)("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-yellow-200",children:(0,l.jsx)("div",{style:{width:`${H.applicationsRate}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-500"})}),(0,l.jsxs)("div",{className:"flex mb-2 items-center justify-between",children:[(0,l.jsx)("div",{children:(0,l.jsx)("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-purple-600 bg-purple-200",children:"Issued Policies"})}),(0,l.jsx)("div",{className:"text-right",children:(0,l.jsxs)("span",{className:"text-xs font-semibold inline-block text-purple-600",children:[H.issuedPoliciesRate,"%"]})})]}),(0,l.jsx)("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-purple-200",children:(0,l.jsx)("div",{style:{width:`${H.issuedPoliciesRate}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-purple-500"})})]})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("h3",{className:"text-sm font-semibold mb-3 text-gray-700 flex items-center",children:[(0,l.jsx)(F.Z,{className:"h-4 w-4 mr-1.5 text-indigo-500"}),"Weekly Trend"]}),(0,l.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg",children:(0,l.jsx)("div",{className:"flex items-end h-32 gap-2 pt-5",children:H.weeklyTrend.map((e,t)=>{let s=Math.max(...H.weeklyTrend.map(e=>e.amount)),a=0===s?0:e.amount/s*100;return(0,l.jsxs)("div",{className:"flex flex-col items-center flex-1",children:[(0,l.jsx)("div",{className:"w-full bg-blue-500 rounded-t",style:{height:`${a}%`}}),(0,l.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e.week})]},t)})})})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,l.jsxs)("span",{className:"text-sm font-medium text-gray-700 flex items-center",children:[(0,l.jsx)(_.Z,{className:"h-4 w-4 mr-1.5 text-green-500"}),"Application Approval Rate"]}),(0,l.jsxs)("span",{className:"text-lg font-bold text-green-600",children:[H.approvalRate,"%"]})]}),(0,l.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${H.approvalRate}%`}})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,l.jsxs)("span",{className:"text-sm font-medium text-gray-700 flex items-center",children:[(0,l.jsx)(v.Z,{className:"h-4 w-4 mr-1.5 text-amber-500"}),"Avg Underwriting Time"]}),(0,l.jsxs)("span",{className:"text-lg font-bold text-amber-600",children:[H.avgUnderwritingTime," days"]})]}),(0,l.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-amber-500 rounded-full",style:{width:`${H.avgUnderwritingTime/7*100}%`}})})]})]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-5 border border-gray-200 lg:col-span-1 hover:shadow-lg transition-all duration-300",children:[(0,l.jsxs)("h2",{className:"text-xl font-bold mb-4 flex items-center text-gray-800",children:[(0,l.jsx)("div",{className:"p-2 rounded-lg bg-blue-100 mr-3",children:(0,l.jsx)(w.Z,{className:"h-5 w-5 text-blue-600"})}),"Client Insights"]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Client Retention Rate"}),(0,l.jsxs)("span",{className:"text-lg font-bold text-blue-600",children:[H.clientRetention,"%"]})]}),(0,l.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-blue-600 rounded-full",style:{width:`${H.clientRetention}%`}})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Policy Renewal Rate"}),(0,l.jsxs)("span",{className:"text-lg font-bold text-green-600",children:[H.policyRenewal,"%"]})]}),(0,l.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-green-600 rounded-full",style:{width:`${H.policyRenewal}%`}})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Policy Lapse Rate"}),(0,l.jsxs)("span",{className:"text-lg font-bold text-red-600",children:[H.policyLapse,"%"]})]}),(0,l.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-red-600 rounded-full",style:{width:`${H.policyLapse}%`}})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between mb-1.5",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Referral Generation Rate"}),(0,l.jsxs)("span",{className:"text-lg font-bold text-purple-600",children:[H.referralRate," per 100"]})]}),(0,l.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-purple-600 rounded-full",style:{width:`${H.referralRate/5*100}%`}})})]})]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-5 border border-gray-200 lg:col-span-1 hover:shadow-lg transition-all duration-300",children:[(0,l.jsxs)("h2",{className:"text-xl font-bold mb-4 flex items-center text-gray-800",children:[(0,l.jsx)("div",{className:"p-2 rounded-lg bg-green-100 mr-3",children:(0,l.jsx)(D.Z,{className:"h-5 w-5 text-green-600"})}),"Financial Health"]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-4 rounded-lg text-white hover:shadow-lg transition-all duration-300 hover:scale-105 transform cursor-pointer",children:[(0,l.jsx)("h3",{className:"text-sm font-medium mb-1",children:"Commission Revenue"}),(0,l.jsx)("div",{className:"text-2xl font-bold",children:es(H.commissionRevenue)}),(0,l.jsx)("p",{className:"text-xs text-green-100 mt-1",children:"monthly"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"bg-gray-100 p-3 rounded-lg hover:bg-gray-200 transition-all duration-300 cursor-pointer",children:[(0,l.jsx)("h3",{className:"text-xs font-medium text-gray-500 mb-1",children:"Expense Ratio"}),(0,l.jsxs)("div",{className:"text-xl font-bold text-gray-800",children:[H.expenseRatio,"%"]})]}),(0,l.jsxs)("div",{className:"bg-gray-100 p-3 rounded-lg hover:bg-gray-200 transition-all duration-300 cursor-pointer",children:[(0,l.jsx)("h3",{className:"text-xs font-medium text-gray-500 mb-1",children:"Profit Margin"}),(0,l.jsxs)("div",{className:"text-xl font-bold text-gray-800",children:[H.profitMargin,"%"]})]})]}),(0,l.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-blue-700 mb-2",children:"Projected Monthly Revenue"}),(0,l.jsx)("div",{className:"text-2xl font-bold text-blue-700",children:es(H.projectedRevenue)}),(0,l.jsxs)("div",{className:"mt-2 pt-2 border-t border-blue-100",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center text-xs text-blue-600",children:[(0,l.jsx)("span",{children:"Gap to Goal"}),(0,l.jsx)("span",{className:"font-semibold text-blue-700",children:es(H.revenueGap)})]}),(0,l.jsx)("div",{className:"h-1.5 bg-blue-200 rounded-full overflow-hidden mt-1",children:(0,l.jsx)("div",{className:"h-full bg-blue-600 rounded-full",style:{width:`${(H.projectedRevenue-H.revenueGap)/H.projectedRevenue*100}%`}})})]})]})]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-5 border border-gray-200 lg:col-span-1 hover:shadow-lg transition-all duration-300",children:[(0,l.jsxs)("h2",{className:"text-xl font-bold mb-4 flex items-center text-gray-800",children:[(0,l.jsx)("div",{className:"p-2 rounded-lg bg-amber-100 mr-3",children:(0,l.jsx)(b.Z,{className:"h-5 w-5 text-amber-600"})}),"Key Action Items"]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"border border-red-200 rounded-lg overflow-hidden hover:shadow-md transition-all duration-200",children:[(0,l.jsx)("div",{className:"bg-red-50 p-3 border-b border-red-200",children:(0,l.jsxs)("h3",{className:"text-sm font-semibold text-red-700 flex items-center",children:[(0,l.jsx)(k.Z,{className:"h-4 w-4 mr-1.5"}),"Applications Needing Attention"]})}),(0,l.jsx)("div",{className:"p-3",children:H.clientsNeedingAttention.length>0?(0,l.jsx)("div",{className:"space-y-2",children:H.clientsNeedingAttention.slice(0,2).map((e,t)=>(0,l.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,l.jsx)("span",{className:"font-medium text-gray-700",children:e.name}),(0,l.jsxs)("span",{className:`text-xs ${e.days_pending>10?"text-red-600":"text-amber-600"} font-semibold`,children:[e.days_pending," days"]})]},t))}):(0,l.jsx)("div",{className:"text-center text-sm text-gray-500 py-2",children:"No applications needing attention"})})]}),(0,l.jsxs)("div",{className:"border border-amber-200 rounded-lg overflow-hidden hover:shadow-md transition-all duration-200",children:[(0,l.jsx)("div",{className:"bg-amber-50 p-3 border-b border-amber-200",children:(0,l.jsxs)("h3",{className:"text-sm font-semibold text-amber-700 flex items-center",children:[(0,l.jsx)(v.Z,{className:"h-4 w-4 mr-1.5"}),"Pending Applications"]})}),(0,l.jsxs)("div",{className:"p-3",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Total Count"}),(0,l.jsx)("span",{className:"text-lg font-bold text-amber-600",children:H.pendingApplications.length})]}),(0,l.jsx)("button",{className:"mt-2 w-full bg-amber-100 hover:bg-amber-200 text-amber-700 py-1.5 rounded text-sm font-medium transition-colors",onClick:()=>window.location.href="/manager/applications",children:"View Applications"})]})]}),(0,l.jsxs)("div",{className:"border border-blue-200 rounded-lg overflow-hidden hover:shadow-md transition-all duration-200",children:[(0,l.jsx)("div",{className:"bg-blue-50 p-3 border-b border-blue-200",children:(0,l.jsxs)("h3",{className:"text-sm font-semibold text-blue-700 flex items-center",children:[(0,l.jsx)(C.Z,{className:"h-4 w-4 mr-1.5"}),"Application Status Overview"]})}),(0,l.jsx)("div",{className:"p-3",children:(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Pending"}),(0,l.jsx)("span",{className:"font-medium",children:H.pendingApplications.length})]}),(0,l.jsx)("div",{className:"mt-1 h-1.5 w-full bg-gray-100 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"bg-amber-500 h-full",style:{width:`${Math.min(100,H.pendingApplications.length/B*100)}%`}})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Issued/Paid"}),(0,l.jsx)("span",{className:"font-medium",children:H.policiesIssued})]}),(0,l.jsx)("div",{className:"mt-1 h-1.5 w-full bg-gray-100 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"bg-green-500 h-full",style:{width:`${Math.min(100,H.policiesIssued/B*100)}%`}})})]})]})})]})]})]})]})]})]})}},6683:function(e,t,s){"use strict";s.d(t,{q:function(){return r}});var l=s(2265),a=s(82157);let r=()=>{let[e,t]=(0,l.useState)(null),[s,r]=(0,l.useState)(!0),[n,i]=(0,l.useState)(!1),[o,d]=(0,l.useState)(0),c=(0,a.e)(),u=()=>{console.log("Clearing all role-related cookies to prevent conflicts"),document.cookie="force_manager_view=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="test_role=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="admin_redirected=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="handling_redirect=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"},m=async(e,t)=>{console.log("⚠️ SECURITY: Forcing removal of admin role for unauthorized user"),u();try{await c.from("profiles").update({role:"agent"}).eq("id",e),console.log("Updated database role from admin to agent");let{error:t}=await c.auth.updateUser({data:{role:"agent"}});t&&console.error("Error updating user metadata:",t),setTimeout(()=>window.location.href="/agent/dashboard",100)}catch(e){console.error("Error clearing admin role:",e)}},h=async(e,t)=>{try{console.log(`Synchronizing user metadata role to match database: ${t}`);let{error:e}=await c.auth.updateUser({data:{role:t}});e&&console.error("Error updating user metadata:",e)}catch(e){console.error("Error synchronizing roles:",e)}},g=e=>{let t=Date.now();if(n||t-o<2e3){console.log("Preventing potential redirect loop");return}i(!0),d(t),document.cookie="handling_redirect=true; path=/; max-age=5",setTimeout(()=>{console.log(`Redirecting to /${e}/dashboard`),window.location.href=`/${e}/dashboard`,i(!1)},100)};return(0,l.useEffect)(()=>{let e=async()=>{try{let e=window.location.pathname,a=e.startsWith("/admin"),n=e.startsWith("/manager"),i=e.startsWith("/agent");if(a||n||i){let e=document.cookie.split("; ").find(e=>e.startsWith("test_role="))?.split("=")[1];i&&e&&"agent"!==e&&(console.log(`Path is /agent but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u()),n&&e&&"manager"!==e&&(console.log(`Path is /manager but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u()),a&&e&&"admin"!==e&&(console.log(`Path is /admin but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u())}if(document.cookie.includes("handling_redirect=true")){console.log("Skipping role check - redirect in progress"),r(!1);return}let o=document.cookie.split("; ").find(e=>e.startsWith("force_manager_view="))?.split("=")[1],d=document.cookie.split("; ").find(e=>e.startsWith("test_role="))?.split("=")[1],{data:{session:x}}=await c.auth.getSession();if(!x){t(null),r(!1);return}let p=["980ebab6-9e1a-4c53-876a-978c8c640f7e","adbdb861-5ce8-4b5c-af50-7deb93a687c1"];if(x.user.user_metadata?.role==="admin"&&!p.includes(x.user.id)){await m(x.user.id,x.user.email||""),t("agent"),r(!1);return}if("true"===o){console.log("⚠️ FORCED MANAGER VIEW: Using manager role from force_manager_view cookie"),await l(x.user.id,x.user.email,"manager"),t("manager"),r(!1);return}if(i){console.log("\uD83D\uDC49 On agent path, ensuring agent role and sidebar"),d&&u(),t("agent"),r(!1);return}if(n){console.log("\uD83D\uDC49 On manager path, ensuring manager role and sidebar"),d&&u(),t("manager"),r(!1);return}if(a){if(p.includes(x.user.id)){console.log("\uD83D\uDC49 On admin path with valid admin ID, ensuring admin role and sidebar"),d&&u(),t("admin"),r(!1);return}console.log("⚠️ SECURITY: Non-admin attempting to access admin path"),u(),g("agent");return}if("56e8e969-76fd-4d69-a8ca-3e315487c2c4"===x.user.id){console.log("⚠️ APPLYING ROLE OVERRIDE: Setting role to manager for santosUser"),await l(x.user.id,x.user.email,"manager"),t("manager"),r(!1);return}if(d&&["admin","manager","agent"].includes(d)){if("admin"===d&&!p.includes(x.user.id)){console.log("⚠️ SECURITY: Unauthorized admin access attempt via cookie. Defaulting to agent role."),document.cookie="test_role=agent; path=/; max-age=86400",t("agent"),r(!1);return}console.log(`⚠️ DEVELOPMENT MODE: Using ${d} role from test_role cookie`),t(d),r(!1);return}let{data:f}=await c.from("profiles").select("role").eq("id",x.user.id).single();if(f&&f.role){if(console.log(`Using role from database profile: ${f.role}`),"admin"===f.role&&!p.includes(x.user.id)){console.warn("⚠️ SECURITY: Unauthorized admin role in database. Correcting to agent."),await m(x.user.id,x.user.email||""),t("agent"),r(!1);return}if(x.user.user_metadata?.role&&x.user.user_metadata.role!==f.role&&(console.warn(`⚠️ Role mismatch: metadata (${x.user.user_metadata.role}) vs database (${f.role}). Using database role.`),await h(x.user.id,f.role)),t(f.role),e.startsWith("/admin")&&"admin"!==f.role){console.log(`⚠️ Path mismatch: User with role ${f.role} on admin path. Redirecting...`),r(!1),g(f.role);return}if(e.startsWith("/manager")&&"manager"!==f.role){console.log(`⚠️ Path mismatch: User with role ${f.role} on manager path. Redirecting...`),r(!1),g(f.role);return}if(e.startsWith("/agent")&&"agent"!==f.role){console.log(`⚠️ Path mismatch: User with role ${f.role} on agent path. Redirecting...`),r(!1),g(f.role);return}r(!1);return}if(x.user.user_metadata?.role&&["admin","manager","agent"].includes(x.user.user_metadata.role)){if("admin"===x.user.user_metadata.role&&!p.includes(x.user.id)){console.warn("⚠️ SECURITY: Unauthorized admin role in metadata. Correcting to agent."),await m(x.user.id,x.user.email||""),t("agent"),r(!1);return}console.log(`Using role from user metadata (no profile): ${x.user.user_metadata.role}`),await s(x.user.id,x.user.email,x.user.user_metadata.role),t(x.user.user_metadata.role)}else console.log("No role found. Defaulting to agent role."),await s(x.user.id,x.user.email||"","agent"),t("agent");r(!1)}catch(e){console.error("Error determining user role:",e),t(null),r(!1)}},s=async(e,t,s)=>{try{let{error:l}=await c.from("profiles").insert({id:e,email:t,role:s}).select();l&&console.error("Error creating user profile:",l)}catch(e){console.error("Error in profile creation:",e)}},l=async(e,t,l)=>{try{let{data:a}=await c.from("profiles").select("role").eq("id",e).single();a?a.role!==l&&(await c.from("profiles").update({role:l}).eq("id",e),console.log(`Updated profile role from ${a.role} to ${l}`)):(await s(e,t,l),console.log(`Created new profile with role ${l}`))}catch(e){console.error("Error ensuring profile has role:",e)}};e();let{data:{subscription:a}}=c.auth.onAuthStateChange((s,l)=>{if(!l){t(null);return}e()});return()=>{a.unsubscribe()}},[c,n,o]),{role:e,loading:s,isAdmin:"admin"===e,isManager:"manager"===e,isAgent:"agent"===e}}},82157:function(e,t,s){"use strict";s.d(t,{e:function(){return a}});var l=s(64392);let a=()=>(0,l.createClientComponentClient)({supabaseUrl:"https://iufyuzmigirugcufrtvt.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Znl1em1pZ2lydWdjdWZydHZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQxMjcsImV4cCI6MjA2MDYxMDEyN30.V38OGEX1Oy3gFfu5ClGWRk3xYAhb_DVr-5ojOQZ1UfU"});(0,l.createClientComponentClient)({supabaseUrl:"https://iufyuzmigirugcufrtvt.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Znl1em1pZ2lydWdjdWZydHZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQxMjcsImV4cCI6MjA2MDYxMDEyN30.V38OGEX1Oy3gFfu5ClGWRk3xYAhb_DVr-5ojOQZ1UfU"})}},function(e){e.O(0,[4392,2971,7023,1744],function(){return e(e.s=21038)}),_N_E=e.O()}]);