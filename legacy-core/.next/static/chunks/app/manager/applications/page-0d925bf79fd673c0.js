(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5113],{30453:function(e,t,a){Promise.resolve().then(a.bind(a,16274))},81066:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var r=a(2265),n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),s=(e,t)=>{let a=(0,r.forwardRef)((a,s)=>{let{color:i="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:u="",children:m,...p}=a;return(0,r.createElement)("svg",{ref:s,...n,width:l,height:l,stroke:i,strokeWidth:d?24*Number(c)/Number(l):c,className:["lucide",`lucide-${o(e)}`,u].join(" "),...p},[...t.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(m)?m:[m]])});return a.displayName=`${e}`,a}},24241:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(81066).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},42421:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(81066).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},22023:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(81066).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},404:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(81066).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},54817:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(81066).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},52022:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(81066).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},20357:function(e,t,a){"use strict";var r,n;e.exports=(null==(r=a.g.process)?void 0:r.env)&&"object"==typeof(null==(n=a.g.process)?void 0:n.env)?a.g.process:a(88081)},88081:function(e){!function(){var t={229:function(e){var t,a,r,n=e.exports={};function o(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{a="function"==typeof clearTimeout?clearTimeout:s}catch(e){a=s}}();var l=[],c=!1,d=-1;function u(){c&&r&&(c=!1,r.length?l=r.concat(l):d=-1,l.length&&m())}function m(){if(!c){var e=i(u);c=!0;for(var t=l.length;t;){for(r=l,l=[];++d<t;)r&&r[d].run();d=-1,t=l.length}r=null,c=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===s||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];l.push(new p(e,t)),1!==l.length||c||i(m)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},a={};function r(e){var n=a[e];if(void 0!==n)return n.exports;var o=a[e]={exports:{}},s=!0;try{t[e](o,o.exports,r),s=!1}finally{s&&delete a[e]}return o.exports}r.ab="//";var n=r(229);e.exports=n}()},16274:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var r=a(57437),n=a(2265),o=a(6683),s=a(82157),i=a(22023),l=a(54817),c=a(24241),d=a(52022),u=a(42421),m=a(404),p=a(20357);function g(){let{role:e,loading:t}=(0,o.q)(),a=(0,s.e)(),[g,h]=(0,n.useState)([]),[f,x]=(0,n.useState)([]),[y,w]=(0,n.useState)(!0),[_,b]=(0,n.useState)([]),[v,N]=(0,n.useState)("all"),[j,C]=(0,n.useState)("all"),[k,E]=(0,n.useState)("all"),[S,D]=(0,n.useState)(""),[M,$]=(0,n.useState)(""),[A,I]=(0,n.useState)("");(0,n.useEffect)(()=>{async function e(){let{data:e}=await a.auth.getUser();if(!e?.user?.id)return;let{data:t,error:r}=await a.from("profiles").select("id, first_name, last_name, email").eq("role","agent").eq("manager_id",e.user.id);if(r){console.error("Error fetching agents:",r);return}if(b((t||[]).map(e=>({id:e.id,name:e.first_name?`${e.first_name} ${e.last_name||""}`:e.email?.split("@")[0]||"Unknown Agent"}))),!t||0===t.length){h([]),w(!1);return}let n=t.map(e=>e.id);console.log("Attempting to query applications table");let{data:o,error:s}=await a.from("applications").select("*, profiles!applications_agent_id_fkey(first_name, last_name, email)").order("created_at",{ascending:!1});s?console.error("Error fetching applications data:",s):console.log(`Found ${o?.length||0} records in applications table`,o),console.log("Attempting to query agent_applications table");let{data:i,error:l}=await a.from("agent_applications").select("*, profiles(first_name, last_name, email)");l?console.error("Error fetching agent_applications data:",l):console.log(`Found ${i?.length||0} records in agent_applications table`,i),console.log("Attempting to use RPC function get_all_applications");let{data:c,error:d}=await a.rpc("get_all_applications");d?console.error("Error using RPC function:",d):(console.log(`Found ${c?.length||0} records using SQL RPC`,c),c&&c.length>0&&(console.log("First record structure:",JSON.stringify(c[0],null,2)),console.log("Field names in first record:",Object.keys(c[0])),c[0].client_name&&console.log("Found client_name field in RPC results"),c[0].insured_name&&console.log("Found insured_name field in RPC results"),["proposed_insured_name","full_name","name","insured_first_name","client_first_name"].forEach(e=>{c[0][e]&&console.log(`Found ${e} field in RPC results`)})));let u=[];if(c&&c.length>0)console.log("Using data from SQL RPC function"),u=c;else if(o&&o.length>0)console.log("Using data from applications table"),u=o;else if(i&&i.length>0)console.log("Using data from agent_applications table"),u=i;else{console.log("Attempting direct query without filters as last resort");let{data:e,error:t}=await a.from("applications").select("*");if(!t&&e&&e.length>0)console.log(`Found ${e.length} records with direct query`),u=e;else if(console.error("Direct query failed or returned no data:",t),console.log("IMPORTANT: No real data found in Supabase. Check your database tables."),"true"===p.env.NEXT_PUBLIC_ENABLE_MOCK_DATA){console.log("Using fallback mock data (only because NEXT_PUBLIC_ENABLE_MOCK_DATA is true)");let e=new Date(2023,3,15);u=Array.from({length:23},(t,a)=>{let r=new Date(e);r.setDate(r.getDate()+(Math.floor(30*Math.random())-15));let o=new Date(r);o.setDate(o.getDate()-(Math.floor(3*Math.random())+1));let s=Math.floor(200*Math.random())+40,i=["John","Mary","Robert","Patricia","Michael","Jennifer","William","Linda","David","Elizabeth"],l=["Smith","Johnson","Williams","Brown","Jones","Garcia","Miller","Davis","Rodriguez","Martinez"],c=i[Math.floor(Math.random()*i.length)],d=l[Math.floor(Math.random()*l.length)],u=`${c} ${d}`;return{id:`fallback-${a}`,agent_id:n[Math.floor(Math.random()*n.length)],status:a<5?"1st Month Paid":a<10?"Approved":a<15?"Pending":a<18?"UW":a<20?"Cancelled":a<22?"Declined":"Not taken",monthly_premium:s,commission_amount:Math.round(9*s*60)/100,proposed_insured_name:u,carrier:["Americo","AIG","IULE","CBO","GWUL","Royal Neighbors"][a%6],product:["Eagle Select 1","Eagle Select","Eagle Select 3","CBO 100","SIWL","IULE"][a%6],created_at:r.toISOString(),policy_submit_date:o.toISOString(),policy_health:a<5?"Active":a<10?"Pending":a<12?"Needs Attention":"",paid_status:a<7?"Paid":""}})}}let m=u.filter(e=>!e.agent_id||n.includes(e.agent_id)||n.some(t=>e.agent_id?.toLowerCase()===t.toLowerCase()));console.log(`Found ${m.length} applications for this manager's agents`);let g=m.map(e=>{let a=t.find(t=>t.id===e.agent_id)||{},r=null,n=["proposed_insured","proposed_insured_name","client_name","insured_name","name","full_name","client_first_name","insured_first_name"];for(let t of(console.log("Processing app record:",e),n))if(e[t]){r=e[t],console.log(`Found name in field '${t}': ${r}`);break}if(!r&&e.client_data)try{let t="string"==typeof e.client_data?JSON.parse(e.client_data):e.client_data;for(let e of n)if(t[e]){r=t[e],console.log(`Found name in client_data.${e}: ${r}`);break}}catch(e){console.error("Error parsing client_data:",e)}return{...e,agent_name:a.first_name?`${a.first_name} ${a.last_name||""}`:a.email?.split("@")[0]||"Unknown Agent",agent_email:a.email||"No Email",proposed_insured_name:r||e.proposed_insured_name||"Not Available",proposed_insured:e.proposed_insured||r||"Not Available"}});g.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),h(g),x(g),w(!1),m.length>0&&m[0].proposed_insured&&console.log("First app has proposed_insured field:",m[0].proposed_insured)}t||e()},[t,a]),(0,n.useEffect)(()=>{let e=[...g];if("all"!==j&&(e=e.filter(e=>e.agent_id===j)),"all"!==v&&(e=e.filter(e=>{let t=(e.status||"").toLowerCase();return"approved"===v?"approved"===t||"1st month paid"===t:"pending"===v?"pending"===t||"uw"===t||"in review"===t:"declined"===v?"declined"===t||"cancelled"===t||"cancellation requested"===t:t===v})),"all"!==k&&(e=e.filter(e=>(e.carrier||"").toLowerCase()===k.toLowerCase())),M){let t=new Date(M);e=e.filter(e=>new Date(F(e))>=t)}if(A){let t=new Date(A);t.setHours(23,59,59,999),e=e.filter(e=>new Date(F(e))<=t)}if(S){let t=S.toLowerCase();e=e.filter(e=>(e.agent_name||"").toLowerCase().includes(t)||(e.carrier||"").toLowerCase().includes(t)||(e.product||"").toLowerCase().includes(t)||(e.status||"").toLowerCase().includes(t))}x(e)},[v,j,k,S,M,A,g]);let L=[...new Set(g.map(e=>e.carrier))].filter(Boolean).sort(),U=e=>{let t=new Date(e);return isNaN(t.getTime())?"Invalid date":(t.setFullYear(2023),`${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")}/${t.getFullYear()}`)},T=e=>{if(null==e)return"$0.00";let t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"$0.00":`$${t.toFixed(2)}`},Z=e=>{if(null==e)return 0;let t="string"==typeof e?parseFloat(e):e;return isNaN(t)?0:9*t},P=e=>e.commission_amount&&!isNaN(parseFloat(String(e.commission_amount)))?parseFloat(String(e.commission_amount)):e.monthly_premium&&!isNaN(parseFloat(String(e.monthly_premium)))?9*parseFloat(String(e.monthly_premium))*.6:0,F=e=>e.policy_submit_date||e.created_at;return t?(0,r.jsx)("div",{className:"flex h-screen items-center justify-center",children:"Loading..."}):(0,r.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,r.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,r.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[(0,r.jsx)(i.Z,{className:"h-8 w-8"}),"All Applications"]})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-start md:items-center mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Applications List"}),g.length>0&&(0,r.jsxs)("div",{className:"w-full md:w-auto grid grid-cols-1 md:grid-cols-6 gap-3",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(l.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,r.jsx)("input",{type:"text",placeholder:"Search applications...",className:"pl-10 pr-4 py-2 border rounded-md w-full",value:S,onChange:e=>D(e.target.value)})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(c.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,r.jsx)("input",{type:"date",placeholder:"Start Date",className:"pl-10 pr-4 py-2 border rounded-md w-full",value:M,onChange:e=>$(e.target.value)})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(c.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,r.jsx)("input",{type:"date",placeholder:"End Date",className:"pl-10 pr-4 py-2 border rounded-md w-full",value:A,onChange:e=>I(e.target.value)})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(d.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,r.jsxs)("select",{className:"pl-10 pr-4 py-2 border rounded-md w-full appearance-none",value:j,onChange:e=>C(e.target.value),children:[(0,r.jsx)("option",{value:"all",children:"All Agents"}),_.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,r.jsx)(u.Z,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(m.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,r.jsxs)("select",{className:"pl-10 pr-4 py-2 border rounded-md w-full appearance-none",value:v,onChange:e=>N(e.target.value),children:[(0,r.jsx)("option",{value:"all",children:"All Statuses"}),(0,r.jsx)("option",{value:"approved",children:"Approved"}),(0,r.jsx)("option",{value:"pending",children:"Pending"}),(0,r.jsx)("option",{value:"declined",children:"Declined/Cancelled"}),(0,r.jsx)("option",{value:"1st month paid",children:"1st Month Paid"})]}),(0,r.jsx)(u.Z,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(m.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,r.jsxs)("select",{className:"pl-10 pr-4 py-2 border rounded-md w-full appearance-none",value:k,onChange:e=>E(e.target.value),children:[(0,r.jsx)("option",{value:"all",children:"All Carriers"}),L.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsx)(u.Z,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"})]})]})]}),y?(0,r.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):g.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Submit Date"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Agent"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proposed Insured"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Carrier"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monthly Premium"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"9-Month AP"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Commission"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:U(F(e))}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold",children:(e.agent_name||"UA").substring(0,2)}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.agent_name})})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.proposed_insured||e.proposed_insured_name||"Not Available"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.carrier||"N/A"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.product||"N/A"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:T(e.monthly_premium)}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{children:[T(Z(e.monthly_premium)),(0,r.jsx)("span",{className:"ml-1 text-xs text-blue-600 font-medium",children:"(9mo)"})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:T(P(e))}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:`px-2 py-1 rounded-full text-xs ${"approved"===(e.status||"").toLowerCase()?"bg-green-100 text-green-800":"pending"===(e.status||"").toLowerCase()?"bg-yellow-100 text-yellow-800":"uw"===(e.status||"").toLowerCase()?"bg-yellow-100 text-yellow-800":"not taken"===(e.status||"").toLowerCase()?"bg-yellow-100 text-yellow-800":"rejected"===(e.status||"").toLowerCase()?"bg-red-100 text-red-800":"1st month paid"===(e.status||"").toLowerCase()?"bg-green-100 text-green-800":"declined"===(e.status||"").toLowerCase()?"bg-red-100 text-red-800":"cancelled"===(e.status||"").toLowerCase()?"bg-red-100 text-red-800":"cancellation requested"===(e.status||"").toLowerCase()?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:e.status||"Unknown"})})]},e.id))})]})}),(0,r.jsxs)("div",{className:"mt-4 text-sm text-gray-500",children:["Showing ",f.length," of ",g.length," applications","all"!==j&&` for ${_.find(e=>e.id===j)?.name}`,"all"!==v&&` with status "${v}"`,"all"!==k&&` from ${k}`,M&&` from ${new Date(M).toLocaleDateString()}`,A&&` to ${new Date(A).toLocaleDateString()}`,S&&` matching "${S}"`]})]}):_.length>0?(0,r.jsx)("p",{className:"text-gray-600",children:"No applications have been submitted by your agents yet."}):(0,r.jsx)("p",{className:"text-gray-600",children:"You don't have any agents assigned to you yet. Please ask an administrator to assign agents to your management."})]})]})}},6683:function(e,t,a){"use strict";a.d(t,{q:function(){return o}});var r=a(2265),n=a(82157);let o=()=>{let[e,t]=(0,r.useState)(null),[a,o]=(0,r.useState)(!0),[s,i]=(0,r.useState)(!1),[l,c]=(0,r.useState)(0),d=(0,n.e)(),u=()=>{console.log("Clearing all role-related cookies to prevent conflicts"),document.cookie="force_manager_view=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="test_role=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="admin_redirected=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="handling_redirect=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"},m=async(e,t)=>{console.log("⚠️ SECURITY: Forcing removal of admin role for unauthorized user"),u();try{await d.from("profiles").update({role:"agent"}).eq("id",e),console.log("Updated database role from admin to agent");let{error:t}=await d.auth.updateUser({data:{role:"agent"}});t&&console.error("Error updating user metadata:",t),setTimeout(()=>window.location.href="/agent/dashboard",100)}catch(e){console.error("Error clearing admin role:",e)}},p=async(e,t)=>{try{console.log(`Synchronizing user metadata role to match database: ${t}`);let{error:e}=await d.auth.updateUser({data:{role:t}});e&&console.error("Error updating user metadata:",e)}catch(e){console.error("Error synchronizing roles:",e)}},g=e=>{let t=Date.now();if(s||t-l<2e3){console.log("Preventing potential redirect loop");return}i(!0),c(t),document.cookie="handling_redirect=true; path=/; max-age=5",setTimeout(()=>{console.log(`Redirecting to /${e}/dashboard`),window.location.href=`/${e}/dashboard`,i(!1)},100)};return(0,r.useEffect)(()=>{let e=async()=>{try{let e=window.location.pathname,n=e.startsWith("/admin"),s=e.startsWith("/manager"),i=e.startsWith("/agent");if(n||s||i){let e=document.cookie.split("; ").find(e=>e.startsWith("test_role="))?.split("=")[1];i&&e&&"agent"!==e&&(console.log(`Path is /agent but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u()),s&&e&&"manager"!==e&&(console.log(`Path is /manager but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u()),n&&e&&"admin"!==e&&(console.log(`Path is /admin but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u())}if(document.cookie.includes("handling_redirect=true")){console.log("Skipping role check - redirect in progress"),o(!1);return}let l=document.cookie.split("; ").find(e=>e.startsWith("force_manager_view="))?.split("=")[1],c=document.cookie.split("; ").find(e=>e.startsWith("test_role="))?.split("=")[1],{data:{session:h}}=await d.auth.getSession();if(!h){t(null),o(!1);return}let f=["980ebab6-9e1a-4c53-876a-978c8c640f7e","adbdb861-5ce8-4b5c-af50-7deb93a687c1"];if(h.user.user_metadata?.role==="admin"&&!f.includes(h.user.id)){await m(h.user.id,h.user.email||""),t("agent"),o(!1);return}if("true"===l){console.log("⚠️ FORCED MANAGER VIEW: Using manager role from force_manager_view cookie"),await r(h.user.id,h.user.email,"manager"),t("manager"),o(!1);return}if(i){console.log("\uD83D\uDC49 On agent path, ensuring agent role and sidebar"),c&&u(),t("agent"),o(!1);return}if(s){console.log("\uD83D\uDC49 On manager path, ensuring manager role and sidebar"),c&&u(),t("manager"),o(!1);return}if(n){if(f.includes(h.user.id)){console.log("\uD83D\uDC49 On admin path with valid admin ID, ensuring admin role and sidebar"),c&&u(),t("admin"),o(!1);return}console.log("⚠️ SECURITY: Non-admin attempting to access admin path"),u(),g("agent");return}if("56e8e969-76fd-4d69-a8ca-3e315487c2c4"===h.user.id){console.log("⚠️ APPLYING ROLE OVERRIDE: Setting role to manager for santosUser"),await r(h.user.id,h.user.email,"manager"),t("manager"),o(!1);return}if(c&&["admin","manager","agent"].includes(c)){if("admin"===c&&!f.includes(h.user.id)){console.log("⚠️ SECURITY: Unauthorized admin access attempt via cookie. Defaulting to agent role."),document.cookie="test_role=agent; path=/; max-age=86400",t("agent"),o(!1);return}console.log(`⚠️ DEVELOPMENT MODE: Using ${c} role from test_role cookie`),t(c),o(!1);return}let{data:x}=await d.from("profiles").select("role").eq("id",h.user.id).single();if(x&&x.role){if(console.log(`Using role from database profile: ${x.role}`),"admin"===x.role&&!f.includes(h.user.id)){console.warn("⚠️ SECURITY: Unauthorized admin role in database. Correcting to agent."),await m(h.user.id,h.user.email||""),t("agent"),o(!1);return}if(h.user.user_metadata?.role&&h.user.user_metadata.role!==x.role&&(console.warn(`⚠️ Role mismatch: metadata (${h.user.user_metadata.role}) vs database (${x.role}). Using database role.`),await p(h.user.id,x.role)),t(x.role),e.startsWith("/admin")&&"admin"!==x.role){console.log(`⚠️ Path mismatch: User with role ${x.role} on admin path. Redirecting...`),o(!1),g(x.role);return}if(e.startsWith("/manager")&&"manager"!==x.role){console.log(`⚠️ Path mismatch: User with role ${x.role} on manager path. Redirecting...`),o(!1),g(x.role);return}if(e.startsWith("/agent")&&"agent"!==x.role){console.log(`⚠️ Path mismatch: User with role ${x.role} on agent path. Redirecting...`),o(!1),g(x.role);return}o(!1);return}if(h.user.user_metadata?.role&&["admin","manager","agent"].includes(h.user.user_metadata.role)){if("admin"===h.user.user_metadata.role&&!f.includes(h.user.id)){console.warn("⚠️ SECURITY: Unauthorized admin role in metadata. Correcting to agent."),await m(h.user.id,h.user.email||""),t("agent"),o(!1);return}console.log(`Using role from user metadata (no profile): ${h.user.user_metadata.role}`),await a(h.user.id,h.user.email,h.user.user_metadata.role),t(h.user.user_metadata.role)}else console.log("No role found. Defaulting to agent role."),await a(h.user.id,h.user.email||"","agent"),t("agent");o(!1)}catch(e){console.error("Error determining user role:",e),t(null),o(!1)}},a=async(e,t,a)=>{try{let{error:r}=await d.from("profiles").insert({id:e,email:t,role:a}).select();r&&console.error("Error creating user profile:",r)}catch(e){console.error("Error in profile creation:",e)}},r=async(e,t,r)=>{try{let{data:n}=await d.from("profiles").select("role").eq("id",e).single();n?n.role!==r&&(await d.from("profiles").update({role:r}).eq("id",e),console.log(`Updated profile role from ${n.role} to ${r}`)):(await a(e,t,r),console.log(`Created new profile with role ${r}`))}catch(e){console.error("Error ensuring profile has role:",e)}};e();let{data:{subscription:n}}=d.auth.onAuthStateChange((a,r)=>{if(!r){t(null);return}e()});return()=>{n.unsubscribe()}},[d,s,l]),{role:e,loading:a,isAdmin:"admin"===e,isManager:"manager"===e,isAgent:"agent"===e}}},82157:function(e,t,a){"use strict";a.d(t,{e:function(){return n}});var r=a(64392);let n=()=>(0,r.createClientComponentClient)({supabaseUrl:"https://iufyuzmigirugcufrtvt.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Znl1em1pZ2lydWdjdWZydHZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQxMjcsImV4cCI6MjA2MDYxMDEyN30.V38OGEX1Oy3gFfu5ClGWRk3xYAhb_DVr-5ojOQZ1UfU"});(0,r.createClientComponentClient)({supabaseUrl:"https://iufyuzmigirugcufrtvt.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Znl1em1pZ2lydWdjdWZydHZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQxMjcsImV4cCI6MjA2MDYxMDEyN30.V38OGEX1Oy3gFfu5ClGWRk3xYAhb_DVr-5ojOQZ1UfU"})}},function(e){e.O(0,[4392,2971,7023,1744],function(){return e(e.s=30453)}),_N_E=e.O()}]);