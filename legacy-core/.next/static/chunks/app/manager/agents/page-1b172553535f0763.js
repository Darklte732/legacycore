(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2689],{51098:function(e,t,r){Promise.resolve().then(r.bind(r,80611))},81066:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var a=r(2265),i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),o=(e,t)=>{let r=(0,a.forwardRef)((r,o)=>{let{color:s="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:u="",children:m,...g}=r;return(0,a.createElement)("svg",{ref:o,...i,width:l,height:l,stroke:s,strokeWidth:d?24*Number(c)/Number(l):c,className:["lucide",`lucide-${n(e)}`,u].join(" "),...g},[...t.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(m)?m:[m]])});return r.displayName=`${e}`,r}},11240:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(81066).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},80611:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var a=r(57437),i=r(2265),n=r(6683),o=r(82157),s=r(11240);function l(){let{role:e,loading:t}=(0,n.q)(),r=(0,o.e)(),[l,c]=(0,i.useState)([]),[d,u]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{async function e(){let{data:e}=await r.auth.getUser();if(!e?.user?.id)return;let{data:t,error:a}=await r.from("profiles").select("id, first_name, last_name, email, role").eq("role","agent").eq("manager_id",e.user.id).order("first_name",{ascending:!0});if(a){console.error("Error fetching agents:",a);return}c(t||[]),u(!1)}t||e()},[t,r]),t)?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center",children:"Loading..."}):(0,a.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,a.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[(0,a.jsx)(s.Z,{className:"h-8 w-8"}),"Agent Management"]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Agents List"}),d?(0,a.jsx)("p",{children:"Loading agents..."}):l.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.first_name," ",e.last_name]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.email}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.role})]},e.id))})]})}):(0,a.jsx)("p",{className:"text-gray-600",children:"No agents are currently assigned to you."})]})]})}},6683:function(e,t,r){"use strict";r.d(t,{q:function(){return n}});var a=r(2265),i=r(82157);let n=()=>{let[e,t]=(0,a.useState)(null),[r,n]=(0,a.useState)(!0),[o,s]=(0,a.useState)(!1),[l,c]=(0,a.useState)(0),d=(0,i.e)(),u=()=>{console.log("Clearing all role-related cookies to prevent conflicts"),document.cookie="force_manager_view=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="test_role=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="admin_redirected=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="handling_redirect=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"},m=async(e,t)=>{console.log("⚠️ SECURITY: Forcing removal of admin role for unauthorized user"),u();try{await d.from("profiles").update({role:"agent"}).eq("id",e),console.log("Updated database role from admin to agent");let{error:t}=await d.auth.updateUser({data:{role:"agent"}});t&&console.error("Error updating user metadata:",t),setTimeout(()=>window.location.href="/agent/dashboard",100)}catch(e){console.error("Error clearing admin role:",e)}},g=async(e,t)=>{try{console.log(`Synchronizing user metadata role to match database: ${t}`);let{error:e}=await d.auth.updateUser({data:{role:t}});e&&console.error("Error updating user metadata:",e)}catch(e){console.error("Error synchronizing roles:",e)}},h=e=>{let t=Date.now();if(o||t-l<2e3){console.log("Preventing potential redirect loop");return}s(!0),c(t),document.cookie="handling_redirect=true; path=/; max-age=5",setTimeout(()=>{console.log(`Redirecting to /${e}/dashboard`),window.location.href=`/${e}/dashboard`,s(!1)},100)};return(0,a.useEffect)(()=>{let e=async()=>{try{let e=window.location.pathname,i=e.startsWith("/admin"),o=e.startsWith("/manager"),s=e.startsWith("/agent");if(i||o||s){let e=document.cookie.split("; ").find(e=>e.startsWith("test_role="))?.split("=")[1];s&&e&&"agent"!==e&&(console.log(`Path is /agent but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u()),o&&e&&"manager"!==e&&(console.log(`Path is /manager but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u()),i&&e&&"admin"!==e&&(console.log(`Path is /admin but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),u())}if(document.cookie.includes("handling_redirect=true")){console.log("Skipping role check - redirect in progress"),n(!1);return}let l=document.cookie.split("; ").find(e=>e.startsWith("force_manager_view="))?.split("=")[1],c=document.cookie.split("; ").find(e=>e.startsWith("test_role="))?.split("=")[1],{data:{session:f}}=await d.auth.getSession();if(!f){t(null),n(!1);return}let p=["980ebab6-9e1a-4c53-876a-978c8c640f7e","adbdb861-5ce8-4b5c-af50-7deb93a687c1"];if(f.user.user_metadata?.role==="admin"&&!p.includes(f.user.id)){await m(f.user.id,f.user.email||""),t("agent"),n(!1);return}if("true"===l){console.log("⚠️ FORCED MANAGER VIEW: Using manager role from force_manager_view cookie"),await a(f.user.id,f.user.email,"manager"),t("manager"),n(!1);return}if(s){console.log("\uD83D\uDC49 On agent path, ensuring agent role and sidebar"),c&&u(),t("agent"),n(!1);return}if(o){console.log("\uD83D\uDC49 On manager path, ensuring manager role and sidebar"),c&&u(),t("manager"),n(!1);return}if(i){if(p.includes(f.user.id)){console.log("\uD83D\uDC49 On admin path with valid admin ID, ensuring admin role and sidebar"),c&&u(),t("admin"),n(!1);return}console.log("⚠️ SECURITY: Non-admin attempting to access admin path"),u(),h("agent");return}if("56e8e969-76fd-4d69-a8ca-3e315487c2c4"===f.user.id){console.log("⚠️ APPLYING ROLE OVERRIDE: Setting role to manager for santosUser"),await a(f.user.id,f.user.email,"manager"),t("manager"),n(!1);return}if(c&&["admin","manager","agent"].includes(c)){if("admin"===c&&!p.includes(f.user.id)){console.log("⚠️ SECURITY: Unauthorized admin access attempt via cookie. Defaulting to agent role."),document.cookie="test_role=agent; path=/; max-age=86400",t("agent"),n(!1);return}console.log(`⚠️ DEVELOPMENT MODE: Using ${c} role from test_role cookie`),t(c),n(!1);return}let{data:w}=await d.from("profiles").select("role").eq("id",f.user.id).single();if(w&&w.role){if(console.log(`Using role from database profile: ${w.role}`),"admin"===w.role&&!p.includes(f.user.id)){console.warn("⚠️ SECURITY: Unauthorized admin role in database. Correcting to agent."),await m(f.user.id,f.user.email||""),t("agent"),n(!1);return}if(f.user.user_metadata?.role&&f.user.user_metadata.role!==w.role&&(console.warn(`⚠️ Role mismatch: metadata (${f.user.user_metadata.role}) vs database (${w.role}). Using database role.`),await g(f.user.id,w.role)),t(w.role),e.startsWith("/admin")&&"admin"!==w.role){console.log(`⚠️ Path mismatch: User with role ${w.role} on admin path. Redirecting...`),n(!1),h(w.role);return}if(e.startsWith("/manager")&&"manager"!==w.role){console.log(`⚠️ Path mismatch: User with role ${w.role} on manager path. Redirecting...`),n(!1),h(w.role);return}if(e.startsWith("/agent")&&"agent"!==w.role){console.log(`⚠️ Path mismatch: User with role ${w.role} on agent path. Redirecting...`),n(!1),h(w.role);return}n(!1);return}if(f.user.user_metadata?.role&&["admin","manager","agent"].includes(f.user.user_metadata.role)){if("admin"===f.user.user_metadata.role&&!p.includes(f.user.id)){console.warn("⚠️ SECURITY: Unauthorized admin role in metadata. Correcting to agent."),await m(f.user.id,f.user.email||""),t("agent"),n(!1);return}console.log(`Using role from user metadata (no profile): ${f.user.user_metadata.role}`),await r(f.user.id,f.user.email,f.user.user_metadata.role),t(f.user.user_metadata.role)}else console.log("No role found. Defaulting to agent role."),await r(f.user.id,f.user.email||"","agent"),t("agent");n(!1)}catch(e){console.error("Error determining user role:",e),t(null),n(!1)}},r=async(e,t,r)=>{try{let{error:a}=await d.from("profiles").insert({id:e,email:t,role:r}).select();a&&console.error("Error creating user profile:",a)}catch(e){console.error("Error in profile creation:",e)}},a=async(e,t,a)=>{try{let{data:i}=await d.from("profiles").select("role").eq("id",e).single();i?i.role!==a&&(await d.from("profiles").update({role:a}).eq("id",e),console.log(`Updated profile role from ${i.role} to ${a}`)):(await r(e,t,a),console.log(`Created new profile with role ${a}`))}catch(e){console.error("Error ensuring profile has role:",e)}};e();let{data:{subscription:i}}=d.auth.onAuthStateChange((r,a)=>{if(!a){t(null);return}e()});return()=>{i.unsubscribe()}},[d,o,l]),{role:e,loading:r,isAdmin:"admin"===e,isManager:"manager"===e,isAgent:"agent"===e}}},82157:function(e,t,r){"use strict";r.d(t,{e:function(){return i}});var a=r(64392);let i=()=>(0,a.createClientComponentClient)({supabaseUrl:"https://iufyuzmigirugcufrtvt.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Znl1em1pZ2lydWdjdWZydHZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQxMjcsImV4cCI6MjA2MDYxMDEyN30.V38OGEX1Oy3gFfu5ClGWRk3xYAhb_DVr-5ojOQZ1UfU"});(0,a.createClientComponentClient)({supabaseUrl:"https://iufyuzmigirugcufrtvt.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Znl1em1pZ2lydWdjdWZydHZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQxMjcsImV4cCI6MjA2MDYxMDEyN30.V38OGEX1Oy3gFfu5ClGWRk3xYAhb_DVr-5ojOQZ1UfU"})}},function(e){e.O(0,[4392,2971,7023,1744],function(){return e(e.s=51098)}),_N_E=e.O()}]);