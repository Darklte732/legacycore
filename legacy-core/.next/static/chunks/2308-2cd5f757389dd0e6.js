"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2308],{32308:function(e,a,t){t.d(a,{M:function(){return L}});var r=t(57437),s=t(2265),n=t(16463),o=t(6683),i=t(87138),l=t(47427),c=t(11240),d=t(35931),m=t(24258),u=t(52022),h=t(89896),g=t(82157);let f=()=>{let e=(0,n.usePathname)(),a=(0,g.e)(),[t,o]=(0,s.useState)(""),[f,x]=(0,s.useState)("");(0,s.useEffect)(()=>{document.cookie="force_manager_view=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="test_role=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="admin_redirected=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT";let e=()=>{let e=document.querySelectorAll(".w-64.bg-gray-900");if(e.length>1){console.log("AdminSidebar: Found multiple sidebars, removing duplicates");for(let a=1;a<e.length;a++)e[a].remove()}document.querySelectorAll(".text-xl.font-bold").forEach(e=>{if(e.textContent?.includes("LegacyCore Manager")){let a=e.parentElement;for(;a&&!a.classList.contains("w-64");)a=a.parentElement;a&&(a.remove(),console.log("AdminSidebar: Removed manager sidebar"))}})};e(),setTimeout(e,100),setTimeout(e,500)},[]),(0,s.useEffect)(()=>{(async()=>{let{data:{session:e}}=await a.auth.getSession();e?.user&&(o(e.user.email||""),x(e.user.id||""))})()},[a]);let p=a=>e===a||e?.startsWith(a+"/"),b=async e=>{e.preventDefault(),await a.auth.signOut(),window.location.href="/login"};return(0,r.jsxs)("div",{className:"w-64 bg-gray-900 text-white flex flex-col h-screen",id:"admin-sidebar",children:[(0,r.jsx)("div",{className:"p-6 border-b border-slate-700",children:(0,r.jsx)("h1",{className:"text-xl font-bold",children:"LegacyCore Admin"})}),(0,r.jsx)("nav",{className:"flex-1 px-4 py-2",children:(0,r.jsxs)("ul",{className:"space-y-1",children:[(0,r.jsx)("li",{children:(0,r.jsxs)(i.default,{href:"/admin/dashboard",className:`flex items-center space-x-3 px-4 py-3 rounded-md ${p("/admin/dashboard")?"bg-slate-800 text-white":"text-slate-300 hover:bg-slate-800 hover:text-white"}`,children:[(0,r.jsx)(l.Z,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"Dashboard"})]})}),(0,r.jsx)("li",{children:(0,r.jsxs)(i.default,{href:"/admin/views/user-management",className:`flex items-center space-x-3 px-4 py-3 rounded-md ${p("/admin/views/user-management")?"bg-slate-800 text-white":"text-slate-300 hover:bg-slate-800 hover:text-white"}`,children:[(0,r.jsx)(c.Z,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"User Management"})]})}),(0,r.jsx)("li",{children:(0,r.jsxs)(i.default,{href:"/admin/views",className:`flex items-center space-x-3 px-4 py-3 rounded-md ${p("/admin/views")?"bg-slate-800 text-white":"text-slate-300 hover:bg-slate-800 hover:text-white"}`,children:[(0,r.jsx)(d.Z,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"Role Views"})]})}),(0,r.jsx)("li",{children:(0,r.jsxs)(i.default,{href:"/admin/settings",className:`flex items-center space-x-3 px-4 py-3 rounded-md ${p("/admin/settings")?"bg-slate-800 text-white":"text-slate-300 hover:bg-slate-800 hover:text-white"}`,children:[(0,r.jsx)(m.Z,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"Settings"})]})})]})}),(0,r.jsxs)("div",{className:"p-4 border-t border-slate-700",children:[(t||f)&&(0,r.jsxs)("div",{className:"px-4 py-2 mb-2 text-sm border-b border-slate-700 pb-2",children:[t&&(0,r.jsxs)("div",{className:"flex items-center space-x-3 text-slate-400 mb-1",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"truncate",children:t})]}),f&&(0,r.jsx)("div",{className:"text-xs text-slate-500 mt-1 pl-7",children:(0,r.jsxs)("span",{children:["ID: ",f]})})]}),(0,r.jsxs)("button",{onClick:b,className:"flex items-center space-x-3 w-full px-4 py-2 rounded-md text-slate-300 hover:bg-slate-800 hover:text-white",children:[(0,r.jsx)(h.Z,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"Sign Out"})]})]})]})};var x=t(87140),p=t(64590),b=t(22023),w=t(74232),y=t(24241),j=t(47390),N=t(6649),v=t(66648);let S=()=>{let e=(0,n.usePathname)(),a=(0,g.e)(),[t,o]=(0,s.useState)(""),[i,d]=(0,s.useState)("");if((0,s.useEffect)(()=>{if(e?.startsWith("/admin")){console.log("ManagerSidebar: Prevented rendering on admin path");return}let a=()=>{let e=document.querySelectorAll(".w-64.bg-gray-900");e.length>1&&(console.log("ManagerSidebar: Found multiple sidebars, removing duplicates"),e.forEach(e=>{let a=e.querySelector(".text-xl.font-bold");a&&!a.textContent?.includes("LegacyCore Manager")&&e.remove()})),document.querySelectorAll(".text-xl.font-bold").forEach(e=>{if(e.textContent?.includes("LegacyCore Admin")){let a=e.parentElement;for(;a&&!a.classList.contains("w-64");)a=a.parentElement;a&&(a.remove(),console.log("ManagerSidebar: Removed admin sidebar"))}})};e?.startsWith("/manager")&&!document.cookie.includes("test_role=manager")&&(document.cookie="test_role=manager; path=/; max-age=86400"),a(),setTimeout(a,100),setTimeout(a,500)},[e]),(0,s.useEffect)(()=>{(async()=>{let{data:{session:e}}=await a.auth.getSession();e?.user&&(o(e.user.email||""),d(e.user.id||""))})()},[a]),e?.startsWith("/admin"))return console.log("ManagerSidebar: Prevented rendering on admin path to avoid double UI"),null;let u=a=>!!e&&(e===a||e===a+"/"||e.startsWith(a+"/")&&"/manager"!==a),f=async e=>{e.preventDefault(),console.log("Manager sidebar: initiating logout...");try{await a.auth.signOut(),console.log("Manager sidebar: signOut completed, redirecting..."),window.location.href="/login"}catch(e){console.error("Manager sidebar: logout error:",e),window.location.href="/login"}},S=[{href:"/manager/dashboard",label:"Dashboard",icon:(0,r.jsx)(x.Z,{className:"h-5 w-5"})},{href:"/manager/agents",label:"Agents",icon:(0,r.jsx)(c.Z,{className:"h-5 w-5"})},{href:"/manager/my-applications",label:"My Applications",icon:(0,r.jsx)(p.Z,{className:"h-5 w-5"})},{href:"/manager/applications",label:"All Applications",icon:(0,r.jsx)(b.Z,{className:"h-5 w-5"})},{href:"/manager/carriers",label:"Carriers",icon:(0,r.jsx)(w.Z,{className:"h-5 w-5"})},{href:"/manager/calendar",label:"Calendar",icon:(0,r.jsx)(y.Z,{className:"h-5 w-5"})},{href:"/manager/analytics",label:"Analytics",icon:(0,r.jsx)(l.Z,{className:"h-5 w-5"})},{href:"/manager/ai-chat",label:"AI Chat",icon:(0,r.jsx)(j.Z,{className:"h-5 w-5"})},{href:"/manager/script-assistant",label:"Script Assistant",icon:(0,r.jsx)(N.Z,{className:"h-5 w-5"})},{href:"/manager/settings",label:"Settings",icon:(0,r.jsx)(m.Z,{className:"h-5 w-5"})}],E=e=>{console.log(`Navigating to: ${e}`);let a=new URL(e,window.location.origin).toString(),t=new URL(a);t.searchParams.set("nocache",Date.now().toString()),window.location.href=t.toString()};return(0,r.jsxs)("div",{className:"w-64 bg-gradient-to-b from-gray-900 to-gray-800 text-white p-4 flex flex-col min-h-screen h-screen sticky top-0 left-0 shadow-lg",id:"manager-sidebar",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center mb-2",children:[(0,r.jsx)("div",{className:"w-10 h-10 mr-3 relative flex-shrink-0",children:(0,r.jsx)(v.default,{src:"/logo.png",alt:"LegacyCore Logo",width:40,height:40,className:"object-contain"})}),(0,r.jsx)("h1",{className:"text-xl font-bold text-white",children:"LegacyCore Manager"})]}),(0,r.jsx)("div",{className:"h-1 w-1/2 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full"})]}),(0,r.jsx)("nav",{className:"space-y-1.5 flex-1",children:S.map(e=>(0,r.jsxs)("button",{onClick:()=>E(e.href),className:`flex items-center space-x-3 p-2.5 rounded-lg w-full text-left transition-all duration-200 ${u(e.href)?"bg-gradient-to-r from-indigo-600/90 to-indigo-700/80 text-white shadow-md":"text-gray-300 hover:bg-gray-800/70 hover:text-white"}`,children:[e.icon,(0,r.jsx)("span",{className:"font-medium",children:e.label})]},e.href))}),(0,r.jsx)("div",{className:"flex-grow"}),t&&(0,r.jsx)("div",{className:"mt-4 py-3 border-t border-gray-700/50",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-9 h-9 rounded-full bg-indigo-600 flex items-center justify-center text-white shadow-md",children:t.charAt(0).toUpperCase()}),(0,r.jsxs)("div",{className:"ml-3 overflow-hidden",children:[(0,r.jsx)("p",{className:"text-sm font-medium truncate",children:t}),(0,r.jsxs)("button",{onClick:f,className:"flex items-center text-xs text-gray-400 hover:text-white transition-colors",children:[(0,r.jsx)(h.Z,{className:"h-3 w-3 mr-1"}),(0,r.jsx)("span",{children:"Sign out"})]})]})]})})]})};var E=t(51077),C=t(42365),k=t(4086),I=t(66706),_=t(6600),A=t(43674),R=t(68954),U=t(55715),Z=t(67048);let M=()=>{let e=(0,n.usePathname)(),{signOut:a}=(0,Z.a)(),[t,o]=(0,s.useState)(""),[l,c]=(0,s.useState)(""),[d,m]=(0,s.useState)({"/agent/attachments":!0}),f=(0,g.e)();(0,s.useEffect)(()=>{(async()=>{let{data:{session:e}}=await f.auth.getSession();e?.user&&(o(e.user.email||""),c(e.user.id||""))})()},[f]);let p=a=>e?.startsWith(a),N=e=>{m(a=>({...a,[e]:!a[e]}))},S=[{href:"/agent/dashboard",label:"Dashboard",icon:(0,r.jsx)(x.Z,{className:"h-5 w-5"})},{href:"/agent/script-assistant",label:"Script Assistant",icon:(0,r.jsx)(j.Z,{className:"h-5 w-5"})},{href:"/agent/applications",label:"My Applications",icon:(0,r.jsx)(b.Z,{className:"h-5 w-5"})},{href:"/agent/commissions",label:"Commissions",icon:(0,r.jsx)(E.Z,{className:"h-5 w-5"})},{href:"/agent/carriers",label:"Carriers",icon:(0,r.jsx)(w.Z,{className:"h-5 w-5"})},{href:"/agent/calendar",label:"Calendar",icon:(0,r.jsx)(y.Z,{className:"h-5 w-5"})}],M={href:"/agent/attachments",label:"Attachments",icon:(0,r.jsx)(C.Z,{className:"h-5 w-5"}),subItems:[{href:"/agent/attachments?type=email",label:"Email Processing",icon:(0,r.jsx)(k.Z,{className:"h-4 w-4"})},{href:"/agent/attachments?type=drafts",label:"Draft Returns",icon:(0,r.jsx)(I.Z,{className:"h-4 w-4"})},{href:"/agent/attachments?type=notifications",label:"Notifications",icon:(0,r.jsx)(_.Z,{className:"h-4 w-4"})},{href:"/agent/attachments?type=documents",label:"Documents",icon:(0,r.jsx)(A.Z,{className:"h-4 w-4"})}]},L=[{href:"/agent/ai-chat",label:"AI Chat",icon:(0,r.jsx)(R.Z,{className:"h-5 w-5"})},{href:"/agent/applications/new",label:"New Application",icon:(0,r.jsx)(U.Z,{className:"h-5 w-5"})}];return(0,r.jsxs)("div",{className:"w-64 bg-gradient-to-b from-gray-900 to-gray-950 text-white p-4 flex flex-col min-h-screen h-full sticky top-0 left-0 shadow-lg",children:[(0,r.jsx)("div",{className:"mb-6 pt-2",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 relative",children:(0,r.jsx)(v.default,{src:"/logo.png",alt:"LegacyCore Logo",width:32,height:32,className:"object-contain"})}),(0,r.jsx)("h1",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-200 to-blue-400",children:"LegacyCore Agent"})]})}),(0,r.jsxs)("nav",{className:"space-y-1 flex-1",children:[(0,r.jsx)("div",{className:"pb-2",children:S.map(e=>(0,r.jsxs)(i.default,{href:e.href,className:`flex items-center space-x-2 p-2 rounded-md w-full text-left mb-1 transition-colors ${p(e.href)?"bg-gradient-to-r from-blue-800/60 to-blue-900/40 text-blue-200":"hover:bg-gray-800 text-gray-300 hover:text-white"}`,children:[(0,r.jsx)("div",{className:`${p(e.href)?"text-blue-400":"text-gray-400"}`,children:e.icon}),(0,r.jsx)("span",{children:e.label})]},e.href))}),(0,r.jsxs)("div",{className:"pb-2 border-t border-b border-gray-800 my-2 pt-2",children:[(0,r.jsxs)("button",{onClick:()=>N(M.href),className:`flex items-center justify-between space-x-2 p-2 rounded-md w-full text-left mb-1 transition-colors ${p(M.href)?"bg-gradient-to-r from-blue-800/60 to-blue-900/40 text-blue-200":"hover:bg-gray-800 text-gray-300 hover:text-white"}`,children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:`${p(M.href)?"text-blue-400":"text-gray-400"}`,children:M.icon}),(0,r.jsx)("span",{children:M.label})]}),(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 transition-transform ${d[M.href]?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),d[M.href]&&(0,r.jsx)("div",{className:"ml-8 space-y-1 mt-1",children:M.subItems.map(a=>(0,r.jsxs)(i.default,{href:a.href,className:`flex items-center space-x-2 p-1.5 rounded-md w-full text-left text-sm transition-colors ${p(a.href)&&e?.includes(new URL(a.href,"http://example.com").search)?"bg-blue-900/30 text-blue-300":"hover:bg-gray-800/50 text-gray-400 hover:text-white"}`,children:[(0,r.jsx)("div",{className:`${p(a.href)&&e?.includes(new URL(a.href,"http://example.com").search)?"text-blue-400":"text-gray-500"}`,children:a.icon}),(0,r.jsx)("span",{children:a.label})]},a.href))})]}),(0,r.jsx)("div",{className:"pb-2",children:L.map(e=>(0,r.jsxs)(i.default,{href:e.href,className:`flex items-center space-x-2 p-2 rounded-md w-full text-left mb-1 transition-colors ${p(e.href)?"bg-gradient-to-r from-blue-800/60 to-blue-900/40 text-blue-200":"hover:bg-gray-800 text-gray-300 hover:text-white"}`,children:[(0,r.jsx)("div",{className:`${p(e.href)?"text-blue-400":"text-gray-400"}`,children:e.icon}),(0,r.jsx)("span",{children:e.label})]},e.href))})]}),(0,r.jsx)("div",{className:"flex-grow"}),(t||l)&&(0,r.jsx)("div",{className:"p-3 mb-2 rounded-lg bg-gradient-to-r from-gray-800 to-gray-900 border border-gray-800 shadow-inner",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-2 rounded-full",children:(0,r.jsx)(u.Z,{className:"h-4 w-4 text-blue-100"})}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-xs text-gray-400 mb-0.5",children:"Logged in as:"}),(0,r.jsx)("span",{className:"text-xs text-gray-200 break-all leading-snug font-medium",children:t}),l&&(0,r.jsxs)("span",{className:"text-xs text-gray-400 break-all leading-snug mt-1 bg-gray-900/50 p-1.5 rounded border border-gray-800 mt-2 font-mono",children:["ID: ",l]})]})]})}),(0,r.jsxs)("button",{onClick:()=>a(),className:"flex items-center justify-center space-x-2 p-2 rounded-md bg-gradient-to-r from-gray-800 to-gray-700 hover:from-red-900 hover:to-red-800 text-gray-300 hover:text-white w-full text-center transition-colors duration-300",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4 flex-shrink-0"}),(0,r.jsx)("span",{children:"Logout"})]})]})},L=e=>{let{children:a}=e,{role:t,loading:i}=(0,o.q)(),l=(0,n.usePathname)(),c=(0,n.useRouter)(),[d,m]=(0,s.useState)(!0),[u,h]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{console.log("RoleBasedLayout: Current role =",t),console.log("RoleBasedLayout: Current path =",l)},[t,l]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{h(!1);let e=document.querySelectorAll(".loading-indicator");e.length>0&&(console.log("RoleBasedLayout: Found loading indicators that might be stuck, removing them"),e.forEach(e=>e.remove()))},2e3);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{i?m(!1):m(!0)},[i]),(0,s.useEffect)(()=>{if(!t||!l)return;let e=l.startsWith("/admin"),a=l.startsWith("/manager"),r=l.startsWith("/agent");t&&l&&(()=>{if("admin"===t&&!e){c.push("/admin/dashboard");return}if("manager"===t&&!a){e&&console.log("⚠️ Path mismatch: User with role manager on admin path. Redirecting..."),c.push("/manager/dashboard");return}if("agent"===t&&!r){(e||a)&&console.log("⚠️ Path mismatch: User with role agent on admin/manager path. Redirecting..."),c.push("/agent/dashboard");return}})()},[t,l,c]),(0,s.useEffect)(()=>{if(l?.startsWith("/agent")){let e=document.cookie.split("; ").find(e=>e.startsWith("test_role="))?.split("=")[1];e&&"agent"!==e&&(console.log(`Detected conflicting test_role=${e} cookie on agent path, clearing it`),document.cookie="test_role=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="force_manager_view=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="admin_redirected=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT")}},[l]),(0,r.jsxs)("div",{className:"flex flex-row min-h-screen bg-gray-100 w-full overflow-hidden",children:[(()=>{if(i)return console.log("RoleBasedLayout: Still loading, not showing sidebar yet"),null;if(l){if(l.startsWith("/agent"))return console.log("RoleBasedLayout: On agent path, showing AgentSidebar"),(0,r.jsx)(M,{});if(l.startsWith("/manager"))return console.log("RoleBasedLayout: On manager path, showing ManagerSidebar"),(0,r.jsx)(S,{});if(l.startsWith("/admin"))return console.log("RoleBasedLayout: On admin path, showing AdminSidebar"),(0,r.jsx)(f,{})}return"admin"===t?(console.log("RoleBasedLayout: Using role-based AdminSidebar"),(0,r.jsx)(f,{})):"manager"===t?(console.log("RoleBasedLayout: Using role-based ManagerSidebar"),(0,r.jsx)(S,{})):"agent"===t?(console.log("RoleBasedLayout: Using role-based AgentSidebar"),(0,r.jsx)(M,{})):(console.log("RoleBasedLayout: No matching sidebar for role:",t),null)})(),(0,r.jsx)("div",{className:"flex-1 overflow-hidden min-h-screen h-screen max-h-screen",children:u&&!d?(0,r.jsx)("div",{className:"loading-indicator flex justify-center items-center h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):d&&(0,r.jsx)("main",{className:"p-4 h-full overflow-y-auto overflow-x-hidden",children:a})})]})}},67048:function(e,a,t){t.d(a,{a:function(){return i}});var r=t(2265),s=t(82157),n=t(16463);let o={MANAGER:{email:"manager@legacycore.io",password:"password",role:"manager"},AGENT:{email:"agent@legacycore.io",password:"password",role:"agent"},ADMIN:{email:"admin@legacycore.io",password:"password",role:"admin"}},i=()=>{let[e,a]=(0,r.useState)(null),[t,i]=(0,r.useState)(null),[l,c]=(0,r.useState)(!0),[d,m]=(0,r.useState)(null),u=(0,s.e)(),h=(0,n.useRouter)();return(0,r.useEffect)(()=>{(async()=>{c(!0);try{let{data:{session:e}}=await u.auth.getSession();i(e),a(e?.user||null)}catch(e){console.error("Error fetching session:",e),m(e instanceof Error?e.message:"Error fetching auth session")}finally{c(!1)}})();let{data:{subscription:e}}=u.auth.onAuthStateChange((e,t)=>{i(t),a(t?.user||null),c(!1)});return()=>{e.unsubscribe()}},[u]),{user:e,session:t,loading:l,error:d,signIn:async(e,a)=>{c(!0),m(null);try{console.log("Signing in with email/password");let{data:t,error:r}=await u.auth.signInWithPassword({email:e,password:a});if(r)throw r;if(t&&t.user){console.log("Authentication successful:",t);let{data:e}=await u.from("profiles").select("role").eq("id",t.user.id).single(),a=e?.role||"agent",r="admin"===a?"/admin/dashboard":"manager"===a?"/manager/dashboard":"/agent/dashboard";return console.log(`Redirecting to ${r}`),window.location.href=r,{success:!0,message:"Logged in successfully!"}}return{success:!0,message:"Authentication successful!"}}catch(e){throw console.error("Error signing in:",e),m(e instanceof Error?e.message:"An error occurred during sign in"),e}finally{c(!1)}},signOut:async()=>{c(!0);try{await u.auth.signOut(),h.push("/login")}catch(e){console.error("Error signing out:",e),m(e instanceof Error?e.message:"An error occurred during sign out")}finally{c(!1)}},signUp:async(e,a,t,r)=>{c(!0),m(null);try{let{error:s,data:n}=await u.auth.signUp({email:e,password:a,options:{emailRedirectTo:new URL("/auth/callback",window.location.origin).toString(),data:{role:"agent",first_name:t,last_name:r}}});if(s)throw s;if(n.user){let{error:a}=await u.from("profiles").insert({id:n.user.id,email:e,first_name:t,last_name:r,role:"agent",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});a&&console.error("Error creating profile:",a)}return{success:!0,message:"Check your email to confirm your account!"}}catch(e){throw console.error("Error signing up:",e),m(e instanceof Error?e.message:"An error occurred during sign up"),e}finally{c(!1)}},resetPassword:async e=>{c(!0),m(null);try{console.log("Initiating password reset for:",e),["admin@legacycore.io","manager@legacycore.io","agent@legacycore.io"].includes(e)&&console.log("Test account detected, but proceeding with actual password reset"),console.log("Calling Supabase resetPasswordForEmail with redirectTo:",new URL("/auth/confirm",window.location.origin).toString());let{data:a,error:t}=await u.auth.resetPasswordForEmail(e,{redirectTo:new URL("/auth/confirm",window.location.origin).toString()});if(t)throw console.error("Supabase resetPasswordForEmail error:",t),t;return console.log("Password reset email sent successfully:",a),{success:!0,message:"Password reset instructions sent to your email."}}catch(e){throw console.error("Error resetting password:",e),m(e instanceof Error?e.message:"An error occurred during password reset"),e}finally{c(!1)}},TEST_USERS:o}}},6683:function(e,a,t){t.d(a,{q:function(){return n}});var r=t(2265),s=t(82157);let n=()=>{let[e,a]=(0,r.useState)(null),[t,n]=(0,r.useState)(!0),[o,i]=(0,r.useState)(!1),[l,c]=(0,r.useState)(0),d=(0,s.e)(),m=()=>{console.log("Clearing all role-related cookies to prevent conflicts"),document.cookie="force_manager_view=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="test_role=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="admin_redirected=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="handling_redirect=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"},u=async(e,a)=>{console.log("⚠️ SECURITY: Forcing removal of admin role for unauthorized user"),m();try{await d.from("profiles").update({role:"agent"}).eq("id",e),console.log("Updated database role from admin to agent");let{error:a}=await d.auth.updateUser({data:{role:"agent"}});a&&console.error("Error updating user metadata:",a),setTimeout(()=>window.location.href="/agent/dashboard",100)}catch(e){console.error("Error clearing admin role:",e)}},h=async(e,a)=>{try{console.log(`Synchronizing user metadata role to match database: ${a}`);let{error:e}=await d.auth.updateUser({data:{role:a}});e&&console.error("Error updating user metadata:",e)}catch(e){console.error("Error synchronizing roles:",e)}},g=e=>{let a=Date.now();if(o||a-l<2e3){console.log("Preventing potential redirect loop");return}i(!0),c(a),document.cookie="handling_redirect=true; path=/; max-age=5",setTimeout(()=>{console.log(`Redirecting to /${e}/dashboard`),window.location.href=`/${e}/dashboard`,i(!1)},100)};return(0,r.useEffect)(()=>{let e=async()=>{try{let e=window.location.pathname,s=e.startsWith("/admin"),o=e.startsWith("/manager"),i=e.startsWith("/agent");if(s||o||i){let e=document.cookie.split("; ").find(e=>e.startsWith("test_role="))?.split("=")[1];i&&e&&"agent"!==e&&(console.log(`Path is /agent but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),m()),o&&e&&"manager"!==e&&(console.log(`Path is /manager but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),m()),s&&e&&"admin"!==e&&(console.log(`Path is /admin but test_role cookie is ${e}, clearing to prevent sidebar mismatch`),m())}if(document.cookie.includes("handling_redirect=true")){console.log("Skipping role check - redirect in progress"),n(!1);return}let l=document.cookie.split("; ").find(e=>e.startsWith("force_manager_view="))?.split("=")[1],c=document.cookie.split("; ").find(e=>e.startsWith("test_role="))?.split("=")[1],{data:{session:f}}=await d.auth.getSession();if(!f){a(null),n(!1);return}let x=["980ebab6-9e1a-4c53-876a-978c8c640f7e","adbdb861-5ce8-4b5c-af50-7deb93a687c1"];if(f.user.user_metadata?.role==="admin"&&!x.includes(f.user.id)){await u(f.user.id,f.user.email||""),a("agent"),n(!1);return}if("true"===l){console.log("⚠️ FORCED MANAGER VIEW: Using manager role from force_manager_view cookie"),await r(f.user.id,f.user.email,"manager"),a("manager"),n(!1);return}if(i){console.log("\uD83D\uDC49 On agent path, ensuring agent role and sidebar"),c&&m(),a("agent"),n(!1);return}if(o){console.log("\uD83D\uDC49 On manager path, ensuring manager role and sidebar"),c&&m(),a("manager"),n(!1);return}if(s){if(x.includes(f.user.id)){console.log("\uD83D\uDC49 On admin path with valid admin ID, ensuring admin role and sidebar"),c&&m(),a("admin"),n(!1);return}console.log("⚠️ SECURITY: Non-admin attempting to access admin path"),m(),g("agent");return}if("56e8e969-76fd-4d69-a8ca-3e315487c2c4"===f.user.id){console.log("⚠️ APPLYING ROLE OVERRIDE: Setting role to manager for santosUser"),await r(f.user.id,f.user.email,"manager"),a("manager"),n(!1);return}if(c&&["admin","manager","agent"].includes(c)){if("admin"===c&&!x.includes(f.user.id)){console.log("⚠️ SECURITY: Unauthorized admin access attempt via cookie. Defaulting to agent role."),document.cookie="test_role=agent; path=/; max-age=86400",a("agent"),n(!1);return}console.log(`⚠️ DEVELOPMENT MODE: Using ${c} role from test_role cookie`),a(c),n(!1);return}let{data:p}=await d.from("profiles").select("role").eq("id",f.user.id).single();if(p&&p.role){if(console.log(`Using role from database profile: ${p.role}`),"admin"===p.role&&!x.includes(f.user.id)){console.warn("⚠️ SECURITY: Unauthorized admin role in database. Correcting to agent."),await u(f.user.id,f.user.email||""),a("agent"),n(!1);return}if(f.user.user_metadata?.role&&f.user.user_metadata.role!==p.role&&(console.warn(`⚠️ Role mismatch: metadata (${f.user.user_metadata.role}) vs database (${p.role}). Using database role.`),await h(f.user.id,p.role)),a(p.role),e.startsWith("/admin")&&"admin"!==p.role){console.log(`⚠️ Path mismatch: User with role ${p.role} on admin path. Redirecting...`),n(!1),g(p.role);return}if(e.startsWith("/manager")&&"manager"!==p.role){console.log(`⚠️ Path mismatch: User with role ${p.role} on manager path. Redirecting...`),n(!1),g(p.role);return}if(e.startsWith("/agent")&&"agent"!==p.role){console.log(`⚠️ Path mismatch: User with role ${p.role} on agent path. Redirecting...`),n(!1),g(p.role);return}n(!1);return}if(f.user.user_metadata?.role&&["admin","manager","agent"].includes(f.user.user_metadata.role)){if("admin"===f.user.user_metadata.role&&!x.includes(f.user.id)){console.warn("⚠️ SECURITY: Unauthorized admin role in metadata. Correcting to agent."),await u(f.user.id,f.user.email||""),a("agent"),n(!1);return}console.log(`Using role from user metadata (no profile): ${f.user.user_metadata.role}`),await t(f.user.id,f.user.email,f.user.user_metadata.role),a(f.user.user_metadata.role)}else console.log("No role found. Defaulting to agent role."),await t(f.user.id,f.user.email||"","agent"),a("agent");n(!1)}catch(e){console.error("Error determining user role:",e),a(null),n(!1)}},t=async(e,a,t)=>{try{let{error:r}=await d.from("profiles").insert({id:e,email:a,role:t}).select();r&&console.error("Error creating user profile:",r)}catch(e){console.error("Error in profile creation:",e)}},r=async(e,a,r)=>{try{let{data:s}=await d.from("profiles").select("role").eq("id",e).single();s?s.role!==r&&(await d.from("profiles").update({role:r}).eq("id",e),console.log(`Updated profile role from ${s.role} to ${r}`)):(await t(e,a,r),console.log(`Created new profile with role ${r}`))}catch(e){console.error("Error ensuring profile has role:",e)}};e();let{data:{subscription:s}}=d.auth.onAuthStateChange((t,r)=>{if(!r){a(null);return}e()});return()=>{s.unsubscribe()}},[d,o,l]),{role:e,loading:t,isAdmin:"admin"===e,isManager:"manager"===e,isAgent:"agent"===e}}},82157:function(e,a,t){t.d(a,{e:function(){return s}});var r=t(64392);let s=()=>(0,r.createClientComponentClient)({supabaseUrl:"https://iufyuzmigirugcufrtvt.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Znl1em1pZ2lydWdjdWZydHZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQxMjcsImV4cCI6MjA2MDYxMDEyN30.V38OGEX1Oy3gFfu5ClGWRk3xYAhb_DVr-5ojOQZ1UfU"});(0,r.createClientComponentClient)({supabaseUrl:"https://iufyuzmigirugcufrtvt.supabase.co",supabaseKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Znl1em1pZ2lydWdjdWZydHZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzQxMjcsImV4cCI6MjA2MDYxMDEyN30.V38OGEX1Oy3gFfu5ClGWRk3xYAhb_DVr-5ojOQZ1UfU"})}}]);